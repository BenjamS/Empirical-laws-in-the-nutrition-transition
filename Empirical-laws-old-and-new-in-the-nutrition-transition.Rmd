---
title: Empirical laws, old and new, in the nutrition transition
author:
  - name: Benjamin Schiek
    email: b.schiek@cgiar.org
    affiliation: Alliance Bioversity-CIAT
    footnote: Corresponding Author
address:
  - code: Alliance Bioversity-CIAT
    address: Alliance Bioversity-CIAT, Km 17 Recta Cali-Palmira, Valle del Cauca, Colombia
abstract: |
  Much of the Nutrition Transition literature implicitly rests upon Engel's Law and Bennett's Law. However, rarely are these key empirical laws explicitly referenced or visualized in a straightforward manner. There is evidence that this may be due to a general lack of familiarity with these old laws and their relevance to modern discussions of dietary transitions, food security, and resilient food systems. Here I address this gap with an in-depth, graphical review of Engel's and Bennett's Laws, including analysis of their stability across time and space. Animations (provided as supplemental materials) offer further striking visualization of the laws' evolution over time. I then propose a theoretical framework by which to unify the two laws as separate manifestations of the single underlying principle of diminishing marginal utility. Finally, I present a new empirical law that appears to have gone unnoticed until now: a log-linear corresponance between the mean prices of agricultural commodities and their respective volatilities.
keywords: Nutrition transition, Bennett's Law, Engel's Law, food demand, food price volatility, food security, food systems
journal: Food Policy
bibliography: Empirical laws, old and new, in the nutrition transition.bib
header-includes:
  - \usepackage{float}
  - \floatplacement{figure}{H}
#linenumbers: true
numbersections: true
output:
  rticles::elsevier_article:
    latex_engine: xelatex
mainfont: Garamond
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE)
library(plyr)
library(tidyverse)
library(patchwork)
library(ggrepel)
#library(kableExtra)
shape_vec <- c(21:24, 4)
point_size <- 1.5
smallPoint_size <- 1
label_size <- 2.5
smallLabel_size <- 2
title_size <- 8
subtitle_size <- 7
legendText_size <- 7
axisText_size <- 6
axisTitle_size <- 7
facetTitle_size <- 7
#==========================================================================
shift_legend2 <- function(p) {
  # ...
  # to grob
  gp <- ggplotGrob(p)
  facet.panels <- grep("^panel", gp[["layout"]][["name"]])
  empty.facet.panels <- sapply(facet.panels, function(i) "zeroGrob" %in% class(gp[["grobs"]][[i]]))
  empty.facet.panels <- facet.panels[empty.facet.panels]
  
  # establish name of empty panels
  empty.facet.panels <- gp[["layout"]][empty.facet.panels, ]
  names <- empty.facet.panels$name
  # example of names:
  #[1] "panel-3-2" "panel-3-3"
  
  # now we just need a simple call to reposition the legend
  #lemon::reposition_legend(p, 'center', panel=names)
  p_out <- lemon::reposition_legend(p, 'center', panel=names)
  #class(lemon::reposition_legend(p, 'center', panel=names))
  return(p_out)
}
#==========================================================================

```

# Introduction

A good understanding of Bennett's Law [@bennett1941international] and Engel's Law [@zimmerman1932ernst; @stigler1954early] is key to understanding the future composition and quantity of food demand as incomes rise. The FAO takes Engel's Law as a starting point in its expert-based estimates of future food demand [@alexandratos2012world], and four of the ... most prominent agricultural sector equilibrium models have Engel's Law at their core [@valin2014future]. Engel's and Bennett's Laws also form the _implicit_ basis for much of the modern discussion regarding dietary transitions, future food demand, food/nutritional security, and resilient food systems [@popkin1993nutritional; @kearney2010food; @popkin2012global; bodirsky2015global]. However, there is surprisingly little explicit reference to the laws in this literature. On numerous occasions, the laws have also been mischaracterized or rediscovered without crediting Engel or Bennett.
<!-- Instances of rediscoveryof Engel: Brown, Tilman -->
<!-- Instances of rediscovery of Bennett: The entire nutrition transition literature -->
<!-- Mischaracterizaton of Engel: Valin et al. -->
<!-- Mischaracterization of Bennett: Valin et al. (move toward fats and sugars) -->

Here I append a footnote to the discussion in order to address this apparent lack of familiarity with the origins and relevance of Bennett's and Engel's Laws. Drawing on the FAO Food Balance Sheets and the World Bank International Comparison Project, I present a brief graphical review of the laws, including an analysis of the laws' stability over time. [[I present a novel corrollary of Bennett's Law in terms of a fat-carbohydrate tradeoff frontier, and discuss implications for dietary transitions.]] I walk through an example of how the laws can be used for parsimonious, back-of-the-envelope projections of future food demand and composition. [[The estimate for 2050 is in line with the projections of various models and with FAO's expert assessment [], but considerably less than a much cited estimate by Tilman et al. [], which was also based on a parsimonious application of Engel's Law.]]

[[The data suggest that Engel's and Bennett's Laws are two instances of a broad class of consumption-income laws covering most food and non-food commodities.]] I propose a thoeretical explanation of Bennett's and Engel's as consequences of a single overarching law---the Law of Diminishing Marginal Utility---which potentially sheds light on the economic meaning of the law's parameters, the circumstances under which the parameter values may change, and why Bennett's and Engel's Laws have remained relatively popular compared to analogous laws for other food and non-food goods.

Finally, I present a new empirical law that appears to have gone unnoticed until now: a log-linear relation between a commodity's expected price and its price volatility. This may serve to open up new perspectives on the role of price risk in food system resilience and nutritional security---a topic which has so far received little attention in the literature.


@stigler1954early
@clements2018engel
@theil1989international
@pope2012

-surprising lack of explicit reference to the laws in the nutrition transition literature. (although the laws figure centrally in the food demand modeling literature (although they are sometimes mischaracterized))
-mischaracterizations of Laws (esp. Engel in [valin])
-rediscovery of Laws without giving credit [Brown; Tilman]
-in the demand literature there is an insistence that Engel's Law is second order (elasticty changes with income), but this is true by construction (Florida PI); the data fit a double log form perfectly well.

  An important precursor to the modern discussion [@brown1963man] was less circumspect, but also neglected to indicate the origins of these empirical laws. It appears, moreover, that many donors, breeding programs, and academic researchers are simply unaware of the laws' existence. Tilman et al. [-@tilman2011global], for example, present what they believe to be a newly discovered empirical relation between income and calorie consumption. In fact, this relation was previously documented by Brown [-@brown1963man], and is probably best characterized as an alternative formulation of Engel's Law. Donors and international breeding programs, meanwhile, continue to focus resources on starchy crops in excess of what would be justified by Bennett's Law [@wiebe2020modeling; @finplan2018].
mention of Engel's Law: [@muhammad2011international]


<!-- I then propose a theoretical unification of the two laws by deriving them both from the same principle of diminishing returns to marginal increases in expenditures on inferior goods. -->
# What are empirical laws?

The word "law" connotes a binding, absolute character that is ill-suited to the social sciences. In this article, "empirical laws" (also referred to as "stylized facts") are meant to mean nothing more binding than observed historical tendencies. As Houthakker put it:

>"[Empirical] laws are in the first instance empirical regularities, which may originally have been observed without much theoretical basis.... A large part of the business of the empirical sciences is to develop theories within which already discovered laws have their place and new regularities can be explored" [@houthakker1992there].

The formulation of empirical laws is thus often the first step in a natural progression from a purely observational basis towards a theoretical basis for understanding. As it matures, the theoretical basis typically has the effect of unifying several diverse empirical laws in a single explanatory framework. In the physical sciences, Keppler's Laws, Pouseille's Law, Faraday's Law, and Hooke's Law were all first formulated as seemingly unrelated empirical laws. Only later were they shown to follow from a single theoretical framework (Newton's). This deepened understanding of both the empirical laws and the theory itself. Again, in Houthakker's words,

>"By linking...laws to other phenomena the theories give meaning to the laws, for a mere empirical regularity conveys only limited credibility and cannot be extrapolated with much confidence. In their turn, the laws give significance to the theories that can account for them" [@houthakker1992there].

As a general rule, empirical laws are considerably messier in the social sciences, and efforts to establish unifying theoretical frameworks considerably less successful, than they are in the physical sciences. However, the basic process remains the same in any empirical science: to observe and document diverse empirical regularities, on the one hand; and, on the other, to propose credible axioms that generate a plausible, unifying explanation of the diversely observed regularities.

# Bennett's Law

>"The broad fact that variety rather than uniformity is characteristic of food consumption throughout the world is familiar and indisputable. Differences are found in the 'dishes' consumed from country to country, region to region, locality to locality, even family to family. Within a country or region, these differences appear also from one epoch to another. They are so prevalent and conspicuous, in fact, that it seems almost hopeless to discover, in the international sphere, some way of characterizing summarily the diets of different nations and contrasting them one with the other" [@bennett1941international].

Even within a fairly small geographical region of Africa, diets vary considerably (Figure \ref{fig:dietDiversity}). Nonetheless, Bennett found the "way of characterizing summarily the diets of different nations" he was looking for by examining the starchy calorie content of diets in relation to income.

```{r, fig.show = "hold", fig.width = 5, fig.height=4, fig.align="left", fig.cap="\\label{fig:dietDiversity}Diets are diverse. Source: Author's creation based on the FAO Food Balance Sheets (FBS).", echo = FALSE}
this_file <- "Bennetts Law FAO FBS and WDI data.csv"
df_bennett <- read.csv(this_file, stringsAsFactors = F)
df_bennett$Year <- as.integer(df_bennett$Year)
u <- colnames(df_bennett)
colnames(df_bennett) <- gsub("\\.\\.\\.", "), ", u)
u <- colnames(df_bennett)
colnames(df_bennett) <- gsub("P\\.c", "P/c", u)
u <- colnames(df_bennett)
colnames(df_bennett) <- gsub("\\.\\.", " (", u)
u <- colnames(df_bennett)
colnames(df_bennett) <- gsub("\\.", ")", u)
u <- colnames(df_bennett)
colnames(df_bennett) <- gsub("n\\)", "n ", u)
u <- colnames(df_bennett)
# colnames(df_bennett) <- gsub("\\.", " ", u)
# u <- colnames(df_bennett)
# colnames(df_bennett) <- gsub("s ", "s)", u)

# Slovakia an outlier with >50% fat share of diet. Rest of countries <44%
df_bennett <- subset(df_bennett, Area != "Slovakia")

df_diets <- df_bennett[, c("Area", "Year", "Element", "Item", "Value")]
df_diets <- subset(df_diets, Element == "Food supply (kcal/capita/day)" &
                     !(Item %in% c("Animal fats", "Meat")))
#unique(df_diets$Element)
#unique(df_diets$Item)
df_tot <- subset(df_diets[, c("Area", "Year", "Item", "Value")], Item == "Grand Total")
df_diets <- subset(df_diets, Item != "Grand Total")
colnames(df_tot)[which(colnames(df_tot) == "Value")] <- "Total (kcal/capita/day)"
df_tot$Item <- NULL
df_diets$Item[grep("Cereals", df_diets$Item)] <- "Cereals"
df_diets$Item[grep("Sugar", df_diets$Item)] <- "Sugar\n& sweeteners"
df_diets$Item[grep("Animal", df_diets$Item)] <- "Animal\nproducts"
df_diets$Item[grep("Roots", df_diets$Item)] <- "Starchy\nroots"
df_diets$Item[grep("Fruit", df_diets$Item)] <- "Fruits\n& Vegetables"
df_diets$Item[grep("Veget", df_diets$Item)] <- "Fruits\n& Vegetables"
df_diets <- df_diets %>% 
  group_by(Area, Year, Item) %>%
  summarise(Value = sum(Value, na.rm = T)) %>% as.data.frame()
df_diets <- merge(df_diets, df_tot, by = c("Area", "Year"))
colnames(df_diets)[which(colnames(df_diets) == "Value")] <- "Food supply (kcal/capita/day)"
df_diets$`Share of daily diet` <- df_diets$`Food supply (kcal/capita/day)` / df_diets$`Total (kcal/capita/day)`
df_other <- df_diets %>% group_by(Area, Year, `Total (kcal/capita/day)`) %>%
  summarise(`Share of daily diet` = sum(`Share of daily diet`, na.rm = T)) %>% as.data.frame()
df_other$`Share of daily diet` <- 1 - df_other$`Share of daily diet`
df_other$`Food supply (kcal/capita/day)` <- df_other$`Share of daily diet` * df_other$`Total (kcal/capita/day)`
df_other$Item <- "Other"
df_other <- df_other[, colnames(df_diets)]
df_diets <- rbind(df_diets, df_other)
#-----------------------------------------------------------------------------
area_vec <- c("Kenya", "Uganda", "Ethiopia", "Tanzania", "Rwanda")
df_plot <- subset(df_diets, Area %in% area_vec &
                    Year > 1992)
yr_min <- min(df_plot$Year)
yr_max <- max(df_plot$Year)
n <- length(unique(df_plot$Item))
bag_of_colors <- randomcoloR::distinctColorPalette(k = 2 * n)
color_vec <- sample(bag_of_colors, n)
#good_colors <- c("#B346E2", "#74B4D0", "#E16953", "#D6E1D8", "#C7E84D", "#6BE47C", "#E4B64D")
# c("#D6A5D7" "#7EB0DD" "#E0AF9B" "#85E1DC" "#727AD6" "#DA74DA" "#729381" "#DB6A4A")
#color_vec <- good_colors
df_plot <- df_plot %>% group_by(Area, Item) %>%
  mutate(mu_food_area_item = mean(`Share of daily diet`, na.rm = T)) %>%
  as.data.frame()
df_plot$Item <- factor(df_plot$Item,
                       levels = unique(df_plot$Item[order(df_plot$mu_food_area_item, df_plot$Item, decreasing = T)]),
                       ordered = T)
gg <- ggplot(df_plot, aes(x = Year, y = `Share of daily diet`, fill = Item))
gg <- gg + geom_area(position = "stack")
gg <- gg + scale_x_continuous(breaks = seq(yr_min, yr_max, length.out = 4))
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + facet_wrap(~Area, ncol = 3)
gg <- gg + theme(legend.title = element_blank(),
                 legend.text = element_text(size = 7),
                 legend.key.size = unit(0.3, "cm"),
                 strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                 axis.title.x = element_blank(),
                 axis.title.y = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size))
gg <- gg + guides(fill = guide_legend(nrow = 4, byrow = T))
gg <- shift_legend2(gg)
gg <- ggplotify::as.ggplot(gg)


```

Bennett did not have the advantage of the FAO Food Balance Sheets at his disposal, and so had to painstakingly assemble his data from diverse sources. Having done so for 34 countries, he noticed that the cereal and starchy root content of diets varied widely across countries---from 30% to 90%. And he noticed that this percentage tended to be greater in countries where incomes were relatively low. After considering a number of alternative explanations for the variation such as climate, preference, and religious taboo, he concluded that "explanation of the differences in the degree of dependence on cereal-potato calories is to be found chiefly in the relative economic status of nations or of families". And, more specifically, "irregularities and exceptions [aside], a rough inverse relation between level of income and dependence upon cereal-potato calories seems to exist and to have a rational causal basis, whether comparisons refer to families, localities, or nations" [@bennett1941international]. (Bennett used "potato" as a shorthand for "starchy roots and tubers" in general. In this article, I follow FAO in using "starchy roots" as the shorthand.)

Bennett presented this finding not in terms of a regression analysis or a scatterplot of country income against country cereal and starchy root intake, but rather as a world map, with the 34 countries for which he had data shaded according to their respective cereal and starchy root intake. In subsequent work, he extended this to 52 countries, and presented results in a bar chart [@bennett1941wheat]. Drawing on FAO's Food Balance Sheets, it is now possible to extend Bennett's analysis to anywhere between 144 and ...?170 countries, depending upon the year of analysis. A scatterplot of logged country cereal and starchy root intake against logged country income (GDP in USD at the market exchange rate) for 2017 in Figure \ref{fig:Bennett01} confirms the inverse relation he documented. This empirical relation, now known as Bennett's Law, indicates that, regardless of differences in culture, climate, and preference, cereals and starchy roots constitute a declining portion of the diet as income rises. [Bennett's Law can also be approximated using the World Bank's International Comparison Project (ICP) data, by combining the "bread and cereals " with the "vegetable" category.]

<!-- "All over the world, the important groups of foods may be classified as (1) cereals and "potatoes" ; (2) sugars; (3) vegetable oils; (4) fruits, nuts, legumes, and relatively non-starchy and leafy vegetables; and (5) meats, animal fats, dairy products, eggs, and fish. Of these five groups, the first and second are rich in carbohydrate calories, but relatively poor in proteins, certain vitamins, and cer-tain minerals. The third, vegetable oils, are rich in fat but again not in proteins, vitamins, or minerals. The so-called protective foods are usually those found in the fourth and fifth groups, and the fifth group is a major source of the better proteins" [@bennett1941wheat]. -->
<!-- "The indicator is a very rough one. Hypothetically, of two nations each deriving 50 per cent of its total calories from cereals and potatoes, one of the nations might conceivably derive the remainder of its total calories from sugars and vegetable oils. In this case the diet would be qualitatively poor. The other na-tion might derive the remainder of its calories from meats, milk, leafy vegetables, fruits, and nuts. In this case the diet would be qualitatively good" [@bennett1941wheat]. -->
<!-- Food balance data  provide  information  about  a  country's  average  percapita dietary energy supply, which indicates the amount offood available for human consumption in the country. This isa  measure  of  food  production,  taking  account  of  importsminus  exports, losses  for  animal  feed, wastage  and  millingextraction rates. It ignores food lost at the retail and house-hold  level  and  is  an  approximation  of  average  intake.  Ingeneral,  this  is  approximately  10-14%  above  actual  foodavailable  for  intake  at  the  household  level [@popkin1993nutritional],  but  the  overallstructure of diet is remarkably similar to that seen with foodbalance data. -->

<!-- FBSs are constructed by the FAO from nationalaccounts of the supply and use of foods, and are calcu-lated from the food produced in and imported intocountries minus the food exported net of imports,fed to animals or otherwise not available for humanconsumption, divided by the population size. FBSdata provide information about average availabilityper person, that is they relate simply to the quantitiesof food reaching the consumer (i.e. a measure ofavailability). FBSs, while describing consumption offoods per capita of the population for a country, donot represent the amount of food actually consumedand will almost invariably result in an overestimationin food consumption compared with dietary surveysat the individual level (Serra-Majemet al. 2003).This point is also clearly illustrated in another driverreview (Hawkesworthet al. 2010). -->
<!-- [@serra2003comparative; @hawkesworth2010feeding] -->

```{r, fig.show = "hold", fig.width = 6, fig.height=4, fig.align="center", fig.cap="\\label{fig:BennettsLaw}(Left) Bennett's Law fitted to 2017 FBS data. GDP is expressed in USD at constant 2015 prices. (Right) Trajectory of the slope and y intercept parameters of Bennett's Law, 1970-2017. The trajectory of sample size and model fit (adjusted R-squared) are also indicated.", echo = FALSE}
# 4 calories in a gram of protein or carbohydrate, 9 calories in a gram of fat.
# https://www.nal.usda.gov/fnic/how-many-calories-are-one-gram-fat-carbohydrate-or-protein
#===========================================================================
# Bennett's Law
# Create data set for all food categories.
#colnames(df_bennett)
gdpPop_vars <- c("GDP/capita (USD), logged", "GDP (million USD)", "Population (millions)")
these_cols <- c("Area", "Year", "Region", "Element",
                "Item", "Value", gdpPop_vars)
# these_items <- c("Cereals - Excluding Beer", "Starchy Roots",
#                  "Grand Total")
exclude_items <- c("Animal fats", "Meat")
#unique(df_bennett$Item)
#setdiff(these_cols, colnames(df_bennett))
df_foodShare <- subset(df_bennett[, these_cols], !(Item %in% exclude_items) &
                    Element == "Food supply (kcal/capita/day)")

df_tot <- subset(df_foodShare[, c("Area", "Year", "Item", gdpPop_vars, "Value")], Item == "Grand Total")

df_tot$Item <- NULL
colnames(df_tot)[ncol(df_tot)] <- "Total (kcal/capita/day)"
df_foodShare <- subset(df_foodShare, Item != "Grand Total")
df_foodShare$Item[grep("Cereals|Starchy", df_foodShare$Item)] <- "Cereals & starchy roots"
df_foodShare$Item[grep("Fruits|Vegetables", df_foodShare$Item)] <- "Fruits & vegetables"
df_foodShare$Item[grep("Animal Products", df_foodShare$Item)] <- "Animal products"
df_foodShare$Item[grep("Sugar", df_foodShare$Item)] <- "Sugar & sweeteners"
df_foodShare <- df_foodShare %>% 
  group_by(Region, Area, Year, Item) %>%
  summarise(Value = sum(Value, na.rm = T)) %>% as.data.frame()
#---
df_foodShare <- merge(df_foodShare, df_tot, by = c("Area", "Year"))
colnames(df_foodShare)[which(colnames(df_foodShare) == "Value")] <- "Diet share (kcal/capita/day)"
df_foodShare$`Diet share (%)` <- 100 * df_foodShare$`Diet share (kcal/capita/day)` /
  df_foodShare$`Total (kcal/capita/day)`
df_foodShare$`Diet share (%), logged` <- 
  log(df_foodShare$`Diet share (%)`)
df_foodShare$`Diet share (kcal/capita/day), logged` <- 
  log(df_foodShare$`Diet share (kcal/capita/day)`)
#-----------------------------------------------------------------------------
# Highlight some countries in plot
# label_Africa <- c("Tanzania", "Uganda", "Ethiopia", "South Africa",
#                   "Ghana")
# label_NAfricaWAsia <- c("Turkey", "Saudi Arabia")
# label_Asia <- c("India", "Iran", "China, mainland", "Vietnam", "Japan",
#                 "South Korea")
# label_NAmEurAusNZ <- c("Italy", "France", "Australia")
# label_LAC <- c("Nicaragua", "Colombia", "Brazil")
# labelThese_vec <- c(label_Africa, label_NAfricaWAsia, label_Asia,
#                     label_NAmEurAusNZ, label_LAC)

# label_Africa <- c("Uganda", "South Africa")
# label_NAfricaWAsia <- c("Turkey", "Saudi Arabia")
# label_Asia <- c("India", "China, mainland", "Vietnam")
# label_NAmEurAusNZ <- c("France", "Australia")
# label_LAC <- c("Nicaragua", "Colombia", "Brazil")
# labelThese_vec <- c(label_Africa, label_NAfricaWAsia, label_Asia,
#                     label_NAmEurAusNZ, label_LAC)
# df_foodShare$label_these <- NA
# u <- df_foodShare$Area
# df_foodShare$label_these[which(u %in% labelThese_vec)] <- df_foodShare$Area[which(u %in% labelThese_vec)]
#-----------------------------------------------------------------------------
# Subset data for just cereals and starchy roots
df_plot <- subset(df_foodShare, Item == "Cereals & starchy roots" &
                     Year == 2017 & Region != "Aggregated")
colnames(df_plot) <- gsub("Diet share", "Cereals & starchy roots", colnames(df_plot))
colnames(df_plot) <- gsub("%", "% of diet", colnames(df_plot))
#-----------------------------------------------------------------------------
# Fit parameters
mod <- lm(`Cereals & starchy roots (% of diet), logged` ~ `GDP/capita (USD), logged`, data = df_plot)
#summary(mod)
#plot(mod$fitted.values, mod$residuals)
#ind_rm <- which(mod$residuals == min(mod$residuals))
#df_plot$Area[ind_rm]
m <- round(mod$coefficients[2], 4)
b <- round(mod$coefficients[1], 4)
df_out <- as.data.frame(broom::glance(mod))
adjR2 <- round(df_out$adj.r.squared, 2)
sampleSize2017 <- df.residual(mod)
#-----------------------------------------------------------------------------
# Get colors for region groupings and title
n <- length(unique(df_plot$Region))
bag_of_colors <- randomcoloR::distinctColorPalette(k = 2 * n)
color_vec <- sample(bag_of_colors, n)
this_subtitle <- paste0("2017", "N = ", sampleSize2017, ", Adj. R-squared = ", adjR2, "\nSlope = ", m, ", Y intercept = ", b)
#-----------------------------------------------------------------------------
gg <- ggplot(df_plot, aes(x = `GDP/capita (USD), logged`,
                          y = `Cereals & starchy roots (% of diet), logged`,
                          group = Region, fill = Region,
                          shape = Region))#,
                          #label = label_these))
gg <- gg + geom_smooth(aes(group = NULL, fill = NULL, shape = NULL), method = lm, se = F)
gg <- gg + geom_point(alpha = 0.6, size = point_size, color = "black", stroke = 0.5)
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
#gg <- gg + geom_text_repel(color = "black", size = label_size)
gg <- gg + labs(title = "Bennett's Law", subtitle = this_subtitle)#,
gg <- gg + guides(fill = guide_legend(nrow = 2, byrow = T, override.aes = list(linetype = 0)),
                  color = guide_legend(override.aes = list(linetype = 0)))
gg <- gg + theme(legend.position = "bottom",
                  legend.spacing.x = unit(0.25, 'cm'),
                  legend.title = element_blank(),
                 legend.text = element_text(size = legendText_size),
                 plot.title = element_text(size = title_size),
                 plot.subtitle = element_text(size = subtitle_size),
                 axis.title = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size))
gg_bennett <- gg
#ggsave("Bennetts Law 2017 FAO.png", width = 4, height = 4, units = "in")

#---------------------------------------------------------------------------
these_cols <- c("Area", "Year", "Region", "Item", "Diet share (%), logged",
                gdpPop_vars)
df_cerRootShare <- subset(df_foodShare, Item == "Cereals & starchy roots")
u <- colnames(df_cerRootShare)
colnames(df_cerRootShare) <- gsub("Diet share", "Cereals & starchy roots", u)
u <- colnames(df_cerRootShare)
colnames(df_cerRootShare) <- gsub("%", "% of diet", u)
df_cerRootShare$Item <- NULL
df_params <- df_cerRootShare
df_params <- subset(df_params, Region != "Aggregated")
yr_vec <- unique(df_params$Year)
n_yrs <- length(yr_vec)
mBennett_vec <- c()
bBennett_vec <- c()
adjR2Bennett_vec <- c()
NBennett_vec <- c()
for(i in 1:n_yrs){
  this_year <- yr_vec[i]
  this_df <- subset(df_params, Year == this_year)
  this_df$Year <- NULL
  #---------------------------------------------------
  mod <- lm(`Cereals & starchy roots (% of diet), logged` ~ `GDP/capita (USD), logged`, this_df)
  mBennett_vec[i] <- round(mod$coefficients[2], 6)
  bBennett_vec[i] <- round(mod$coefficients[1], 6)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2Bennett_vec[i] <- df_out$adj.r.squared
  NBennett_vec[i] <- length(mod$fitted.values)

}
#---------------------------------------------------------------------------
# Get slope range for text
ind <- which(yr_vec >= 1980)
mBen_min <- round(min(mBennett_vec[ind]), 3)
mBen_max <- round(max(mBennett_vec[ind]), 3)
#---------------------------------------------------------------------------
df_plotBennett <- data.frame(Year = yr_vec, Slope = mBennett_vec, bBennett_vec, adjR2Bennett_vec, NBennett_vec)
colnames(df_plotBennett)[3:5] <- c("Y intercept", "Adj. R-squared", "Sample size")
df_plotBennett$Year <- as.integer(as.character(df_plotBennett$Year))


df_plot <- df_plotBennett %>% gather(Type, Value, Slope:`Sample size`)
gg <- ggplot(df_plot, aes(x = Year, y = Value))
gg <- gg + geom_line()
# gg <- gg + scale_x_continuous(breaks = seq(yr_vec[1], yr_vec[n_yrs - 1], length.out = 24))
gg <- gg + facet_wrap(~Type, ncol = 1, scales = "free_y")
gg <- gg + labs(subtitle = "Bennet's Law parameter trajectory, 1970-2017")
gg <- gg + theme(axis.title = element_blank(),
                  #axis.text.x = element_text(angle = 60, hjust = 1),
                  strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                plot.title = element_text(size = title_size),
                plot.subtitle = element_text(size = subtitle_size),
                axis.text = element_text(size = axisText_size))
gg_bennettStab <- gg
#----------------------------------------------------------------------------
gg_bennett + gg_bennettStab + plot_layout(ncol = 2, guides = "collect") & theme(legend.position = 'bottom')

```
The double log formulation of Bennett's Law fits the FBS data well, especially since 1980; and the fitted parameters have remained remarkably stable over this period, ranging narrowly from `r mBen_min` to `r mBen_max` (Figure \ref{fig:BennettsLaw}, right panel).

Bennett did not have the data necessary to answer the question of what replaces starchy staple calories as incomes rise. Considering that starchy staples are generally deficient in proteins and some key vitamins and minerals, he was tempted to interpret the starch share of diet as an inverse measure of the "relative qualitative adequacy of national diets" []. However, he acknowledged that

>"[t]he indicator is a very rough one. Hypothetically, of two nations each deriving 50 per cent of its total calories from cereals and potatoes, one of the nations might conceivably derive the remainder of its total calories from sugars and vegetable oils. In this case the diet would be qualitatively poor. The other nation might derive the remainder of its calories from meats, milk, leafy vegetables, fruits, and nuts. In this case the diet would be qualitatively good" [@bennett1941wheat].

Two influential works of the food crisis literature picked up this question again in the 1960s, rediscovering Bennett's Law in the process (without citing Bennett) [Brown;Priesse]. The modern discussion of nutrition transitions then picked up the topic again from the 1990s onwards. A review of the seminal works and surveys of this literature likewise turns up no mention of Bennett, although his discovery forms its implicit motivating basis [@popkin1993nutritional; @drewnowski1997nutrition; @kearney2010food; @popkin2012global].

Numerous studies of future food demand, on the other hand, do mention Bennett [@valin2014future; @cirera2010income; @bodirsky2015global; @gouel2019nutrition; @timmer1983food]. In this literature, Bennett's Law is sometimes characterized as a dietary shift towards animal products as incomes rise [@valin2014future; @bodirsky2015global]. Again, Bennett himself defined the relation exclusively in terms of a dietary shift _away_ from starchy cereals and roots, not as a shift _towards_ any particular food group. He did not have the data necessary to answer the question of what replaces starchy staples as incomes rise.
<!-- Bennett's Law characterized as ...towards "a more diverse diet that includes alarger share of animal protein and fats and oils" [@valin2014future].  -->
<!-- However, this not found in the Mahammed et al. study. The Florida PI model fails to reproduce this [@muhammad2011international]. -->


Thanks to the FAO FBS data, it is now clear that the former of Bennett's two hypothetical nations is closer to the true trajectory of most nations moving from low and middle income to upper income status. Starchy carbohydrate calories are replaced primarily by fat calories (of vegetable or animal origin), sugary carbohydrates, and other sweeteners [@kearney2010food;]. 

the clear cut relation between diet share and income that Bennett observed for cereals and starchy roots does not hold for the other main food groups, with the possible exception of animal products (Figure ...).

Another approach is to look at macronutrients (Figure ... fat-carb frontier)

<!-- "protective foodstuffs rich in high-quality proteins, mineral salts, and vitamins" -->
```{r, fig.show = "hold", fig.width = 5, fig.height=6, fig.align="center", fig.cap="\\label{fig:whatReplaces1}Relation between non-starchy food group dietary shares and GDP/capita, 2017 FBS data.", echo = FALSE}
df_plot <- subset(df_foodShare, Year == 2017 &
                    Region != "Aggregated")
gg <- ggplot(df_plot, aes(x = `GDP/capita (USD), logged`,
                          y = `Diet share (%), logged`,
                          group = Region, fill = Region,
                          shape = Region))#,
                          #label = label_these))
#gg <- gg + geom_smooth(aes(group = NULL, fill = NULL, shape = NULL), method = lm, se = F)
gg <- gg + geom_point(alpha = 0.6, size = point_size, color = "black", stroke = 0.5)
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
gg <- gg + facet_wrap(~Item, ncol = 3, scales = "free_y")
#gg <- gg + geom_text_repel(color = "black", size = label_size)
gg <- gg + guides(fill = guide_legend(nrow = 2, byrow = T, override.aes = list(linetype = 0)),
                  color = guide_legend(override.aes = list(linetype = 0)))
gg <- gg + theme(legend.position = "bottom",
                  legend.spacing.x = unit(0.25, 'cm'),
                  legend.title = element_blank(),
                 legend.text = element_text(size = legendText_size),
                 strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                 plot.title = element_text(size = title_size),
                 plot.subtitle = element_text(size = subtitle_size),
                 axis.title = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size))
gg
# gg <- shift_legend2(gg)
# gg <- ggplotify::as.ggplot(gg)



```

Dietary transitions may also be examined in terms of macronutrient shares. In this approach, food groups are conflated into one of three categories: carbohydrates, proteins, or fats; and the question is reduced to: "what replaces carbohydrate consumption as income rises?" This simplification thus comes at the cost of sacrificing fine distinctions between starchy carbohydrate and sugary or complex carbohydrate consumption, or distinctions between vegetable and animal fat and protein consumption, all of which are known to respond differently to increases in income [].

Brown [-@brown1963man] plotted FBS protein calorie intake data against GNP and concluded that "[p]rotein intake is quite responsive to income". However, this was subsequently contradicted by Perisse et al. [-@perisse1969effect], who implement a more meticulous method using the 1965 FBS data to find that fat intake is responsive to increases in income, while the protein share of diets remains constant at about 11% across all income levels. Popkin and Drewnowski [] later presented an update of Perisse et al.'s study using 1990 FBS data. Their analysis results in a somewhat lower estimated response of fat intake to income than that found by Perisse et al. The authors interpret this in rather strong terms, calling the lower slope "a major shift in the structure of the global diet marked by an uncoupling of the classic relationship between incomes and fat intakes". One might be misled by this into thinking that fat intake and income are no longer correlated from 1990 onwards. Such a conclusion would be self-contradictory. The authors' estimated parameters are statistically significant, which would not be the case if the independent and explanatory variables in their model were unrelated (or "uncoupled"). Moreover, the FBS data exhibit a clear correlation between fat intake and income both before and after 1990 (as for example in ... panel of Figure  \ref{fig:whatReplaces2}). The slope of the empirical relation may change, but the relation itself remains intact across all years.
<!-- A question remains as to how much of the carbohydrates are replaced by proteins and how much are replaced by fats, as income rises. Cursory exploration of the data suggests that the carbohydrates are replaced almost exclusively by fats (right panel, Figure \ref{fig:Bennett01}). Drewnowski and Popkin [-@drewnowski1997nutrition] dispute this, claiming that globalization has led to increased fat intake regardless of income level. While there may be some truth to their argument in an absolute sense, Figure \ref{fig:Bennett01} seems to suggest quite clearly that relative fat intake is still highly coupled with income level, despite "globalized diets". -->

<!--  The slope on the fat-carb frontier is nearly -1, which supports this finding (although the y intercept (~91%) implies a constant protein share of 9%, slightly lower than Perisse et al.'s estimate). Metabolically speaking, constant protein intake in the face of declining carbohydrate intake implies increased consumption of animal products.^[The increased fat intake also implies this to some degree, although not necessarily, since fats may be acquired from non-animal sources.] The often mentioned dietary transition to animal products that accompanies rising incomes and urbanization may thus be considered a corrollary of Bennett's Law. -->

```{r, fig.show = "hold", fig.width = 5, fig.height=5, fig.align="center", fig.cap="\\label{fig:whatReplaces2}(Left) Macronutrient Laws, 2017 FBS data. (Right) Slope and y intercept trajectories for the carbohydrate law, 1970-2017. The sample size and model fit (adjusted R-squared) are also indicated for each year.", echo = FALSE}

these_cols <- c("Area", "Region", "Year", "Element", "Item", "Value",
                "GDP/capita (USD)",
                "GDP/capita (USD), logged")
df_macnut <- subset(df_bennett[, these_cols], Item == "Grand Total" &
                      Region != "Aggregated")
df_macnut$Item <- NULL

# Convert g to kcal
df_macnut$Value[grep("Protein", df_macnut$Element)] <- 4 *
  df_macnut$Value[grep("Protein", df_macnut$Element)]
df_macnut$Value[grep("Fat", df_macnut$Element)] <- 9 *
  df_macnut$Value[grep("Fat", df_macnut$Element)]
df_macnut$Element[grep("Protein", df_macnut$Element)] <- "Protein supply (kcal/capita/day)"
df_macnut$Element[grep("Fat", df_macnut$Element)] <- "Fat supply (kcal/capita/day)"
# Calculate carb kcal
df_macnut <- df_macnut %>% spread(Element, Value)
df_macnut$`Carb supply (kcal/capita/day)` <- df_macnut$`Food supply (kcal/capita/day)` -
  df_macnut$`Protein supply (kcal/capita/day)` - df_macnut$`Fat supply (kcal/capita/day)`
# Create % of diet variable
df_tot <- df_macnut[, c("Area", "Year", "Food supply (kcal/capita/day)")]
df_macnut$`Food supply (kcal/capita/day)` <- NULL
gathercols <- colnames(df_macnut)[6:ncol(df_macnut)]
df_macnut <- df_macnut %>% gather_("Item", "Value", gathercols)
df_macnut$Item[grep("Protein", df_macnut$Item)] <- "Protein"
df_macnut$Item[grep("Fat", df_macnut$Item)] <- "Fat"
df_macnut$Item[grep("Carb", df_macnut$Item)] <- "Carbohydrate"
df_macnut <- merge(df_macnut, df_tot, by = c("Area", "Year"))
colnames(df_macnut)[7:8] <- c("Supply (kcal/capita/day)", "Total (kcal/capita/day)")
df_macnut$`Diet share (%)` <- 100 * df_macnut$`Supply (kcal/capita/day)` / df_macnut$`Total (kcal/capita/day)`
df_macnut$`Diet share (%), logged` <- log(df_macnut$`Diet share (%)`)
df_macnut$`Supply (kcal/capita/day), logged` <- log(df_macnut$`Supply (kcal/capita/day)`)
#---------------------------------------------------------------------------
# Plot macronutrient vs GDP/capita
df_plot <- subset(df_macnut, Year == 2017 & Region != "Aggregated")

these_items <- unique(df_plot$Item)
facet_labels <- c()
adjR2_vec <- c()
for(i in 1:length(these_items)){
  this_item <- these_items[i]
  this_df <- subset(df_plot, Item == this_item)
  mod <- lm(`Diet share (%), logged` ~ `GDP/capita (USD), logged`, this_df)
  #mod <- lm(`Supply (kcal/capita/day), logged` ~ `GDP/capita (USD), logged`, this_df)
  #summary(mod)
  #plot(mod$fitted.values, mod$residuals)
  m <- round(mod$coefficients[2], 4)
  b <- round(mod$coefficients[1], 4)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2 <- round(df_out$adj.r.squared, 2)
  N <- df.residual(mod)
  this_facet_label <- paste0(this_item, " kcals", "\nAdj. R-squared = ", adjR2, ", Slope = ", m, ", Y intercept = ", b)
  facet_labels[i] <- this_facet_label
  adjR2_vec[i] <- adjR2
  
}
sampleSize2017 <- N
names(facet_labels) <- these_items
this_subtitle <- paste("2017, N =", sampleSize2017)

gg <- ggplot(df_plot, aes(x = `GDP/capita (USD), logged`,
                          y = `Diet share (%), logged`,
                          #y = `Supply (kcal/capita/day), logged`,
                          group = Region, fill = Region,
                          shape = Region))
gg <- gg + geom_smooth(aes(group = NULL, fill = NULL, shape = NULL), method = lm, se = F)
gg <- gg + geom_point(alpha = 0.6, color = "black", stroke = 0.5)
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
gg <- gg + labs(title = "Macronutrient Laws", subtitle = this_subtitle)
gg <- gg + facet_wrap(~Item, ncol = 1, scales = "free_y",
                      labeller = labeller(Item = facet_labels))
gg <- gg + theme(legend.position = "bottom",
                  legend.spacing.x = unit(0.25, 'cm'),
                  legend.title = element_blank(),
                 legend.text = element_text(size = legendText_size),
                 strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                 plot.title = element_text(size = title_size),
                 plot.subtitle = element_text(size = subtitle_size),
                 axis.title = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size))
gg <- gg + guides(fill = guide_legend(#nrow = 2,
  override.aes = list(linetype = 0)),
  color = guide_legend(override.aes = list(linetype = 0)))
# gg <- shift_legend2(gg)
# gg <- ggplotify::as.ggplot(gg)
gg_macnut <- gg

#---------------------------------------------------------------------------
df_carb <- subset(df_macnut, Item == "Carbohydrate")
u <- colnames(df_carb)
colnames(df_carb) <- gsub("Supply", "Carbohydrates", u)

df_params <- subset(df_carb, Region != "Aggregated")
yr_vec <- unique(df_params$Year)
n_yrs <- length(yr_vec)
mCarb_vec <- c()
bCarb_vec <- c()
adjR2Carb_vec <- c()
NCarb_vec <- c()
for(i in 1:n_yrs){
  this_year <- yr_vec[i]
  this_df <- subset(df_params, Year == this_year)
  this_df$Year <- NULL
  #---------------------------------------------------
  mod <- lm(`Diet share (%), logged` ~ `GDP/capita (USD), logged`, this_df)
  mCarb_vec[i] <- round(mod$coefficients[2], 6)
  bCarb_vec[i] <- round(mod$coefficients[1], 6)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2Carb_vec[i] <- df_out$adj.r.squared
  NCarb_vec[i] <- df.residual(mod)
  #NCarb_vec[i] <- length(mod$fitted.values)

}
#----------------------------------------------------------------------------
# Get max and min Carb Law slope for text
ind <- which(yr_vec >= 1980)
mCarb_min <- round(min(mCarb_vec[ind]), 3)
mCarb_max <- round(max(mCarb_vec[ind]), 3)
#----------------------------------------------------------------------------
df_plotCarb <- data.frame(Year = yr_vec, Slope = mCarb_vec, bCarb_vec, adjR2Carb_vec, NCarb_vec)
colnames(df_plotCarb)[3:5] <- c("Y intercept", "Adj. R-squared", "Sample size")
df_plotCarb$Year <- as.integer(as.character(df_plotCarb$Year))

df_plot <- df_plotCarb %>% gather(Type, Value, Slope:`Sample size`)

gg <- ggplot(df_plot, aes(x = Year, y = Value))
gg <- gg + geom_line()
# gg <- gg + scale_x_continuous(breaks = seq(yr_vec[1], yr_vec[n_yrs - 1], length.out = 24))
gg <- gg + facet_wrap(~Type, ncol = 1, scales = "free_y")
gg <- gg + labs(subtitle = "Carbohydrate Law parameter trajectory, 1970-2017")
gg <- gg + theme(axis.title = element_blank(),
                  #axis.text.x = element_text(angle = 60, hjust = 1),
                  strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                plot.title = element_text(size = title_size),
                plot.subtitle = element_text(size = subtitle_size),
                axis.text = element_text(size = axisText_size))
gg_carbStab <- gg
#---------------------------------------------------------------------------
gg_macnut + gg_carbStab + plot_layout(ncol = 2, guides = "collect") & theme(legend.position = 'bottom')

```

The fit for fat and protein kcals does not quite qualify as a law, but the carbohydrate law exhibits a good fit, especially over the period 1980-2017. As with Bennett's Law, the parameter values exhibit stability over this period. The slope, which may be interpreted as the income elasticity of carbohydrate demand, ranges narrowly between `r mCarb_min` and `r mCarb_max`.

```{r, fig.show = "hold", fig.width = 4, fig.height=4, fig.align="center", fig.cap="\\label{fig:fatCarbFront}(Left) The fat-carb frontier, 2017 FBS data. The size of the points are congruent with GDP/capita, which is expressed in USD at constant 2015 prices. Grams are converted to calories assuming a ratio of 4 calories per gram of protein or carbohydrate, and 9 calories per gram of fat, in accordance with U.S. Dept. of Agriculture guidelines. (Right) Fat carb frontier slope and y intercept trajectory, 1970-2017. The sample size and model fit (adjusted R-squared) are also indicated.", echo = FALSE}

# Fat-carb frontier
df_macnutShare <- df_macnut[, c("Area", "Region", "Item", "Year", "Diet share (%)", "GDP/capita (USD)")]
df_macnutShare <- df_macnutShare %>% spread(Item, `Diet share (%)`)
# Get parameters
df_mod <- subset(df_macnutShare, Year == 2017 & Region != "Aggregated")
mod <- lm(`Fat`~`Carbohydrate`, df_mod)
#summary(mod)
m <- round(mod$coefficients[2], 4)
b <- round(mod$coefficients[1], 4)
df_out <- as.data.frame(broom::glance(mod))
adjR2 <- round(df_out$adj.r.squared, 2)
  sampleSize2017 <- df.residual(mod)
this_subtitle <- paste0("2017, N = ", sampleSize2017, ", Adj. R-squared = ", adjR2, ", Slope = ", m, ", Y intercept = ", b)
#Plot
colnames(df_macnutShare)[5:7] <- paste(colnames(df_macnutShare)[5:7], "(% of diet)")

df_plot <- subset(df_macnutShare, Year == 2017 & Region != "Aggregated")
#---
# df_plot$label_these <- NA
# u <- df_plot$Area
# df_plot$label_these[which(u %in% labelThese_vec)] <- df_plot$Area[which(u %in% labelThese_vec)]
#---

gg <- ggplot(df_plot, aes(x = `Carbohydrate (% of diet)`,
                          y = `Fat (% of diet)`,
                          group = Region, fill = Region,
                          shape = Region, size = `GDP/capita (USD)`))#,
                          #label = label_these))
gg <- gg + geom_point(alpha = 0.6, color = "black", stroke = 0.5)
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
gg <- gg + labs(title = "The fat-carb frontier", subtitle = this_subtitle)
gg <- gg + geom_smooth(aes(group = NULL, fill = NULL, shape = NULL), method = lm, se = F)
#gg <- gg + geom_text_repel(color = "black", size = label_size)
gg <- gg + theme(legend.position = "none",
                legend.spacing.x = unit(0.25, 'cm'),
                legend.title = element_blank(),
                legend.text = element_text(size = legendText_size),
                plot.title = element_text(size = title_size),
                plot.subtitle = element_text(size = subtitle_size),
                axis.title = element_text(size = axisTitle_size),
                axis.text = element_text(size = axisText_size))
gg <- gg + guides(fill = guide_legend(nrow = 2, byrow = T, override.aes = list(linetype = 0)),
                  color = guide_legend(override.aes = list(linetype = 0)),
                  size = F)
gg_fatcarb <- gg
#ggsave("FatCarbFrontier2017.png", width = 4, height = 4, units = "in")
#===========================================================================
#===========================================================================
# df_params <- df_macnutShare[, c("Year", "Carb share of diet (%), logged",
#                             "GDP / capita (USD), logged")]
# df_params <- df_params[which(!is.na(df_params$`Carb share of diet (%), logged`)), ]
these_cols <- c("Area", "Region", "Year", "Carbohydrate (% of diet)", "Fat (% of diet)")
df_macnutShare <- df_macnutShare[, these_cols]
df_params <- subset(df_macnutShare, Region != "Aggregated")
yr_vec <- unique(df_params$Year)
n_yrs <- length(yr_vec)
mFatCarb_vec <- c()
bFatCarb_vec <- c()
adjR2FatCarb_vec <- c()
NFatCarb_vec <- c()
for(i in 1:n_yrs){
  this_year <- yr_vec[i]
  this_df <- subset(df_params, Year == this_year)
  this_df$Year <- NULL
  #---------------------------------------------------
  mod <- lm(`Fat (% of diet)` ~ `Carbohydrate (% of diet)`, this_df)
  mFatCarb_vec[i] <- round(mod$coefficients[2], 6)
  bFatCarb_vec[i] <- round(mod$coefficients[1], 6)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2FatCarb_vec[i] <- df_out$adj.r.squared
  NFatCarb_vec[i] <- df.residual(mod)

}

df_plotFatCarb <- data.frame(Year = yr_vec, Slope = mFatCarb_vec, bFatCarb_vec, adjR2FatCarb_vec, NFatCarb_vec)
colnames(df_plotFatCarb)[3:5] <- c("Y intercept", "Adj. R-squared", "Sample size")
df_plotFatCarb$Year <- as.integer(as.character(df_plotFatCarb$Year))

df_plot <- df_plotFatCarb %>% gather(Type, Value, Slope:`Sample size`)

gg <- ggplot(df_plot, aes(x = Year, y = Value))
gg <- gg + geom_line()
# gg <- gg + scale_x_continuous(breaks = seq(yr_vec[1], yr_vec[n_yrs - 1], length.out = 24))
gg <- gg + facet_wrap(~Type, ncol = 1, scales = "free_y")
gg <- gg + labs(subtitle = "Fat-carb frontier parameter trajectory")
gg <- gg + theme(axis.title = element_blank(),
                  #axis.text.x = element_text(angle = 60, hjust = 1),
                  strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                plot.title = element_text(size = title_size),
                plot.subtitle = element_text(size = subtitle_size),
                axis.text = element_text(size = axisText_size))
gg_fatcarbStab <- gg
#---------------------------------------------------------------------------
gg_fatcarb + gg_fatcarbStab + plot_layout(ncol = 2, guides = "collect") & theme(legend.position = 'bottom')
#---------------------------------------------------------------------------
# Get fat-carb frontier slope range for text
ind <- which(yr_vec >= 1980)
mFatCarb_min <- round(min(mFatCarb_vec[ind]), 4)
mFatCarb_max <- round(max(mFatCarb_vec[ind]), 4)
mFatCarb_mu <- round(mean(mFatCarb_vec[ind]), 4)
bFatCarb_mu <- round(mean(bFatCarb_vec[ind]), 4)
#---------------------------------------------------------------------------

```

A cleaner picture of the macronutrient transition is obtained by plotting carbohydrate diet shares against fat shares, as in Figure \ref{fig:fatCarbFront}. This is the best fitting and most stable empirical law yet considered. Again, the best fit occurs over the period 1980-2017. The slope over this period, which may be considered the marginal change in the fat share of diet given a marginal change in the carbohydrate share, ranges narrowly from `r mFatCarb_min` to `r mFatCarb_max`.

A country's fat share of diet $x_f$ is thus related to its carbohydrate share $x_c$ by the following equation.

\begin{equation}
x_f \approx `r mFatCarb_mu` x_c + `r bFatCarb_mu`
\label{eq:fatCarbRelation}
\end{equation}

where the slope and y intercept values are the mean since 1980.

This implies a marginal increase of `r -mFatCarb_mu` in the fat share per marginal decrease in the carbohydrate share. The implicit marginal increase in the protein share $x_p$ can then be found by considering that

\begin{equation}
x_c + x_f + x_p = 100
\end{equation}

Substituting equation \ref{eq:fatCarbRelation} into this expression and differentiating with respect to $x_c$ then gives a marginal increase in the protein share of about `r -mFatCarb_mu - 1` per marginal decrease in the carbohydrate share ($\frac{\partial x_p}{\partial x_c}$).
<!-- \begin{equation} -->
<!-- \frac{\partial x_p}{\partial x_c} \approx -\alpha - 1 = `r -m - 1` -->
<!-- \end{equation} -->

The fat-carb frontier thus suggests that there is a net positive change in the protein share of diet as the carbohydrate share decreases, albeit a very slight one compared to the corresponding increase in the fat share.

Popkin and Drewnowski have argued that, from 1990 onwards, the "classical" view was no longer valid: Fat intake had come "uncoupled" from income, thanks to newly available vegetable fats that are affordable at all income levels [-@drewnowski1997nutrition]. Figures ... and ... suggest, to the contrary, that fat intake is still correlated with income.

<!-- ## Stability over time -->

Both Bennett's Law and the fat-carb frontier have fit the data well across time, especially since 1980 (Figure \ref{fig:BennettStability}). Over the period of best fit (1980-2017), the slope of Bennett's Law has ranged narrowly between `r minSlopeBennett` and `r maxSlopeBennett`, while the slope of the fat-carb frontier has also ranged narrowly between `r minSlopeFatcarb` and `r maxSlopeFatcarb`.
<!-- The animations provided in the supplemental materials offer further visual confirmation of this stability. -->

```{r, fig.show = "hold", fig.width = 5, fig.height=4, fig.align="center", fig.cap="\\label{fig:BennettStability}Parameter stability over time (1970-2017) for Bennett's Law (Left) and the fat-carb frontier (Right).", echo = FALSE}

df_plotBen <- subset(df_plotBennett, Year >= 1980)
#df_plotBen <- subset(df_plotBennett, `Adj. R-squared` > 0.7)
mod <- lm(Slope ~ `Y intercept`, df_plotBen)
#summary(mod)
  mBen <- round(mod$coefficients[2], 3)
  bBen <- round(mod$coefficients[1], 3)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2Ben <- round(df_out$adj.r.squared, 2)
this_subtitleBen <- paste0("Bennett's Law", "\nAdj. R-squared = ", adjR2Ben, "\nSlope = ", mBen, ", Y intercept = ", bBen)

df_plotFC <- subset(df_plotFatCarb, Year >= 1980)
mod <- lm(`Y intercept` ~ Slope, df_plotFC)
#summary(mod)
  mFC <- round(mod$coefficients[2], 3)
  bFC <- round(mod$coefficients[1], 3)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2FC <- round(df_out$adj.r.squared, 2)
this_subtitleFC <- paste0("Fat-carb frontier", "\nAdj. R-squared = ", adjR2FC, "\nSlope = ", mFC, ", Y intercept = ", bFC)

df_plotC <- subset(df_plotCarb, Year >= 1980)
mod <- lm(`Y intercept` ~ Slope, df_plotC)
#summary(mod)
  mC <- round(mod$coefficients[2], 3)
  bC <- round(mod$coefficients[1], 3)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2C <- round(df_out$adj.r.squared, 2)
this_subtitleC <- paste0("Carbohydrate law", "\nAdj. R-squared = ", adjR2C, "\nSlope = ", mC, ", Y intercept = ", bC)



```

Note that the slope and y intercept of the fat-carb frontier appear to move in inverse unison with each other. A plot of their values over the period 1980-2017 reveals they are indeed affine to each other across all years (Figure \ref{fig:mAffineY}). This relation effectively reduces the fat-carb frontier to a one parameter model when comparing across years. That is, for any given year, the slope of the frontier $\alpha$ is related to its y intercept $b$ by

\begin{equation}
b \approx `r mFC` \alpha + `r bFC`
\end{equation}

\begin{equation}
b \approx `r mBen` \alpha + `r bBen`
\end{equation}

\begin{equation}
b \approx `r mC` \alpha + `r bC`
\end{equation}

In the case of Bennett's law and the carbohydrate law, the affine relation does not hold when GDP is expressed in current USD.

```{r, fig.show = "hold", fig.width = 6, fig.height=3, fig.align="center", fig.cap="\\label{fig:mAffineY}Relation between the slope and y intercept of (left) Bennett's Law, (middle) the carbohydrate law, and (right) the fat-carb frontier.", echo = FALSE}

gg <- ggplot(df_plotBen, aes(x = Slope, y = `Y intercept`,
                          label = Year))
gg <- gg + geom_point()
gg <- gg + geom_text_repel(size = label_size)
gg <- gg + labs(subtitle = this_subtitleBen)
gg <- gg + theme(axis.title = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size),
                 plot.subtitle = element_text(size = subtitle_size))
gg_Ben <- gg

gg <- ggplot(df_plotFC, aes(x = Slope, y = `Y intercept`,
                          label = Year))
gg <- gg + geom_point()
gg <- gg + geom_text_repel(size = label_size)
gg <- gg + labs(subtitle = this_subtitleFC)
gg <- gg + theme(axis.title.y = element_blank(),
                 axis.title.x = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size),
                 plot.subtitle = element_text(size = subtitle_size))
gg_FC <- gg

gg <- ggplot(df_plotC, aes(x = Slope, y = `Y intercept`,
                          label = Year))
gg <- gg + geom_point()
gg <- gg + geom_text_repel(size = label_size)
gg <- gg + labs(subtitle = this_subtitleC)
gg <- gg + theme(axis.title.y = element_blank(),
                 axis.title.x = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size),
                 plot.title = element_text(size = title_size),
                 plot.subtitle = element_text(size = subtitle_size))
gg_carb <- gg


gg_Ben + gg_carb + gg_FC + plot_layout(ncol = 3) +
  plot_annotation(title = "Affine relation between slope and y intercept")


```

It is also worthwhile investigating the stability of carbohydrate

In the spirit of Hans Rosling [-@rosling2005new], animations of the plots in Figure \ref{fig:Bennett01} are provided in the supplemental materials. These animations offer further striking visual confirmation of the stability of the parameters in Bennett's Law and the fat-carb frontier over time. In these animations, it is interesting to observe the progress, regress, fits, and starts of different nations along the frontier. The trajectory of China over the past five decades, from an 80% carb diet to a 40% carb diet, is one of many remarkable examples to behold.

<!-- Clearly, Bennett's Law can be useful for determining the future composition of food demand as a function of GDP growth. However, only recently have researchers begun to take advantage of this potential. Gouel and Guimbard [-@gouel2019nutrition] introduce a novel demand model that integrates Bennett's Law, and find that demand for starchy crops will grow by just 30.8% in 2050, whereas demand for non-starchy commodities will grow by 35.5% (in the case of pulses, nuts, and oilcrops) to 72.1% (in the case of oils and fats). International agricultural research investment decisions, on the other hand, appear to be made without much regard for Bennett's Law. The largest share of investment continues to go into starchy crop research, with smaller portions invested in the non-starchy commodity groups for which demand is growing most quickly [@ispc2018; @finplan2018]. -->

# Engel's Law

84 years prior to Bennett's discovery, the young Director of the Statistical Bureau of Saxony, Ernst Engel, was poring over 199 Belgian working class budgets, when he noticed that

>"[t]he poorer the individual, a family, or a people, the greater must be the percentage of the income necessary for the maintenance of physical sustenance, and again of this a greater portion must be allowed for food" [@zimmerman1932ernst].

Nowadays, Engel's Law has a reputation for being "one of the most robust" empirical laws [@Browning2018]. However, in the early literature that Engel set in motion, numerous household budget studies contradicted Engel's finding, indicating an increasing relation between the food budget share and income [@zimmerman1932ernst]. The Law's robustness did not become especially evident until the post-WWII period. Houthakker's seminal study of 40 household budget surveys from 30 countries, in particular, presents overwhelming confirmation of the law's validity across cultural and socioeconomic spectra [-@houthakker1957international].

An example of Engel's Law using World Bank ICP data, covering x countries, is given in the top left panel of Figure \ref{fig:Engel0}. Food demand may also be expressed in terms of food expenditure (middle left panel) or food quantity (lower left panel) [@Browning2018]. The expenditure version of Engel's Law presents a better fit to the ICP data than the expenditure share version. The food quantity consumed version presents the poorest fit of the three, but is still respectable. The food quantity consumed version of Engel's Law is fitted to FBS data, and can thus be tracked across several years since 1960. Over the period of best fit (1980-2017), the fitted parameters exhibit remarkable stability, ranging narrowly between ... and ....   Apart from a few outliers, Houthakker's household level estimates of the income elasticity of food demand likewise fall within a remarkably narrow range considering the many different places, time periods, and data sources he draws from.
[A practical benefit of the FBS version is that it extends back...]

>"[I]f no data on the expenditure patterns of a country are available at all, one would not be very far astray by putting the...elasticity with respect to total expenditure [i.e. income], at .6 for food" [@houthakker1957international].

which is not far from the estimate obtained in Figure ....

```{r, fig.show = "hold", fig.width = 5, fig.height=4, fig.align="center", fig.cap="\\label{fig:Engel0}(Left) Three formulations of Engel's Law using 2017 data. The top graphic is based on FAO FBS data, while the bottom two are based on World Bank ICP data. GDP is expressed at the market exchange rate. (Right) Parameter trajectory of the consumption formulation of Engel's Law.", echo = FALSE}
#===========================================================================
this_file <- "Engels Law WB ICP data.csv"
df_icp <- read.csv(this_file, stringsAsFactors = F)
colnames(df_icp) <- gsub("US\\.\\.", "US$", colnames(df_icp))
colnames(df_icp) <- gsub("\\.\\.", ", ", colnames(df_icp))
colnames(df_icp) <- gsub("\\.", " ", colnames(df_icp))
colnames(df_icp) <- gsub("billions ", "billions", colnames(df_icp))
#unique(df_icp$Element)
these_elements <- c("Expenditure per capita, market exchange rate-based (US$)",
                    "Expenditure component share of GDP (GDP = 100%)")
# these_elements <- c("Expenditure per capita, PPP-based (US$)",
#                     "Expenditure, PPP-based (US$, billions)")
df_icp <- subset(df_icp, Element %in% these_elements)

df_icp$Element[grep("share", df_icp$Element)] <- "Expenditure (as % of GDP)"
# df_icp$Element[grep("per capita", df_icp$Element)] <- "expenditure/capita (USD)"
# df_icp$Element[grep("billions", df_icp$Element)] <- "expenditure (billion USD)"

u <- df_icp$Good
df_icp$Good[which(u == "1101190:Food products n.e.c. (Class)")] <- "Other food"
df_icp$Good[grep("Oils and fats", u)] <- "Oils and fats"
df_icp$Good[grep("Sugar, jam", u)] <- "Sugary and sweet"
df_icp$Good[grep("Milk, cheese and eggs", u)] <- "Milk, cheese and eggs"
df_icp$Good[grep("Fish and seafood", u)] <- "Fish and seafood"
df_icp$Good[grep("Meat", u)] <- "Meat"
df_icp$Good[grep("Vegetable", u)] <- "Bread, cereals, and vegetables"
df_icp$Good[grep("Bread", u)] <- "Bread, cereals, and vegetables"
df_icp$Good[grep("Fruit", u)] <- "Fruit"
df_icp$Good[grep("1101100:FOOD", u)] <- "Food"
# this_file <- "Engels Law WB ICP data.csv"
# df_engel <- read.csv(this_file, stringsAsFactors = F)
# u <- colnames(df_engel)
# colnames(df_engel)[which(u == "Expenditure..logged")] <- "Expenditure, logged"
# colnames(df_engel)[which(u == "GDP.capita..USD.")] <- "GDP/capita (USD)"
# colnames(df_engel)[which(u == "GDP.capita..USD...logged")] <- "GDP/capita (USD), logged"
# #unique(df_engel$Element)
# these_elements <- c("Expenditure per capita, market exchange rate-based (US$)",
#                     "Expenditure component share of GDP (GDP = 100%)")
# #  "Expenditure per capita, PPP-based (US$)"
# df_engel <- subset(df_engel, Element %in% these_elements)
# 
# df_engel$Element[grep("share", df_engel$Element)] <- "Food expenditure as % of GDP, logged"
# df_engel$Element[grep("per capita", df_engel$Element)] <- "Food expenditure/capita (USD), logged"
# unique(df_engel$Good[grep("FOOD", df_engel$Good)])
# df_engel$Good[grep("1101100:FOOD", df_engel$Good)] <- "Food"
# df_engel$Good[grep("RESTAURANTS", df_engel$Good)] <- "Restaurants and hotels"
# df_engel$Good[grep("EDUCATION", df_engel$Good)] <- "Education"
# df_engel$Good[grep("RECREATION", df_engel$Good)] <- "Recreation and culture"
# df_engel$Good[grep("CLOTHING", df_engel$Good)] <- "Clothing and footwear"
# df_engel$Good[grep("CONSTRUCTION", df_engel$Good)] <- "Construction"
# df_engel$Good[grep("MACHINERY", df_engel$Good)] <- "Machinery and equipment"
# df_engel$Good[grep("FURNISHINGS", df_engel$Good)] <- "Furnishings, household equipment,\n& routine household maintenance"
# df_engel$Good[grep("ACTUAL HOUSING", df_engel$Good)] <- "Housing, electricity,\n& other utilities"
# df_engel$Good[grep("VEHICLES", df_engel$Good)] <- "Purchase of vehicles"
# df_engel$Good[grep("TRANSPORT", df_engel$Good)] <- "Transport"
# df_engel$Good[grep("COMMUNICATION", df_engel$Good)] <- "Communication"
# df_engel$Good[grep("HEALTH", df_engel$Good)] <- "Health"
# #---------------------------------------------------------------------------
# # Highlight some countries in plot
# # label_Africa <- c("Tanzania", "Uganda", "Ethiopia", "South Africa",
# #                   "Ghana")
# # label_NAfricaWAsia <- c("Turkey", "Saudi Arabia")
# # label_Asia <- c("India", "Iran", "China, mainland", "Vietnam", "Japan",
# #                 "South Korea")
# # label_NAmEurAusNZ <- c("Italy", "France", "Australia")
# # label_LAC <- c("Nicaragua", "Colombia", "Brazil")
# # labelThese_vec <- c(label_Africa, label_NAfricaWAsia, label_Asia,
# #                     label_NAmEurAusNZ, label_LAC)
# label_Africa <- c("Uganda", "South Africa")
# label_NAfricaWAsia <- c("Turkey", "Saudi Arabia")
# label_Asia <- c("India", "China, mainland", "Vietnam")
# label_NAmEurAusNZ <- c("France", "Australia")
# label_LAC <- c("Nicaragua", "Colombia", "Brazil")
# labelThese_vec <- c(label_Africa, label_NAfricaWAsia, label_Asia,
#                     label_NAmEurAusNZ, label_LAC)
# df_engel$label_these <- NA
# u <- df_engel$Area
# df_engel$label_these[which(u %in% labelThese_vec)] <- df_engel$Area[which(u %in% labelThese_vec)]
#===========================================================================
# Basic Engel's Law plot
these_cols <- c("Country", "Year", "Element", "Good", "Region",
                "Expenditure, logged",
                "GDP per capita, market exchange rate based, US$")
#setdiff(these_cols, colnames(df_icp))
df_plot <- subset(df_icp[, these_cols], Good == "Food" & Year == 2017 & Region != "Aggregated")
df_plot$Good <- NULL
u <- colnames(df_plot)
colnames(df_plot)[which(u == "Expenditure, logged")] <- "Food demand, logged"
df_plot$`GDP/capita (USD), logged` <- log(df_plot$`GDP per capita, market exchange rate based, US$`)
df_plot$`GDP per capita, market exchange rate based, US$` <- NULL

these_cols <- c("Area", "Year", "Region",
                "Total (kcal/capita/day)", "GDP/capita (USD), logged")#, gdpPop_vars)
#setdiff(these_cols, colnames(df_cerRootShare))
df_engelKcal <- subset(df_cerRootShare[, these_cols], Region != "Aggregated")
df_engelKcal$Element <- "Consumption (kcal/capita/day)"

u <- colnames(df_engelKcal)
colnames(df_engelKcal)[which(u == "Total (kcal/capita/day)")] <- "Food demand"
df_engelKcal$`Food demand, logged` <- log(df_engelKcal$`Food demand`)
df_engelKcal$`Food demand` <- NULL
colnames(df_engelKcal)[1] <- "Country"
df_engelKcal <- df_engelKcal[, colnames(df_plot)]
df_engelKcalStab <- df_engelKcal
df_engelKcal <- subset(df_engelKcal, Year == 2017)


df_plot <- as.data.frame(rbind(df_plot, df_engelKcal))
#df_plot$lgdpPcapSq <- df_plot$`GDP/capita (USD), logged`^2
df_plot$Element[grep("Expenditure per capita", df_plot$Element)] <- "Expenditure/capita (USD)"
these_elements <- unique(df_plot$Element)
facet_labels <- c()
adjR2_vec <- c()
for(i in 1:length(these_elements)){
  this_element <- these_elements[i]
  this_df_plot <- subset(df_plot, Element == this_element)
  mod <- lm(`Food demand, logged` ~ `GDP/capita (USD), logged`, this_df_plot)
  # mod <- lm(`Expenditure, logged` ~ `GDP/capita, logged` + lgdpPcapSq, this_df_plot)
  #summary(mod)
  #plot(mod$fitted.values, mod$residuals)
  m <- round(mod$coefficients[2], 4)
  b <- round(mod$coefficients[1], 4)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2 <- round(df_out$adj.r.squared, 2)
  this_facet_label <- paste0("In terms of ", this_element, "\nAdj. R-squared = ", adjR2, ", Slope = ", m, ", Y intercept = ", b)
  facet_labels[i] <- this_facet_label
  adjR2_vec[i] <- adjR2
  
}

# m2 <- round(mod$coefficients[3], 4)
# x <- m + 2 * m2 * this_df_plot$lgdpPcap
# hist(x)

names(facet_labels) <- these_elements
n <- length(unique(df_plot$Region))
bag_of_colors <- randomcoloR::distinctColorPalette(k = 2 * n)
color_vec <- sample(bag_of_colors, n)

#this_element <- "Expenditure as % of GDP, logged"
#this_facet_label <- facet_labels[1]
#df_subplot <- subset(df_plot, Element == this_element)
#u <- colnames(df_subplot)
#colnames(df_subplot)[grep("Expenditure", u)] <- this_element

gg <- ggplot(df_plot, aes(x = `GDP/capita (USD), logged`,
                          y = `Food demand, logged`,
                          #label = label_these,
                          group = Region, fill = Region, shape = Region))
gg <- gg + geom_point(alpha = 0.6, size = smallPoint_size, color = "black", stroke = 0.5)
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
gg <- gg + geom_smooth(aes(group = NULL, fill = NULL, shape = NULL), method = lm, se = F)
#gg <- gg + geom_text_repel(color = "black", size = smallLabel_size)
gg <- gg + labs(subtitle = "Engel's Law")
gg <- gg + facet_wrap(~Element, ncol = 1, scales = "free_y",
                      labeller = labeller(Element = facet_labels))
gg <- gg + theme(#legend.direction = "vertical",
                 #legend.spacing.y = unit(1, 'cm'),
                 #legend.position = "none",
                 strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                 legend.title = element_blank(),
                 legend.text = element_text(size = legendText_size),
                 axis.text = element_text(size = axisText_size),
                 axis.title = element_text(size = axisTitle_size))
gg <- gg + guides(fill = guide_legend(#nrow = 2,
  override.aes = list(linetype = 0)),
  color = guide_legend(override.aes = list(linetype = 0)))
gg_engel <- gg

#---Parameter stability plot
df_params <- df_engelKcalStab
yr_vec <- unique(df_params$Year)
n_yrs <- length(yr_vec)
m_vec <- c()
b_vec <- c()
adjR2_vec <- c()
N_vec <- c()
for(i in 1:n_yrs){
  this_year <- yr_vec[i]
  this_df <- subset(df_params, Year == this_year)
  this_df$Year <- NULL
  mod <- lm(`Food demand, logged` ~ `GDP/capita (USD), logged`, this_df)
  m_vec[i] <- round(mod$coefficients[2], 4)
  b_vec[i] <- round(mod$coefficients[1], 4)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2_vec[i] <- df_out$adj.r.squared
  N_vec[i] <- length(mod$fitted.values)
  
}

df_plotStab <- data.frame(Year = yr_vec, Slope = m_vec, b_vec, adjR2_vec, N_vec)
colnames(df_plotStab)[3:5] <- c("Y intercept", "Adj. R-squared", "Sample size")
df_plotStab$Year <- as.integer(as.character(df_plotStab$Year))
ind <- which(df_plotStab$Year > 1980)
minSlopeEngel <- round(min(df_plotStab$Slope[ind]), 2)
maxSlopeEngel <- round(max(df_plotStab$Slope[ind]), 2)
minYengel <- round(min(df_plotStab$`Y intercept`[ind]), 2)
maxYengel <- round(max(df_plotStab$`Y intercept`[ind]), 2)
# mean(df_plot$Slope)
# sd(df_plot$Slope)
# mean(df_plot$`Y intercept`)
# sd(df_plot$`Y intercept`)

df_plot <- df_plotStab %>% gather(Type, Value, Slope:`Sample size`)
gg <- ggplot(df_plot, aes(x = Year, y = Value))
gg <- gg + geom_line()
gg <- gg + facet_wrap(~Type, ncol = 1, scales = "free_y")
gg <- gg + labs(subtitle = "Engel parameter trajectory (Consumption formulation)")
gg <- gg + theme(axis.title = element_blank(),
                 strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                 axis.text = element_text(size = axisText_size),
                 plot.subtitle = element_text(size = subtitle_size))
gg_engelStab <- gg
#---------------------------------------------------------------------------
gg_engel + gg_engelStab + plot_layout(ncol = 2, guides = "collect") & theme(legend.position = "bottom")

# (gg_EngelKcal + plot_layout(guides = "collect") & theme(legend.position = "bottom")) + (gg_Engel0Stab + theme(legend.position = "none")) +
#    plot_annotation(title = "The calorie demand formulation of Engel's Law") & 
#   theme(text = element_text(size = title_size))



#===========================================================================
# df_params <- df_engelKcalStab
# df_params$`GDP/capita (USD), logged, squared` <- df_params$`GDP/capita (USD), logged`^2
# yr_vec <- unique(df_params$Year)
# n_yrs <- length(yr_vec)
# m_vec <- c()
# b_vec <- c()
# adjR2_vec <- c()
# N_vec <- c()
# pval <- c()
# pval2 <- c()
# for(i in 1:n_yrs){
#   this_year <- yr_vec[i]
#   this_df <- subset(df_params, Year == this_year)
#   this_df$Year <- NULL
#   mod <- lm(`Food demand, logged` ~ `GDP/capita (USD), logged` +
#               `GDP/capita (USD), logged, squared`, this_df)
#   summary(mod)
#   pval[i] <- summary(mod)[[4]][11]
#   pval2[i] <- summary(mod)[[4]][12]
#   
#   # m_vec[i] <- round(mod$coefficients[2], 4)
#   # b_vec[i] <- round(mod$coefficients[1], 4)
#   # df_out <- as.data.frame(broom::glance(mod))
#   # adjR2_vec[i] <- df_out$adj.r.squared
#   # N_vec[i] <- length(mod$fitted.values)
#   
# }


```

Engel's Law now forms the implicit or explicit basis of most published assessments of future food demand. It is hard coded into the most prominent agricultural sector equilibrium models (IMPACT, GCAM, GLOBIOM, and MAgPIE) [@valin2014future], and figures centrally in more recent econometric approaches [Goouel; Bodirsky]. The FAO takes Engel's Law as a point of departure when conducting its expert based assessments of future food demand []. In a much cited parsimonious food demand study, Tilman et al. [-@tilman2011global] apply Engel's Law without crediting Engel. Brown likewise rediscovers Engel's Law in his influential book [-@brown1963man], without citing Engel.

The functional form employed in Figure ... is the log-linear or double log formulation of Engel's Law, first employed by Engel himself [@houthakker1957international]. The slope $\alpha$ is the income elasticity of food demand. That is,

$$
\begin{equation}
\alpha = \frac{\partial \ln(\text{food demand})}{\partial \ln(\text{income})} = \frac{\%\Delta \: \text{food demand}}{\%\Delta \: \text{income}}
\end{equation}
$$

Alternative functional forms have also been explored [@aitchison1954synthesis; @prais1952non; @prais1971analysis]. The empirical fit can usually be improved by adding price and demographic control variables to the model.

The verbal definition of Engel's Law [@Browning2018; @zimmerman1932ernst] is a statement about the first order relation of food expenditures to income. When selecting a functional form by which to model Engel's Law, the question of second order behavior must be addressed; but this is a matter left to the modeler and the data in any particular given study. Engel's Law itself makes no explicit assertion regarding the second order evolution of food expenditures with respect to income.

In the food demand modeling literature, it has nonetheless become commonplace to mischaracterize or (to put it charitably) reinvent Engel's Law as a statement about second order behavior. This tendency appears to be rooted in the work of Timmer, who argues that
<!-- [-@timmer1981there; see also Timmer and Alderman ...] -->

>"[b]ecause the income component of own-price elasticities is likely to be at least a significant factor for food, Engel's Law strongly suggests that Cournot own-price elasticities should decline in absolute size for higher income households" [@timmer1981there].

Timmer's argument is tantamount to saying (via the Slutsky equation) that Engel's Law strongly suggests that the income elasticity of food demand should decline with income. [Timmer here is reacting to an earlier household budget study reporting own price elasticities of food demand---and, by Timmer's implication, income elasticity of food demand---that increase with income. Timmer remarks that these results "fly in the face of all economic logic" [@timmer1981there].] Elsewhere, Timmer surmises that

>"[a] logical corollary of Engel's law is that the income elasticity of demand for food...is likely to be relatively large for low-income consumers and to decline to very small levels for upper-income consumers" [Timmer 1983].

Again, Engel's Law implies no such corrollary. Engel leaves the issue of second order behavior to be addressed by the modeler. Engel himself specified the log-linear model, which implies zero second order variation. Houthakker also specifies a log-linear model, with results indicating very little second order variation of food demand with respect to income across a diverse range of countries and time periods---And Houthakker expressly concludes that "there is not much support for [the] thesis" of second order variation []. In hindsight, moreover, the logical corrollary to be drawn from the double log parameter trajectory in the right panel of Figure ... could very well be that income elasticty of food demand is largely unresponsive to changes in income: Over the period 1980 to 2017, world GDP rose by $328\%$ [WDI], while the income elasticty declined by just two percentage points.
<!-- from $\$2533$  to $\$10,828$ -->

Seale [] later enlists Timmer's surmise in support of the following mischaracterization of Engel's Law (in italics):

>"Engel's law states that the budget share of food decreases with increasing income. Accordingly, the budget share of food should be larger in Vietnam than in the U.S., and _the income elasticity of demand for food is expected to be greater in Vietnam than in the U.S._" [@seale2006modeling].

To be clear, this is an accurate representation of Engel's Law up until the last clause, where Seale misattributes Timmer's surmise to Engel. Valin et al. later equate Timmer's surmise with Engel's Law as follows:

>"[T]here is overwhelming evidence that income elasticities for most food commodities decline as consumer income increases, a relationship known as Engel's Law" [@valin2014future].

No reference to the "overwhelming evidence" is given, but the authors presumably refer to the aforementioned articles by Timmer and Seale, and to Mohammad et al. [], who update Seale's work with new data. In each of these studies, the authors specify increasingly sophisticated empirical models that allow for second order variation in the income elasticity of food demand. Timmer's seminal study is limited to maize, rice, and cassava consumption, and so is more properly an inquiry into the second order variation of Bennett's Law.

A detailed inquiry into the question of how overwhelming this evidence may or may not be lies beyond the scope of this brief review. However, by now it should be clear that there is considerable evidence supporting zero second order variation. A further cursory exploration of the FBS reveals that  Augmenting the double log consumption formulation of Engel's Law with a squared logged income term to allow for second order variation, as Timmer does in his study [-@timmer1981there], results in statistically insignificant coefficients on the squared term across all years of FBS data. A similar augmentation of the double log expenditure per capita formulation of Engel's Law using the 2017 ICP data results in a statistically significant coefficient on the squared term, but leaves the adjusted R-squared unchanged to the third decimal place.

There is also considerable opacity surrounding the determination of the income elasticity of demand trajectories for each country. No indication of how this is done is given in the IMPACT documentation, for example.

Timmer's surmise is not a logical corrollary to Engel's Law, much less Engel's Law itself. Attempts to construe Timmer's surmise as more or less synonymous with Engel's Law have leant the surmise an authoritative weight it does not in fact possess.

<!-- The authors report a good empirical fit, which appears to constitute evidence in favor of Timmer's surmise.  of negative second order variation of food demand with respect to income. However,  -->

<!-- Moreover, evidence of a relation between income elasticity and income has not always been "overwhelming". There was no clear relation in the early literature [@zimmerman1932ernst], and Houthakker found that "an explanation of the differences between the elasticities...seems difficult. It is conceivable, and indeed probable, that relative prices may influence the elasticities; thus it has sometimes been suggested that the income elasticity of a commodity is an increasing function of its price relative to other commodities" [-@houthakker1957international]. Subsequently, evidence of a relation bewteen income and income elasticity materialized with the report by Muhammad et al. and Seale and Regmi [-@muhammad2011international; @seale2006modeling]. -->
<!-- Engel went so far as to conclude that "[t]he proportion of the outgo used for food, other things being equal, is the best measure of the material standard of living of a population" [-@zimmerman1932ernst]. -->
 <!-- An example of the calorie demand formulation of Engel's Law is given in the left panel of Figure \ref{fig:EngelStability}. The fit is reasonable, but not quite as good as the fit observed in the original formulation. Like Bennett's Law, Engel's Law fits the data well across time, particularly since 1980 (right panel). -->
<!-- After rising to a peak value of about 0.11 in 1980, the slope has gradually decreased to about 0.09. The Y intercept, meanwhile, has risen from about 6.9 to about 7.2. -->

# Using empirical laws to make parsimonious calculations of future food demand

Future food demand estimation exercises tend to be highly academic, technical, expert driven affairs. While there may be good reasons for this, the high degree of sophistication also, unfortunately, gives the impression that future food demand estimatation is an innately complex procedure requiring a large investment of time and human capital. This, in turn, effectively reduces policy practitioners in government and research planning offices around the world---i.e., the primary market for food demand estimates---to the role of passive consumer of a "one-size-fits-all" information product, generated by a black box, that may or may not address their particular set of food policy issues. Moreover, some of these published demand estimates are patently implausible. Tilman et al.'s estimate of a 100%-110% increase in food demand over the 2005 level [], for example, implies a 2050 world food demand of 3800-4000 kcal/capita, which in turn implies that numerous countries would have a per capita intake in the 4000-5000 kcal range. Even when allowing for waste, these levels are well in excess of the generally recommended calorie intake of an adult male. Bodirsky et al. likewise admit that some of their future estimates "by far exceed plausible intake averages over the population of a country", forcing them to invoke the waste argument. Bijl et al. [] impose an arbitrary ceiling of 3500 kcal/capita in their model to prevent food estimates from blowing up.

The empirical laws examined above point towards a much simpler, more demand driven, transparent, and parsimonious approach---i.e., one that does not require a large investment of time and human capital, and that gives the practitioner control over parameter values, assumptions regarding population and GDP growth, and time horizons. Below I sketch out one such application to generate back-of-the-envelope projections of 2050 world food demand, starchy staple demand, carbohydrate demand, and fat demand. The same approach may be used to generate projections for any geographical focus or time horizon of interest to the practitioner.
<!-- demand for any given year and geographical focus can be approximated by evaluating the calorie formulation of Engel's Law at the corresponding GDP/capita. -->

Historically, Engel's Law has approximated world food demand quite well, diverging just 3%-9% from the measured value (left panel, Figure \ref{fig:...}). The accuracy of future projections depends upon the practitioner's choice of 1) future parameter values, 2) future world population, and 3) future world GDP. The choice of future parameter values is facilitated by the remarkable stability of the historical parameter values over time, as seen and discussed in the sections above. One might also draw upon the observed parameter relation in equation \ref{eq:yintEngelKcal} to further reduce the dilemma from two parameters to one parameter. (In a projection over many---say $n$---years, this relation would be even more useful, reducing the number of parameter estimates from $2n$ to $2+n$.) For the 2050 food demand estimate below, the income elasticity of food demand is set to `r f`, reflecting an assumption of continued stability. The y intercept parameter is then calculated from this based on equation \ref{eq:yintEngelKcal}.

Estimates of future population are readily available out to 2100 from the UN [@desa2019world]. Reliable estimates of future GDP are considerably less straightforward to calculate [@diaz2016future], but have become increasingly available [@foure2013modelling]. For back-of-the-envelope purposes, it may be sufficient to assume an annualized GDP growth rate $r$ and then to calculate the percentage change in GDP over the baseline year as $% \delta GDP = (1 + r)^n$, where $n$ is the number of years between the baseline year and the future year of interest. In a less cursory analysis, careful consideration must be given to the different ways in which GDP can be expressed---typically a choice between USD at constant prices versus current prices, or USD at the market exchange rate versus the purchasing power parity exchange rate. For a discussion see Seale []. In the parsimonious approach considered here, GDP is expressed in USD at the market exchange rate using current prices, and 2050 GDP is estimated assuming an annualized growth rate of 2%, resulting in an estimate of `r 2050gdgp`. World population in 2050 is assumed to be 9.7 billion, based on the UN's medium projection.

Evaluating Engel's Law at these values returns a 2050 world food demand of `r xx` trillion kcal/day, or `r xxx` kcal/capita/day, a `r dfsdf`% increase over the 2017 level. Such point estimates are of limited value as they give no indication of how drastically the estimate might change given perturbations to the input values. With some basic programming skills, the practitioner can generate a much more valuable heatmap permitting consideration of a wide range of future population and GDP/capita scenarios at a single glance, as in the left panel of Figure .... Since population and GDP trajectories tend to be highly correlated, it may make more sense to examine sensitivity to uncertainty in the GDP/capita and income elasticity parameters, as in the right panel of Figure ....

As a point of reference, a selection of published food demand estimates is presented in Table 1. These are for context only. Direct comparison is not adviseable due to the differing units in which GDP is expressed, and different assumptions regarding future GDP and population growth.

Bennett's Law may likewise be applied to arrive at a 2050 projection of the cereal and starchy root share of world food demand. However, in this case it must be kept in mind that, historically, the Bennett's Law approximation has diverged considerably from the measured value---by 9-15 percentage points (right panel, Figure \ref{fig:...}). It may be possible to reduce this error by including more variables in the model. For back-of-the-envelope projections, however, it may also be sufficient to notice that the error is fairly consistent across years, and to apply an error correction term on this basis. In the parsimonious calculation here, for example, the Bennett model is corrected by subtracting the average percentage point error since 2000.

As with Engel's Law, the choice of future parameter values for Bennett's Law is facilitated by the remarkable stability discussed above. For the parsimonious estimate here, the income elasticity of the starchy staple dietary share and y intercept are set to their mean values since 1980 (`r m` and `r b`, respectively), reflecting an assumption of continued parameter stability. Evaluating Bennett's Law at these parameter values, and at the same GDP and population values used in the food demand estimate, returns a cereal and starchy root share of `r bb`%. Multiplying this by the food demand estimate obtained above returns a 2050 starchy staple demand of `r bbb` trillion kcal/day, or `r bbbb` kcal/capita/day, a `r sddfsdf`% increase over the 2017 level. Heatmaps in Figure ... again facilitate sensitivity analysis of uncertainty in the GDP, population, and income elasticity parameter. The range of estimates roughly agrees with Gouel et al.'s projection of starchy staple demand [-@gouel2019nutrition].

The carbohydrate law in Figure ... may be applied in a perfectly analogous manner to arrive at a 2050 carbohydrate share of `r c`%. Multiplying this by the food demand estimate then returns a total 2050 carbohydrate demand of `r cc` trillion kcal/day, or `r ccc` kcal/capita/day, a `r cccc` increase over the 2017 level. The fat-carb frontier may then be applied to estimate a 2050 fat share of `r f`%, which similarly works out to a total 2050 fat demand of `r ff` trillion kcal/day, or `r fff` kcal/capita/day, a `r ffff` increase over the 2017 level. Heatmaps again facilitate consideration of a wide range of scenarios in Figure ....
<!-- Any application of Engel's Law requires careful consideration of how the law's parameters---especially the income elasticity of food demand---have evolved over time in the past, and how they are likely to evolve in the future. [As with Bennett's Law, the FBS data indicate remarkable stability in the Engel parameters, which have varied narrowly between ... and ... sice 1980.] As with Bennett's Law, these data also exhibit an inverse relation between the slope and y intercept parameters (Figure ... and equation ...), which can be exploited to reduce the number of parameter estimates in an $n$ year trajectory from $2n$ to $n + 2$. -->

```{r}

df_plot <- subset(df_plotStab, Year >= 1980)
df_mod <- df_plot[, c("Y intercept", "Slope")]
mod <- lm(`Y intercept` ~ Slope, df_mod)
#summary(mod)
  m_engelKcal <- round(mod$coefficients[2], 3)
  b_engelKcal <- round(mod$coefficients[1], 3)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2 <- round(df_out$adj.r.squared, 2)
this_subtitle <- paste0("Adj. R-squared = ", adjR2, "\nSlope = ", m_engelKcal, ", Y intercept = ", b_engelKcal)

gg <- ggplot(df_plot, aes(x = Slope, y = `Y intercept`,
                          label = Year))
gg <- gg + geom_point()
gg <- gg + geom_text_repel(size = label_size)
gg <- gg + labs(subtitle = this_subtitleBen)
gg <- gg + theme(axis.title = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size),
                 plot.subtitle = element_text(size = subtitle_size))
gg


```
<!-- Bodirsky et al. [] propose to model parameter trajectories using an equation taken from biochemistry that asymptotically converges to a particular value. They offer no explanation for this novel methodological choice, nor as to why the parameters should be expected to converge asymptotically to a particular value. The FBS data do not exhibit such asymptotic behavior. -->
<!-- There remains the question of which parameter values to use when projecting into the future. One method is suggested in Figures \ref{fig:...}: to fit the models cross-sectionally for several years, to examine parameter value trajectories over time, and to choose values based on one's assumptions of how the trajectories are likely to evolve in future years. -->
<!-- basically assuming that the values will revert to values of previous years rather than continuing on their trajectory. -->
<!-- The agricultural sector equilibrium models implement exogenously determined trajectories in their estimate of food demand. Bodirsky et al. model future parameters using a novel ... taken from biochemistry....converge to a particular value. There is no rationale for  empirical argument in favor of their approach, but that has since deteriorated (Figure ...). -->
[@valin2014future]
[@alexandratos2012world] 60% not 70%
[@gouel2019nutrition]
[@tilman2011global]
<!-- These results are in line with Gouel et al.'s estimate of a 46% increase in food demand, including an 18% increase in demand for starchy staples [-@gouel2019nutrition]. -->
<!-- The 16% increase in cereal demand may not include livestock feed? -->
2% annual growth in GDP [].
Can do this for any country
```{r, fig.show = "hold", fig.width = 4, fig.height=3, fig.align="center", fig.cap="\\label{fig:demandBackTest}....", echo = FALSE}
# Define get demand estimate function
getDemEst <- function(df_dem){
n_yrs <- length(unique(df_dem$Year))
yr_min <- min(df_dem$Year)
list_DemTot <- list()
list_DemStarch <- list()
  for(i in 1:n_yrs){
    this_year <- yr_min + i - 1
    df_mod <- subset(df_dem, Year == this_year & Region != "Aggregated")
    df_world <- subset(df_dem, Year == this_year & Area == "World")
    worldGDP <- 10^6 * df_world$`GDP (million USD)`
    worldPop <- 10^6 * df_world$`Population (millions)`
    worldGDPpCap <- df_world$`GDP/capita (USD)`
    #---Total kcal demand
    mod <- lm(`Total (kcal/capita/day), logged` ~ `GDP/capita (USD), logged`, df_mod)
    #summary(mod)
    a <- round(mod$coefficients[2], 4)
    b <- round(mod$coefficients[1], 4)
    df_out <- as.data.frame(broom::glance(mod))
    adjR2 <- round(df_out$adj.r.squared, 2)
    #facet_labels <- paste0("Adj. R-squared = ", adjR2, ", Slope = ", a_2017, ", Y intercept = ", b_2017)
    worldDemTot <- df_world$`Total (kcal/day)`
    worldDemTot_est <- exp(b) * worldGDP^a * worldPop^(1 - a)
    #worldDemTot_est <- exp(b) * worldGDPpCap^a
    pctDiff_DemTot <- 100 * (worldDemTot_est - worldDemTot) / worldDemTot
    outDemTot <- c(this_year, a, b, adjR2, worldDemTot_est, worldDemTot, pctDiff_DemTot)
    list_DemTot[[i]] <- outDemTot
    #---Cereal and starchy root demand
    mod <- lm(`Cereals & starchy roots (% of diet), logged` ~ `GDP/capita (USD), logged`, df_mod)
    #summary(mod)
    a <- round(mod$coefficients[2], 4)
    b <- round(mod$coefficients[1], 4)
    df_out <- as.data.frame(broom::glance(mod))
    adjR2 <- round(df_out$adj.r.squared, 2)
    #facet_labels <- paste0("Adj. R-squared = ", adjR2, ", Slope = ", a_2017, ", Y intercept = ", b_2017)
    #worldDemStarch <- df_world$`Cereals & starchy roots (kcal/capita/day)`
    worldDemStarchPctShare <- df_world$`Cereals & starchy roots (% of diet)`
    worldDemStarchPctShare_est <- exp(b) * worldGDPpCap^a
    #worldDemStarch_est <- worldDemTot_est * worldDemStarchPctShare_est / 100
    worldDemStarch_est <- exp(b) * worldGDPpCap^a
    #pctDiff_DemStarch <- 100 * (worldDemStarch_est - worldDemStarch) / worldDemStarch
    ppDiff_DemStarchPctShare <- worldDemStarchPctShare_est - worldDemStarchPctShare
    outDemStarch <- c(this_year, a, b, adjR2,
                      #worldDemStarch_est, worldDemStarch,
                      worldDemStarchPctShare_est, worldDemStarchPctShare,
                      ppDiff_DemStarchPctShare)
                      #pctDiff_DemStarch)
    list_DemStarch[[i]] <- outDemStarch
    
  }
  df_DemTot <- as.data.frame(do.call(rbind, list_DemTot))
  colnames(df_DemTot) <- c("Year", "Slope", "Y intercept", "Adj. R-squared",
                        "Modeled",
                        "Real",
                        "Pct. Diff.")
  df_DemTot$Item <- "Total"
  df_DemStarch <- as.data.frame(do.call(rbind, list_DemStarch))
  colnames(df_DemStarch) <- c("Year", "Slope", "Y intercept", "Adj. R-squared",
                           "Modeled",
                           "Real",
                           "PP Diff.")
  df_DemStarch$Item <- "Cereals & starchy roots"
  #df_out <- as.data.frame(rbind(df_DemTot, df_DemStarch))
  list_out <- list(df_DemTot, df_DemStarch)
  return(list_out)
}

df_dem <- df_cerRootShare
df_dem$`Total (kcal/capita/day), logged` <- log(df_dem$`Total (kcal/capita/day)`)
df_dem$`Total (kcal/day)` <- 10^6 * df_dem$`Total (kcal/capita/day)` * df_dem$`Population (millions)`
df_dem$`Total (kcal/day), logged` <- log(df_dem$`Total (kcal/day)`)
df_dem$`Cereals & starchy roots (kcal/day)` <- 10^6 * df_dem$`Cereals & starchy roots (kcal/capita/day)` * df_dem$`Population (millions)`

list_out <- getDemEst(df_dem)
df_plotTot <- list_out[[1]]
df_plotStarch <- list_out[[2]]

df_plotTot1 <- df_plotTot
df_plotTot1$Item <- NULL
df_plotTot1$`Pct. Difference` <- NULL
df_plotTot1 <- df_plotTot1 %>% gather(Type, `Food demand (kcal/day)`, Modeled:Real)
df_plotTot1$`Food demand (kcal/day)` <- 10^-12 * df_plotTot1$`Food demand (kcal/day)`
colnames(df_plotTot1)[ncol(df_plotTot1)] <- "Food demand\n(trillion kcal/day)"
df_plotTot2 <- df_plotTot[, c("Year", "Pct. Diff.")]
gg <- ggplot(df_plotTot1, aes(x = Year, y = `Food demand\n(trillion kcal/day)`,
                          group = Type, color = Type))
gg <- gg + geom_line(lwd = 1)
gg <- gg + theme(legend.position = "none",
                 legend.title = element_blank(),
                 axis.title.x = element_blank(),
                 axis.text.x = element_blank())
ggTot <- gg

gg <- ggplot(df_plotTot2, aes(x = Year, y = `Pct. Diff.`))
gg <- gg + geom_line(lwd = 1)
gg <- gg + theme(axis.title.x = element_blank())
ggTotDiff <- gg

#ggTot + ggTotDiff + plot_layout(ncol = 1, heights = c(1, 1 / 4))

df_plotStarch1 <- df_plotStarch
df_plotStarch1$Item <- NULL
df_plotStarch1$`PP Difference` <- NULL
df_plotStarch1 <- df_plotStarch1 %>% gather(Type, `Cereal & starchy\nroot demand (% of diet)`, Modeled:Real)
df_plotStarch2 <- df_plotStarch[, c("Year", "PP Diff.")]
gg <- ggplot(df_plotStarch1, aes(x = Year, y = `Cereal & starchy\nroot demand (% of diet)`,
                              group = Type, color = Type))
gg <- gg + geom_line(lwd = 1)
gg <- gg + theme(legend.title = element_blank(),
                 axis.title.x = element_blank(),
                 axis.text.x = element_blank())
ggStarch <- gg

gg <- ggplot(df_plotStarch2, aes(x = Year, y = `PP Diff.`))
gg <- gg + geom_line(lwd = 1)
gg <- gg + theme(axis.title.x = element_blank())
ggStarchDiff <- gg

#ggStarch + ggStarchDiff + plot_layout(ncol = 1, heights = c(1, 1 / 4))

ggTot + ggStarch + ggTotDiff + ggStarchDiff +
  plot_layout(ncol = 2, heights = c(1, 1 / 3), guides = "collect") & theme(legend.position = "top")

#---
# df_plotSlopeYint <- subset(df_plotTot, Year >= 1980)
# gg <- ggplot(df_plotSlopeYint, aes(x = Slope, y = `Y intercept`,
#                           label = Year))
# gg <- gg + geom_point()
# gg <- gg + ggrepel::geom_text_repel()
# gg
# 
# mod <- lm(`Y intercept`~Slope, df_plotSlopeYint)
# #summary(mod)
# m_b <- mod$coefficients["Slope"]
# b_b <- mod$coefficients["(Intercept)"]

# Using Engel/Bennett Laws to estimate kcal demand in 2050
a_fut <- 0.08
b_fut <- m_engelKcal * a_fut + b_engelKcal

ind <- which(df_plotStarch$Year > 1980)
a_starch <- mean(df_plotStarch$Slope[ind])
b_starch <- mean(df_plotStarch$`Y intercept`[ind])

# Heat map
n_res <- 25
gdpPcap_vec <- seq(10000, 18000, length.out = n_res)
pop_vec <- seq(9.1, 10, length.out = n_res) * 10^9
a_vec <- seq(0.07, 0.1, length.out = n_res)
a_starch_vec <- seq(-0.21, -0.18, length.out = n_res)

mat_trilKcal <- matrix(NA, n_res, n_res)
mat_trilKcalBen <- matrix(NA, n_res, n_res)
mat_kcalShareBen <- matrix(NA, n_res, n_res)
mat_kcalPcap <- matrix(NA, n_res, n_res)
mat_kcalPcapBen <- matrix(NA, n_res, n_res)
for(i in 1:n_res){
  this_gdpPcap <- gdpPcap_vec[i]
  for(j in 1:n_res){
    this_pop <- pop_vec[j]
    this_gdp <- this_gdpPcap * this_pop
#    this_a_starch <- a_starch_vec[j]
    #---------
    trilKcal2050_est <- exp(b_fut) * this_gdp^a_fut * this_pop^(1 - a_fut)
    trilKcal2050_est <- trilKcal2050_est * 10^-12
    #---------
    cerRootShare2050_est <- (exp(b_starch) * this_gdpPcap^a_starch + err_corrctn) / 100
    benTrilKcal2050_est <- cerRootShare2050_est * trilKcal2050_est
    #---------
    this_a <- a_vec[j]
    this_b <- m_engelKcal * this_a + b_engelKcal
    kcalPcap2050_est <- exp(this_b) * (this_gdpPcap)^this_a
    benKcalPcap2050_est <- cerRootShare2050_est * kcalPcap2050_est
    #---------
    mat_trilKcal[i, j] <- trilKcal2050_est
    mat_trilKcalBen[i, j] <- benTrilKcal2050_est
    mat_kcalShareBen[i, j] <- cerRootShare2050_est * 100
    mat_kcalPcap[i, j] <- kcalPcap2050_est
    mat_kcalPcapBen[i, j] <- benKcalPcap2050_est
    
    mat_trilKcalCarb[i ,j] <- tril
    
    mFatCarb_vec

  }
}

colnames(mat_trilKcal) <- as.character(pop_vec * 10^-9)
row.names(mat_trilKcal) <- as.character(gdpPcap_vec)

colnames(mat_trilKcalBen) <- as.character(pop_vec * 10^-9)
row.names(mat_trilKcalBen) <- as.character(gdpPcap_vec)

colnames(mat_kcalShareBen) <- as.character(pop_vec * 10^-9)
row.names(mat_kcalShareBen) <- as.character(gdpPcap_vec)

colnames(mat_kcalPcap) <- as.character(a_vec)
row.names(mat_kcalPcap) <- as.character(gdpPcap_vec)

colnames(mat_kcalPcapBen) <- as.character(a_vec)
row.names(mat_kcalPcapBen) <- as.character(gdpPcap_vec)

mat_trilKcalPct <- (mat_trilKcal - trilKcal2017) / trilKcal2017 * 100
mat_trilKcalBenPct <- (mat_trilKcalBen - trilKcalCerRoot2017) / trilKcalCerRoot2017 * 100

df_trilKcal <- reshape2::melt(mat_trilKcal)
colnames(df_trilKcal) <- c("GDP/capita (USD)",
                           "Population (billion)",
                           "Food demand\n(trillion kcal)")

df_plot <- df_trilKcal
gg <- ggplot(df_plot, aes(x = `Population (billion)`,
                          y = `GDP/capita (USD)`,
                          fill = `Food demand\n(trillion kcal)`))
gg <- gg + geom_tile()
gg <- gg + scale_fill_gradient(high = "orange", low = "cyan")
gg <- gg + theme(legend.position = "top")
gg_trilKcal <- gg


df_trilKcalPct <- reshape2::melt(mat_trilKcalPct)
colnames(df_trilKcalPct) <- c("GDP/capita (USD)",
                           "Population (billion)",
                           "Food demand\n(% increase over 2017)")
df_plot <- df_trilKcalPct
gg <- ggplot(df_plot, aes(x = `Population (billion)`,
                          y = `GDP/capita (USD)`,
                          fill = `Food demand\n(% increase over 2017)`))
gg <- gg + geom_tile()
gg <- gg + scale_fill_gradient(high = "orange", low = "cyan")
gg <- gg + theme(legend.position = "top",
                 axis.title = element_blank(),
                 axis.text = element_blank())
gg_trilKcalPct <- gg

df_trilKcalBen <- reshape2::melt(mat_trilKcalBen)
colnames(df_trilKcalBen) <- c("GDP/capita (USD)",
                           "Population (billion)",
                           "Cereal & starchy\nroot demand\n(trillion kcal)")

df_plot <- df_trilKcalBen
gg <- ggplot(df_plot, aes(x = `Population (billion)`,
                          y = `GDP/capita (USD)`,
                          fill = `Cereal & starchy\nroot demand\n(trillion kcal)`))
gg <- gg + geom_tile()
gg <- gg + scale_fill_gradient(high = "orange", low = "cyan")
gg <- gg + theme(legend.position = "top",
                 axis.title.y = element_blank(),
                 axis.text.y = element_blank())
gg_trilKcalBen <- gg

df_kcalShareBen <- reshape2::melt(mat_kcalShareBen)
colnames(df_kcalShareBen) <- c("GDP/capita (USD)",
                           "Population (billion)",
                           "Cereal & starchy\nroot demand\n(% of total kcal)")
df_plot <- df_kcalShareBen

gg <- ggplot(df_plot, aes(x = `Population (billion)`,
                          y = `GDP/capita (USD)`,
                          fill = `Cereal & starchy\nroot demand\n(% of total kcal)`))
gg <- gg + geom_tile()
gg <- gg + scale_fill_gradient(high = "orange", low = "cyan")
gg <- gg + theme(legend.position = "bottom",
                 axis.title.y = element_blank(),
                 axis.text.y = element_blank())
gg_kcalShareBen <- gg

# df_trilKcalBenPct <- reshape2::melt(mat_trilKcalBenPct)
# colnames(df_trilKcalBenPct) <- c("GDP/capita (USD)",
#                            "Population (billion)",
#                            "Pct. increase\nover 2017 level")

# gg_trilKcal + gg_trilKcalPct + gg_trilKcalBen + gg_kcalShareBen + plot_layout(ncol = 2)

gg_trilKcal + gg_trilKcalBen + plot_layout(ncol = 2)


df_kcalPcap <- reshape2::melt(mat_kcalPcap)
colnames(df_kcalPcap) <- c("GDP/capita (USD)",
                               "Income elasticity\nof food demand",
                               "Food demand\n(kcal/capita)")

df_plot <- df_kcalPcap
gg <- ggplot(df_plot, aes(x = `Income elasticity\nof food demand`,
                          y = `GDP/capita (USD)`,
                          fill = `Food demand\n(kcal/capita)`))
gg <- gg + geom_tile()
gg <- gg + scale_fill_gradient(high = "orange", low = "cyan")
gg <- gg + theme_bw()
gg <- gg + theme(legend.position = "top")
gg_kcalPcap <- gg

df_kcalPcapBen <- reshape2::melt(mat_kcalPcapBen)
colnames(df_kcalPcapBen) <- c("GDP/capita (USD)",
                               "Income elasticity\nof food demand",
                               "Cereal & starchy\nroot demand\n(kcal/capita)")

df_plot <- df_kcalPcapBen
gg <- ggplot(df_plot, aes(x = `Income elasticity\nof food demand`,
                          y = `GDP/capita (USD)`,
                          fill = `Cereal & starchy\nroot demand\n(kcal/capita)`))
gg <- gg + geom_tile()
gg <- gg + scale_fill_gradient(high = "orange", low = "cyan")
gg <- gg + theme_bw()
gg <- gg + theme(axis.title.y = element_blank(),
                 axis.text.y = element_blank(),
                 legend.position = "top")
gg_kcalPcapBen <- gg

gg_kcalPcap + gg_kcalPcapBen + plot_layout(ncol = 2)


#  
# xtick_labs <- -beta_change_vec * 100
# ytick_labs <- mu_Cq_change_vec * 100
# inMat <- mat_demMap
# surface <- list(x = xtick_labs,
#                 y = ytick_labs,
#                 z = inMat)
# library(fields)
# plot.surface(surface, type = "C",
#              xlab = "X",
#              ylab = "y", col = cm.colors(25))
# title(main = "Pct Change in Factory Net Revenue", cex.main = 1)
  
  
#========================================================================  
annual_growth <- 0.02
n_yrs <- 2050 - 2017
pctChng_GDP <- (1 + annual_growth)^n_yrs
worldGDPTril2017 <- 10^-6 * subset(df_dem, Area == "World" &
                                Year == 2017)$`GDP (million USD)`
worldGDPTril2050_me <- worldGDPTril2017 * pctChng_GDP

worldPopBil2050_UNmedium <- 9.735  # UN medium variant
worldPopBil2050_me <- worldPopBil2050_UNmedium
worldPopBil2017_FAOSTAT <- 10^-3 * subset(df_dem, Area == "World" &
                                Year == 2017)$`Population (millions)`
worldGDPpCap2017 <- 10^3 * worldGDPTril2017 / worldPopBil2017_FAOSTAT
worldGDPpCap2050_me <- 10^3 *  worldGDPTril2050_me / worldPopBil2050_me

trilKcal2017_FAOSTAT <- 10^-12 * subset(df_dem, Area == "World" &
                       Year == 2017)$`Total (kcal/day)`
trilKcalCerRoot2017_FAOSTAT <- 10^-12 * subset(df_dem, Area == "World" &
                           Year == 2017)$`Cereals & starchy roots (kcal/day)`

me_estTrilKcal2050 <- 10^-12 * exp(b_fut) * (10^12 * worldGDPTril2050_me)^a_fut * (10^9 * worldPopBil2050_me)^(1 - a_fut)
me_estKcalPcap2050 <- 10^3 * me_estTrilKcal2050 / worldPopBil2050_me
me_estTrilKcalPctDiff <- 100 * (me_estTrilKcal2050 - trilKcal2017_FAOSTAT) / me_estTrilKcal2050
#---------------------------------------------------------------------------
# Cereal and starchy root demand
ind <- which(df_plotStarch$Year > 2000)
err_corrctn <- -mean(df_plotStarch$`PP Diff.`[ind])
me_estCerRootShare2050 <- (exp(b_starch) * worldGDPpCap2050_me^a_starch + err_corrctn) / 100
me_estCerRootTrilKcal2050 <- me_estCerRootShare2050 * me_estTrilKcal2050
me_estCerRootKcalPcap2050 <- 10^3 * me_estCerRootTrilKcal2050 / worldPopBil2050_me
me_estCerRootTrilKcalPctDiff <- 100 * (me_estCerRootTrilKcal2050 - trilKcalCerRoot2017_FAOSTAT) / trilKcalCerRoot2017_FAOSTAT
#---------------------------------------------------------------------------
# Carbohydrate kcal demand
#---------------------------------------------------------------------------
# Fat kcal demand
#===========================================================================
# Compare food demand estimate to other studies
# Other food demand estimates for context; direct comparison problematic due to different units for GDP.
# From FAOSTAT
kcalPcapPday2005 <- 2761
pop2005 <- 10^3 * 6388641
kcalPday2005 <- kcalPcapPday2005 * pop2005
kcalPcapPday2010 <- 2850
starchKcalPcapPday2010 <- 1298 + 137
pop2010 <- 10^3 * 6770979	
kcalPday2010 <- kcalPcapPday2010 * pop2010
starchKcalPday2010 <- starchKcalPcapPday2010 * pop2010
# From Valin et al. [@valin2014future]
# Increase in 2050 over 2005: 59%-98% according to the models
# FAO projection in 2050 over 2005-2007: 54%
# Gouel et al. [@gouel2019nutrition]: Increase in 2050 over 2010: 46% and 18% for starchy staples

valinNames <- c("AIM", "IMPACT", "GLOBIOM", "MAgPIE")
n_valin <- length(valinNames)
modName_vec <- c(valinNames, "MAIDADS", "FAO",
                 "Physical flow",
                 "Engel's Law",
                 "Engel's Law",
                 "Engel's Law")

modSource_vec <- c(rep("Valin et al. 2014", n_valin),
                   "Gouel and Guimbard 2017",
                   "Alexandratos and Bruinsma 2012",
                   "Bijl et al. 2017", #@bijl2017physically
                   "Tilman et al. 2011",
                   "Bodirsky et al. 2015",
                   "This study")

# modType_vec <- c("CGE", "PE", "PE", "PE",
#                  "MAIDADS",
#                  "Expert assessment",
#                  "",
#                  "Econometric",
#                  "Econometric",
#                  "Econometric")

AIM_estTrilKcal <- kcalPday2005 * 1.66 * 10^-12 #CGE
IMPACT_estTrilKcal <- kcalPday2005 * 1.65 * 10^-12 #PE
GLOBIOM_estTrilKcal <- kcalPday2005 * 1.62 * 10^-12 #PE
MAgPIE_estTrilKcal <- kcalPday2005 * 1.83 * 10^-12 #PE

worldPopBil2050_Valin <- 9.287 # Valin et al. footnote 11
worldGDPpCap2050_Valin <- 16000 # Valin et al.

# me_kcalPcap2050 <- exp(b_fut) * worldGDPPcap2050_^a_fut
# me_trilKcal2050_est <- 10^-12 * worldPopBil2050_SSP2 * me_kcalPcap2050

ValinEstTrilKcal_vec <- c(AIM_estTrilKcal, IMPACT_estTrilKcal,
              GLOBIOM_estTrilKcal, MAgPIE_estTrilKcal)

ValinEstKcalPcap_vec <- 10^3 * ValinEstTrilKcal_vec / worldPopBil2050_Valin
Valin_gdpUnits <- "Current USD MER"
Valin_notes <- "SSP2"

worldPopBil2050_FAO <- 9.15 # FAO report p 21, also Valin et al. footnote 11
worldGDPpCap2050_FAO <- 13758 # From FAO report. Valin et al. says 11000
FAO_estKcalPcap <- 3070 # From the FAO report p 20
FAO_estTrilKcal <- 10^-3 *  FAO_estKcalPcap * worldPopBil2050_FAO
# FAO_estTrilKcal <- kcalPday2005 * 1.54 * 10^-12 # 54% increase from Valin et al. Can't find this in original FAO report.
# FAO_estKcalPcap <- FAO_estTrilKcal / worldPopBil2050_FAO * 10^3
FAO_gdpUnits <- "2005/2007 MER USD at 2005/2007 prices"
FAO_notes <- "2.11% annualized GDP growth from 2005/2007 to 2050"

Gouel_estTrilKcal <- kcalPday2010 * 1.41 * 10^-12 #MAIDADS - Modified Implicitly Directly Additive Demand System
worldPopBil2050_Gouel <- 9.166 #From the SSP2 pop projection in https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5310112/ Same as Bijl et al.
worldGDPTril2010_WDI <- 66.126
worldGDPpCap2050_Gouel <- worldGDPTril2010_WDI * (1 + 0.0237)^(2050 - 2010) / worldPopBil2050_Gouel * 10^3
Gouel_estKcalPcap <- 10^3 * Gouel_estTrilKcal / worldPopBil2050_Gouel
Gouel_gdpUnits <- "2010 MER USD"
Gouel_notes <- "SSP2, 2.37% annualized GDP growth from 2010 to 2050"


worldGDPTril2005_FAOSTAT <- 55998597.949115 * 10^-6
worldGDPTril2050_Tilman <- worldGDPTril2005_FAOSTAT * (1 + 0.025)^(2050-2005)
worldGDPpCap2050_Tilman <- worldGDPTril2050_Tilman / worldPopBil2050_Tilman * 10^3
Tilman_estTrilKcal <- kcalPday2005 * 2.1 * 10^-12
worldPopBil2050_Tilman <- 9.3 #Calculated from Tilman et al.'s remark that population to increase by 2.3 billion in 2050 and publication year of Tilman et al.'s paper (2010). Tilman et al. say this is the UN medium projection, but he cites the UN 2008 revision, which may be different from today's UN medium projection of 9.735 billion.
Tilman_estKcalPcap <- 10^3 * Tilman_estTrilKcal / worldPopBil2050_Tilman
Tilman_gdpUnits <- "2015 MER USD"
Tilman_notes <- "2.5% annualized world GDP growth"

worldPopBil2050_Bodirsky <- worldPopBil2050_UNmedium
worldGDPpCap2050_Bodirsky <- "Not reported"
Bodirsky_estKcalPcap <- 2990
Bodirsky_estTrilKcal <- Bodirsky_estKcalPcap * worldPopBil2050_Bodirsky * 10^3
Bodirsky_gdpUnits <- "2005 MER USD"
Bodirsky_notes <- "SRES B2"
# UN Medium variant pop projection = SRES B2 pop projection

worldPopBil2050_Bijl <- 9.166 #From the SSP2 pop projection in https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5310112/  
worldGDPpCap2050_Bijl <- 22500 #From SSP2 gdp/capita trajectory https://www.sciencedirect.com/science/article/abs/pii/S0959378015000837
Bijl_estKcalPcap <- 3300 #SSP2. Give or take. Has to be read from a graphic.
Bijl_estTrilKcal <- Bijl_estKcalPcap * worldPopBil2050_Bijl * 10^3
Bijl_gdpUnits <- "2005 PPP USD"
Bijl_notes <- "SSP2. Value has\nto be read\nfrom a graphic."

estTrilKcal_vec <- c(ValinEstTrilKcal_vec,
                     FAO_estTrilKcal,
                     Gouel_estTrilKcal,
                     Bijl_estTrilKcal,
                     Tilman_estTrilKcal,
                     Bodirsky_estTrilKcal,
                     me_estTrilKcal)

estKcalPcap_vec <- c(ValinEstKcalPcap_vec,
                     FAO_estKcalPcap,
                     Gouel_estKcalPcap,
                     Bijl_estKcalPcap,
                     Tilman_estKcalPcap,
                     Bodirsky_estKcalPcap,
                     me_estKcalPcap)

popProject_vec <- c(rep(worldPopBil2050_Valin, n_valin),
                    worldPopBil2050_FAO,
                    worldPopBil2050_Gouel,
                    worldPopBil2050_Bijl,
                    worldPopBil2050_Tilman,
                    worldPopBil2050_Bodirsky,
                    worldPopBil2050_me)

modGDPpCap_vec <- c(rep(worldGDPpCap2050_Valin, n_valin),
                    worldGDPpCap2050_FAO,
                    worldGDPpCap2050_Gouel,
                    worldGDPpCap2050_Bijl,
                    worldGDPpCap2050_Tilman,
                    worldGDPpCap_Bodirsky,
                    worldGDPpCap2050_me)

gdpUnits_vec <-c(rep(Valin_gdpUnits, n_valin),
                 FAO_notes,
                 Gouel_notes,
                 Bijl_notes,
                 Tilman_notes,
                 Bodirsky_notes,
                 me_notes)

notes_vec <- c(rep(Valin_notes, n_valin),
               FAO_notes,
               Gouel_notes,
               Bijl_notes,
               Tilman_notes,
               Bodirsky_notes,
               me_notes)



df_table <- data.frame(Model = modName_vec,
                       Source = modSource_vec,
                       popProject_vec,
                       modGDPpCap_vec,
                       gdpUnits_vec,
                       notes_vec,
                       estTrilKcal_vec,
                       estKcalPcap_vec)

colnames(df_table)[3:ncol(df_table)] <- c("2050 Population",
                                          "2050 GDP/capita",
                                          "GDP units",
                                          "Notes",
                                          "2050 food demand\n(Trillion kcal/day)",
                                          "2050 food demand\n(kcal/capita/day)")





kcalPday2005 * 1.59
kcalPday2005 * 1.98
kcalPday2005 * 1.54
kcalPday2010 * 1.46
starchKcalPday2010 * 1.18
DemTot2050_est
DemCerRoot2050_est
# Tilman et al.: 100%-110% increases in 2050 over 2005.
# Results in 3600-3800 kcal/capita/day, which is a body builder's diet, approaching twice the recommended helthy calorie intake for sedentary adult males. --maybe moreso since UN 2050 pop projection in 2011 was 9.3 billion (this implied in opening sentences of Tilman paper.)



estKcalPcap_vec <- c(Tilman_estKcalPcap, )
estTrilKcal_vec <- c(Tilman_estTrilKcal, )


df_table <- data.frame()

kable(df_table) %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))

  
```

# Different laws, or different manifestations of the same law?

It is tempting to attribute Engel's Law to some special characteristic of food that sets it apart from other goods. However, this approach to explaining Engel's Law runs into problems on both empirical and purely argumentative grounds. Empirically, analogous laws can be discerned for a wide range of goods (Figure ...), not just food. The laws for clothing, utilities, and rent were noted in Engel's time [@zimmerman1932ernst; @stigler1954early].

```{r, fig.show = "hold", fig.width = 6, fig.height=5, fig.align="center", fig.cap="\\label{fig:qerwerwer}....", echo = FALSE}

all_goods <- unique(df_engel$Good)
not_these <- all_goods[grep("[0-9]", all_goods)]
not_these <- c(not_these, "Food")
df_engelOther <- subset(df_engel, !(Good %in% not_these))
#unique(df_engelOther$Good)
#colnames(df_engelOther)
#unique(df_engelOther$Element)
this_element <- "Food expenditure/capita (USD), logged"
df_plot <- subset(df_engelOther, Year == 2017 &
                    Element == this_element &
                    Region != "Aggregated")
u <- colnames(df_plot)
colnames(df_plot)[which(u == "Expenditure, logged")] <- this_element
these_goods <- unique(df_plot$Good)

facet_labels <- c()
adjR2_vec <- c()
for(i in 1:length(these_goods)){
  this_good <- these_goods[i]
  this_df_plot <- subset(df_plot, Good == this_good)
  mod <- lm(`Food expenditure/capita (USD), logged` ~ `GDP/capita (USD), logged`, this_df_plot)
  #summary(mod)
  m <- round(mod$coefficients[2], 2)
  b <- round(mod$coefficients[1], 2)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2 <- round(df_out$adj.r.squared, 2)
  facet_labels[i] <- paste0(this_good, "\nAdj. R-squared = ", adjR2, "\nSlope = ", m, ", Y intercept = ", b)
  adjR2_vec[i] <- adjR2
}

names(facet_labels) <- these_goods

gg <- ggplot(df_plot, aes(x = `GDP/capita (USD), logged`,
                          y = `Food expenditure/capita (USD), logged`,
                          #label = label_these,
                          group = Region, fill = Region, shape = Region))
gg <- gg + geom_point(alpha = 0.6, size = smallPoint_size, color = "black", stroke = 0.5)
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
#gg <- gg + geom_smooth(method = lm, se = F)
gg <- gg + facet_wrap(~Good, ncol = 4,
                      labeller = labeller(Good = facet_labels))
#gg <- gg + geom_text_repel(color = "black", size = smallLabel_size)
gg <- gg + theme(strip.background = element_blank(),
                 strip.text.x = element_text(hjust = -0.01, size = facetTitle_size),
                 #legend.direction = "vertical",
                 #legend.spacing.y = unit(1, 'cm'),
                 legend.title = element_blank(),
                 legend.text = element_text(size = legendText_size),
                 axis.text = element_text(size = axisText_size),
                 axis.title = element_text(size = axisTitle_size))
gg <- gg + guides(fill = guide_legend(#nrow = 2,
  override.aes = list(linetype = 0)),
  color = guide_legend(override.aes = list(linetype = 0)))
gg


```

On the argumentative front, meanwhile, it is true that certain metabolic constraints intrinsically limit the amount of food that the human organism can make use of in any given time period. However, the same can be said of non-food goods such as toilet paper and exercise equipment. Non-metabolic, but perfectly analagous, constraints similarly limit the usefulness of glue, jet fuel, and diamonds. This is called the Law of Diminishing Marginal Utility, and it applies to everything. Astute observers have documented this law, in one guise or another, throughout much of written history [@kauder1953genesis]. In 1738, Daniel Bernoulli put it this way:

>"[i]n the absence of the unusual, the utility resulting from any small increase in wealth will be inversely proportionate to the quantity of goods previously possessed" [@bernoulli1954exposition].

Bernoulli's statement can be formalized as follows.

\begin{equation}
\frac{\partial U}{\partial x} \sim \frac{1}{x}
\label{eq:dimUtilDefine}
\end{equation}

Where, to be clear, the term $\partial U / \partial x$ is the marginal change in utility given a marginal increase in the quantity of good $x$, and "$\sim 1 / x$", means "inversely proportionate to the quantity of good $x$ already acquired". An expression $U(x)$ for the utility of good $x$ can then be obtained by integrating Bernoulli's statement.

\begin{equation}
\begin{split}
\int \frac{d U}{d x} \: dx &= \int \alpha \frac{d \ln(x)}{dx} \: dx \\
U(x)  &= \alpha \ln(x) + k
\end{split}
\label{eq:integrate_lnU}
\end{equation}

Where the proportionality constant $\alpha = dU/d\ln(x)$ regulates the marginal change in utility given a $1$ percent increase in good $x$.

In the multivariate case, an expression $U(\mathbf{x})$ for the utility of a vector of $n$ goods $\mathbf{x} = [x_1,x_2,...,x_n]$ can be obtained as follows.

\begin{equation}
\begin{split}
\int \nabla_{\mathbf{x}} U \: d \mathbf{x} &= \int D(\mathbf{\alpha}) \nabla_{\mathbf{x}} \ln(\mathbf{x}) \: d \mathbf{x} \\
\ln(U(\mathbf{x}))  &= \boldsymbol{\alpha} {'} \ln(\mathbf{x}) + \alpha_0
\end{split}
\label{eq:cobbDoug}
\end{equation}

where $\boldsymbol{\alpha}$ is the vector of proportionality constants corresponding to each $x_i$, the notation $D(\boldsymbol{\alpha})$ indicates a diagonal matrix with the elements of $\boldsymbol{\alpha}$ along its diagonal, and

\begin{equation}
\nabla_{\mathbf{x}} \ln(U) = \left[ \begin{matrix} \frac{\partial \ln(U)}{\partial \ln(x_1)} \\
\frac{\partial \ln(U)}{\partial \ln(x_2)} \\
\vdots \\
\frac{\partial \ln(U)}{\partial \ln(x_n)}
\end{matrix} \right]
\end{equation}

Equation \ref{eq:cobbDoug} is well-known to economists as the Cobb-Douglas form, and is famous for its good empirical fit across contexts and scales. Now, assuming that the consumer will part with money ($B$) for a good $x_i$ only such that the marginal decrease in utility resulting from the loss of money is offset by the marginal increase in utility resulting from the acquisition of the good, then

\begin{equation}
\begin{split}
\frac{\partial U}{\partial B} &= \frac{\partial U}{dx_i} \\
\alpha_B \frac{d \ln(B)}{d B} &= \alpha_i \frac{d \ln(x_i)}{dx_i}
\end{split}
\label{eq:condEqualU}
\end{equation}

But note that $\frac{d \ln(B)}{d B} = \frac{\partial \ln(B)}{\partial (w_i x_i)}$. And so

\begin{equation}
\begin{split}
\alpha_B \frac{\partial \ln(B)}{\partial (w_i x_i)} &= \alpha_i \frac{d \ln(x_i)}{dx_i}
\end{split}
\label{eq:margUtilAssump}
\end{equation}

Rearranging and integrating,

\begin{equation}
\begin{split}
\int \alpha_B \frac{\partial \ln(B)}{\partial x_i} \: dx_i &= \int w_i  \alpha_{x_i} \frac{d \ln(x_i)}{dx_i} \: dx_i \\
\alpha_B \ln(B) + k_B  &= w_i \alpha_i \ln(x_i) + k_i
\end{split}
\end{equation}

Which can then be rearranged into a log-linear expression.

\begin{equation}
\ln(x_i) = m_i \ln(B) + K_i
\label{eq:generalLaw}
\end{equation}

Where

\begin{equation}
m_i = \frac{\alpha_B}{w_i \alpha_i} = \frac{d \ln(x_i)}{d \ln(B)}, \:\: K_i = \frac{k_B - k_i}{w_i \alpha_i}
\label{eq:incomElast}
\end{equation}

All of the empirical laws in Figure ..., including Engel's Law, may thus be considered particular instances of this more general principle governing the income elasticity of demand for any good $x$, derived from the Law of Diminishing Marginal Utility (equation \ref{eq:dimUtilDefine}) and the consumer's exchange condition (equation \ref{eq:condEqualU}). Bennett's Law may likewise be derived if $B$ is constrained to refer to the consumer's food budget.

Insofar as these assumptions are accurate, and insofar as they are not modified by extenuating circumstances not considered here, equation \ref{eq:incomElast} tells us that the income elasticity of food demand, or of demand for any good $x_i$, is proportionate to the ratio $\alpha_B/\alpha_i$, and inversely proportionate to the good's nominal price $w_i$.

The ratio $\alpha_B/\alpha_i$ is the ratio of the income elasticity of utility to good $x_i$'s elasticity of utility. A ratio less than $1$ thus indicates that the consumer's need or appetite for good $x_i$ is more quickly satisfied than their need for income, while a ratio greater than $1$ indicates that the consumer's need or appetite for good $x_i$ is less quickly satisfied than their need for income.

Since an increase in the relative price of $x_i$ effectively results in a decrease in satisfaction per unit expenditure on $x_i$ (and vice versa), this implies that the income elasticity of demand for good $x_i$ is largely determined by the price of $x_i$ relative to other goods, with high elasticities corresponding to high relative prices of good $x_i$, and vice versa. This agrees with earlier speculation by Aitchison:

>"[W]e may reasonably suppose that many commodities begin life as luxuries and eventually become semi-luxuries or necessities as increasing incomes and falling prices bring consumers nearer to an ultimate saturation level. Such we might expect to have been the history of radio sets and to be the future prospects of television, domestic refrigerators and the like" [@aitchison1954synthesis].

(To Aitchison's list can now be added laptop computers, cell phones, lasers, and the like.) While Aitchison's remark also allows a role for increasing incomes, Houthakker later discards this possibility on empirical grounds, and narrows the focus to relative prices:

>"An explanation of the differences between the elasticities consequently seems difficult. It is conceivable, and indeed probable, that relative prices may influence the elasticities" [@houthakker1957international].

[attenuated by changes in the nominal price]

Viewed from this perspective, "luxury" and "necessity" are relative terms that evolve with relative prices; and one should not fixate on a particular income elasticity value as intrinsically definitive of a particular good or class of goods. The numerous 19th century working class budget studies surveyed by Zimmer [-@zimmerman1932ernst] that seem to disprove Engel's Law merely present a more complete picture of this evolution. During the industrial revolution, most of the world lived in the countryside and produced a lot of their own household goods. The working class who came to the cities faced relative prices that placed most of the goods in Figure ... completely out of their reach, and effectively rendered basic goods like clothing and food luxuries. Relative prices would have also varied considerably from one region to another, as the "global village" was yet in its infancy. The wide range of income elasticities reported in Zimmerman's survey, many of them quite high, is consistent with this level of economic disenfranchisement and geographic heterogeneity.

For most of the post-WWII period, on the other hand, the relative price of food has been low, stable, and geographically homogeneous; and this is reflected in the stable trajectory of the income elasticity of demand over this period, and in its narrow range of values from place to place. This may also shed light on the popularity of Engel's Law in the post-WWII period compared to the relative obscurity of the other empirical laws observed in Figure..., most of which do not yet even have a name.^[Engel's Law and Schwabe's Law of rent are the only named laws, to my knowledge]. Part of the explanation must be that food is the most vitally important commodity class, by most measures. But it is also true that empirical researchers are more attracted to an empirical law whose parameter values exhibit consistency across time and space.

# A new empirical law: expected price and price volatility

The theoretical explanation proposed above implies that estimates of future demand based on log-linear empirical laws hinge critically on assumptions regarding the future evolution of relative prices. Fortunately, food price volatility has not been an issue for most of the past 47 years. After a tumultuous decade culminating in the oil crisis of 1973, food prices began a long period of steady, stable decline. However, since 2007, staple food prices have again begun to exhibit volatility, severely curtailing access to essential foodstuffs on numerous occasions in many parts of the world. A fledgling discussion of the causes and effects of this volatility has begun [@CWFSpriceVol2011; @imf2011price; @von2012global; @kalkuhl2016food]. Here I present a new empirical finding that may help to further orient this discussion.

```{r, fig.show = "hold", fig.width = 4, fig.height=3, fig.align="center", fig.cap="\\label{fig:priceSeries}The higher the price, the more volatile it is. Source: Author's creation using FAO export data for 1972-2017. 'Export price' equals FAO's Export Value series divided by its Export Quantity series.", echo = FALSE}
this_file <- "FAO export data world.csv"
df_export_world <- read.csv(this_file, stringsAsFactors = F)
df_export_world$X <- NULL
colnames(df_export_world)[4:6] <- c("Export Quantity", "Export Value",
                                    "World export price (USD / metric ton)")
#=============================================================================
plot_these <- c("Maize", "Apples", "Cocoa, beans", "Cocoa, butter")
df_plot <- subset(df_export_world, Item %in% plot_these &
                    Year >= 1972)
yr_1 <- unique(df_plot$Year)[1]
yr_n <- max(unique(df_plot$Year))
gg <- ggplot(df_plot, aes(x = Year, y = `World export price (USD / metric ton)`, group = Item, color = Item)) + geom_line(lwd = 1)
gg <- gg + scale_x_continuous(breaks = seq(yr_1, yr_n, length.out = 6))
#gg <- gg + scale_y_log10()
gg <- gg + theme(axis.title.x = element_blank(),
                 legend.title = element_blank(),
                 legend.position = "top",
                 legend.text = element_text(size = legendText_size),
                 axis.text = element_text(size = axisText_size),
                 axis.title.y = element_text(size = axisTitle_size))
gg

```

Four food price series are plotted in Figure \ref{fig:priceSeries}. After poring over several such plots, one notices that higher price series are consistently more volatile than lower price series. And one notices this to be true across a wide range of food and non-food agricultural commodities, including both raw and processed versions of the commodities. The relation between price level and volatility also appears to persist over a wide range of food price epochs, from the oil crisis of 1973 through to the more recent volatile period beginning in 2007. A plot of the logged mean of agricultural commodity prices over this period (1962-2017) against the respective logged standard deviations reveals a distinct log-linear relation between price magnitude and price volatility (Figure \ref{fig:riskReward}).^[See Appendix for details on the commodity grouping in this plot.]

The wide range of products that conform to this rule, including food, non-food, raw, and processed products, suggests that the relation may hold for non-agricultural commodity price series as well. However, non-agricultural price data generally do not extend back as far as the FAO data examined here, and so this will be difficult to verify on an equal footing.

```{r, fig.show = "hold", fig.width = 4, fig.height=5, fig.align="center", fig.cap="\\label{fig:riskReward}Logged mean price of agricultural commodities plotted against their respective logged standard deviations. Source: Author's creation using FAO export data 1961-2017.", echo = FALSE}

df_riskReward <- df_export_world %>% group_by(Item) %>%
  summarise(`Mean world export price (USD / metric ton)` = mean(`World export price (USD / metric ton)`, na.rm = T),
            `Stand. dev. world export price (USD / metric ton)` = sd(`World export price (USD / metric ton)`, na.rm = T),
            `Mean Export Qty.` = mean(`Export Quantity`, na.rm = T), 
            `Mean Export Value ('000 USD)` = mean(`Export Value`, na.rm = T))

df_riskReward$`Mean world export price (USD / metric ton), logged` <-
  log(df_riskReward$`Mean world export price (USD / metric ton)`)
df_riskReward$`Stand. dev. world export price (USD / metric ton), logged` <-
  log(df_riskReward$`Stand. dev. world export price (USD / metric ton)`)
#--
df_riskReward <- df_riskReward[which(!is.na(df_riskReward$`Stand. dev. world export price (USD / metric ton), logged`)), ]
#nrow(df_riskReward)
#-----------------------------------------------------------------------------
# Get product groups
this_folder <- "C:/Users/bensc/OneDrive/Documents/Data/FAO Data/FAO trade product groupings/"
file_vec <- list.files(this_folder)
filepath_vec <- paste0(this_folder, file_vec)
list_df <- lapply(filepath_vec, read.csv, stringsAsFactors = F)
for(i in 1:length(list_df)){
  this_df <- as.data.frame(list_df[[i]])
  this_df$Group <- gsub("FAO |.csv", "", file_vec[i])
  this_df <- this_df[, c("Item", "Group")]
  #this_df <- this_df[!which(duplicated(this_df$Item)), ]
  list_df[[i]] <- this_df
}

df_vegOil <- list_df[[1]]
df_animal <- list_df[[2]]
df_cereals <- list_df[[3]]
df_coffee <- list_df[[4]]
df_FnV <- list_df[[5]]
df_nonFood <- list_df[[6]]
df_oilseeds <- list_df[[7]]
df_pulses <- list_df[[8]]
df_RnT <- list_df[[9]]
df_sugar <- list_df[[10]]

ind_rm <- which(df_vegOil$Item %in% c(df_animal$Item, df_nonFood$Item))
df_vegOil <- df_vegOil[-ind_rm, ]
df_oil <- rbind(df_oilseeds, df_vegOil)
df_oil$Group <- "Veg. oils,\noilcrops"
df_cereals <- as.data.frame(rbind(df_cereals, data.frame(Item  = "Maize, green",
                                           Group = "Cereals and preparations")))
df_starchy <- rbind(df_cereals, df_RnT)
df_starchy$Group <- "Starchy crops"
df_sugOther <- rbind(df_coffee, df_nonFood, df_sugar)
df_sugOther$Group <- "Sugar, other"
df_nuts <- df_FnV[grep("nut", df_FnV$Item), ]
df_FnV <- df_FnV[-grep("nut", df_FnV$Item), ]
df_oilPulseNuts <- rbind(df_pulses, df_nuts, df_oil)
df_oilPulseNuts$Group <- "Pulses, nuts, oils"

ind_rm <- which(df_FnV$Item %in% c(df_starchy$Item,
                                   df_sugOther$Item,
                                   df_oilPulseNuts$Item))
df_FnV <- df_FnV[-ind_rm, ]
df_FnV$Group <- "Fruit & Veg."
# nrow(df_starchy)
# nrow(df_FnV)
# nrow(df_sugOther)
# nrow(df_oilPulseNuts)
# nrow(df_animal)


list_df <- list(df_starchy,
                df_FnV,
                df_oilPulseNuts,
                df_sugOther,
                df_animal)

df_groups <- as.data.frame(do.call(rbind, list_df))


df_groups <- df_groups[which(!duplicated(df_groups$Item)), ]
#length(unique(df_riskReward$Item))
# setdiff(df_groups$Item, df_riskReward$Item)
# setdiff(df_riskReward$Item, df_groups$Item)
df_riskReward$Item[which(df_riskReward$Item == "Silk raw")] <- "Silk, raw"
df_riskReward <- merge(df_riskReward, df_groups, by = "Item", all.x = T)
# unique(df_riskReward$Item[which(is.na(df_riskReward$Group))])
# unique(df_riskReward$Item[grep("Silk", df_riskReward$Item, ignore.case = T)])
df_riskReward <- df_riskReward[which(!is.na(df_riskReward$Group)), ]
#----------------------------------------------------------------------------
df_mod <- df_riskReward[, c("Mean world export price (USD / metric ton), logged", "Stand. dev. world export price (USD / metric ton), logged")]
#nrow(df_mod)
row.names(df_mod) <- df_riskReward$Item
mod <- lm(`Mean world export price (USD / metric ton), logged` ~., df_mod)
#summary(mod)
b <- round(mod$coefficients[1], 2)
m <- round(mod$coefficients[2], 2)
#---
# gg <- ggplot(data.frame(Item = row.names(df_mod), yhat = mod$fitted.values,
#                         resid = mod$residuals),
#              aes(x = yhat, y = resid, label = Item))
# gg <- gg + geom_point() + geom_text()
# gg <- gg + geom_hline(yintercept = c(-1, 1), color = "red")
# gg
#---
ind_outlier <- which(abs(as.numeric(mod$residuals)) >= 0.75)
excluded_items <- row.names(df_mod)[ind_outlier]
pct_removed <- 100 * length(ind_outlier) / nrow(df_riskReward)
row_names <- row.names(df_mod)[-ind_outlier]
df_mod <- df_mod[-ind_outlier, ]
row.names(df_mod) <- row_names
mod <- lm(`Mean world export price (USD / metric ton), logged` ~., df_mod)
#summary(mod)
b <- round(mod$coefficients[1], 2)
m <- round(mod$coefficients[2], 2)
df_out <- as.data.frame(broom::glance(mod))
adjR2 <- round(df_out$adj.r.squared, 2)
#plot(mod$fitted.values, mod$residuals)
#----------------------------------------------------------------------------
#df_riskReward$Item[ind_outlier]
df_plot <- df_riskReward[-ind_outlier, c("Item", "Group", "Mean world export price (USD / metric ton), logged", "Stand. dev. world export price (USD / metric ton), logged",
                             "Mean Export Value ('000 USD)")]

df_plot$`Mean export value\n(million USD)` <- df_plot$`Mean Export Value ('000 USD)` / 1000

labelItems <- c("Maize", "Flour, wheat", "Starch, cassava",
              "Coffee, green", "Coffee, roasted", "Wheat", "Bananas",
              "Plantains", "Potatoes", "Cocoa, beans",
              "Wool, greasy", "Beans, dry", "Silk, raw",
              "Apples",
              "Soybeans", "Oil, soybean", "Rubber, natural", "Rice",
              "Cocoa, butter")

df_plot$label_these <- NA
u <- df_plot$Item
df_plot$label_these[which(u %in% labelItems)] <- u[which(u %in% labelItems)]

this_subtitle <- paste0("Adj. R-squared = ", adjR2, "\nSlope = ", m, "  Y intercept = ", b)



gg <- ggplot(df_plot,
             aes(x = `Stand. dev. world export price (USD / metric ton), logged`,
                 y = `Mean world export price (USD / metric ton), logged`,
                 group = Group, fill = Group, shape = Group,
#                 size = `Mean export value\n(million USD)`,
                 label = label_these))
#gg <- gg + geom_smooth(method = lm, se = F)
gg <- gg + geom_point(alpha = 0.6, size = point_size, color = "black", stroke = 0.5)#,
                      #fill = "khaki1", pch=21, color="Black")
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
gg <- gg + geom_text_repel(size = label_size)
gg <- gg + labs(title = "The ag commodity producer's risk-reward frontier",
                subtitle = this_subtitle)
gg <- gg + guides(fill = guide_legend(nrow = 2, byrow = T, override.aes = list(linetype = 0)),
                  color = guide_legend(override.aes = list(linetype = 0)))
gg <- gg + theme(legend.position = "bottom",
                 legend.spacing.x = unit(0.25, 'cm'),
                 legend.title = element_blank(),
                 legend.text = element_text(size = legendText_size),
                 plot.title = element_text(size = title_size),
                 plot.subtitle = element_text(size = subtitle_size),
                 axis.title = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size))
gg


#ggsave("risk reward frontier.pdf")
```

The law also fits the data well at geographically disaggregated scales (Figure \ref{fig:riskRewardByRegion}). The slopes at the disaggregated scale parameters are considerably lower than at the globally aggregated level. At the globally aggregated level, the mean price of a given agricultural commodity increases roughly proportionately to the increase in volatility, while at the geographically disaggrgated level, mean prices increase less than proportionately with volatility. From the producer's standpoint, this means that market risk grows exponentially with expected reward.

```{r, fig.show = "hold", fig.width = 5, fig.height=5, fig.align="center", fig.cap="\\label{fig:riskRewardByRegion}Logged mean price plotted against logged standard deviation, by region.", echo = FALSE}
this_file <- "FAO export data regions.csv"
df_export_regions <- read.csv(this_file, stringsAsFactors = F)
df_export_regions$X <- NULL
colnames(df_export_regions)[4:6] <- c("Export Quantity", "Export Value",
                                    "Regional export price (USD / metric ton)")
#============================================================================
#colnames(df_export_regions)
df_riskReward_regions <- df_export_regions %>% group_by(Region, Item) %>%
  summarise(`Mean regional export price (USD / metric ton)` = mean(`Regional export price (USD / metric ton)`, na.rm = T),
            `Stand. dev. regional export price (USD / metric ton)` = sd(`Regional export price (USD / metric ton)`, na.rm = T),
            `Mean export qty.` = mean(`Export Quantity`, na.rm = T), 
            `Mean export value ('000 USD)` = mean(`Export Value`, na.rm = T))

df_riskReward_regions$`Mean regional export price (USD / metric ton), logged` <-
  log(df_riskReward_regions$`Mean regional export price (USD / metric ton)`)
df_riskReward_regions$`Stand. dev. regional export price (USD / metric ton), logged` <-
  log(df_riskReward_regions$`Stand. dev. regional export price (USD / metric ton)`)
df_riskReward_regions$`Mean export value\n(million USD)` <-
  df_riskReward_regions$`Mean export value ('000 USD)` / 1000
#--
df_riskReward_regions <- df_riskReward_regions[which(!is.na(df_riskReward_regions$`Stand. dev. regional export price (USD / metric ton), logged`)), ]
ind_rm <- which(is.infinite(df_riskReward_regions$`Stand. dev. regional export price (USD / metric ton), logged`))
#df_riskReward_regions$Item[ind_rm] #look
df_riskReward_regions <- df_riskReward_regions[-ind_rm, ]
#nrow(df_riskReward_regions)

df_riskReward_regions$Item[which(df_riskReward_regions$Item == "Silk raw")] <- "Silk, raw"
df_riskReward_regions <- merge(df_riskReward_regions, df_groups, by = "Item", all.x = T)
# unique(df_riskReward_regions$Item[which(is.na(df_riskReward_regions$Group))])
# unique(df_riskReward_regions$Item[grep("Silk", df_riskReward_regions$Item, ignore.case = T)])
df_riskReward_regions <- df_riskReward_regions[which(!is.na(df_riskReward_regions$Group)), ]


#=============================================================================
df_plot <- df_riskReward_regions
df_plot$Region <- gsub("\n", " ", df_plot$Region)
region_vec <- unique(df_plot$Region)
facet_labels <- c()
adjR2_vec <- c()
for(i in 1:length(region_vec)){
  this_region <- region_vec[i]
  this_df_plot <- subset(df_plot, Region == this_region)
  mod <- lm(`Mean regional export price (USD / metric ton), logged` ~ `Stand. dev. regional export price (USD / metric ton), logged`, this_df_plot)
  #summary(mod)
  m <- round(mod$coefficients[2], 2)
  b <- round(mod$coefficients[1], 2)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2 <- round(df_out$adj.r.squared, 2)
  facet_labels[i] <- paste0(this_region, "\nAdj. R-squared = ", adjR2, "\nSlope = ", m, ", Y intercept = ", b)
  adjR2_vec[i] <- adjR2
}

names(facet_labels) <- region_vec

df_plot$label_these <- NA
u <- df_plot$Item
df_plot$label_these[which(u %in% labelItems)] <- u[which(u %in% labelItems)]

gg <- ggplot(df_plot, aes(x = `Stand. dev. regional export price (USD / metric ton), logged`,
                          y = `Mean regional export price (USD / metric ton), logged`,
                          group = Group, fill = Group, shape = Group,
                          label = label_these))
#gg <- gg + geom_smooth(method = lm, se = F)
gg <- gg + geom_point(alpha = 0.6, size = smallPoint_size, color = "black", stroke = 0.25)#,
                      #fill = "khaki1", pch=21, color="Black")
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
#gg <- gg + geom_text_repel(size = label_size)
gg <- gg + facet_wrap(~Region, labeller = labeller(Region = facet_labels))
gg <- gg + labs(title = "The ag commodity producer's risk-reward frontier, by region")
gg <- gg + guides(fill = guide_legend(#nrow = 2,
  override.aes = list(linetype = 0)),
  color = guide_legend(override.aes = list(linetype = 0)))
gg <- gg + theme(legend.title = element_blank(),
                 legend.text = element_text(size = legendText_size),
                 strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                 plot.title = element_text(size = title_size),
                 plot.subtitle = element_text(size = subtitle_size),
                 axis.title = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size))
gg <- shift_legend2(gg)
gg <- ggplotify::as.ggplot(gg)


```

The empirical relation in Figure \ref{fig:riskRewardByRegion} thus implies that efforts to increase smallholder access to premium and value added markets must go hand in hand with efforts to mitigate the associated increase in price risk. This mitigation requires a great deal of innovation, as smallholders generally have no means by which to accumulate risk capital in the classical sense.

Step one in the innovation of smallholder risk mitigating mechanisms is to stop mistaking this absence of classical risk capital for rural poverty. Smallholders are in fact sitting on immense stores of "intangible" value in the form of social capital, environmental services, and informal property (what De Soto calls "dead capital"). The latter category alone may be worth as much as USD USD $10 trillion [@de2000mystery]. The challenge, then, is not to invent smallholder risk capital out of thin air, but to invent new standards, measures, and cooperative mechanisms by which to monetize the smallholder risk capital already in existence.
<!-- # Discussion/Food policy implications -->

<!-- Tilman et al. present an alternative route, fitting their Engel model at the country-year level []. This involves an assumption that the fitted parameters will remain stable as more years of data are added in the future. -->

<!-- Future global food demand studies typically draw upon very sophisticated modeling and/or several rounds of expert consultations and review. These processes are important for building consensus around the plausibility of different future food demand scenarios. However, they can last for years.  re remains an underserved market of . Engel's Law and Bennett's Law suggest a parsimonious alternative. Tilman et al. were the first to exploit this alternative, estimating a 100%-110% increase in 2050 food demand over the 2005 level []. At the UN's projection of a 9.7 billion global population in 2050 [-@desa2019world], this means a global per capita daily food intake of about 3800-4000 kcal, implying that numerous countries would have daily per capita intake in the 4000-5000 kcal range. Such a scenario thus envisions entire populaces of obese persons and/or Olympic body builders consuming more than twice the recommended daily calorie intake for an adult male. -->
<!-- `r Tilman_est_trilKcal` per day -->

# Conclusion

Bennett's and Engel's Laws remain a very useful but largely unexploited planning and decision support resource. Only relatively recently in their long history have researchers began to apply these laws in rigorous assessments of the quantity and composition of future food demand. In support of these efforts, here I have presented a graphical and theoretical review of the laws, addressing certain mischaracterizations along the way.

In the theoretical discussion, I showed how Bennett's and Engel's Laws can be thought of as two examples of a broad family of empirical laws covering all consumer goods. I showed how all of these laws may be derived from the Law of Diminishing Marginal Utility and a conservation of utility principle. The proposed theoretical framework may also shed light on the conditions under which the income elasticity demand for goods changes, and why the income elasticities of demand for food and for starchy staples, in particular, have remained so stable in the post-WWII period.
<!-- thereby building intuition about their meaning and relevance to modern food policy discussions. -->

In the last section, above, I presented a new empirical law relating agricultural commodity price to price volatility. This may help to orient discussions regarding the future behavior of Bennett's and Engel's Laws as the world enters the new epoch of staple food price volatility that began in 2007. Moreover, the new law holds clear policy implications for smallholder resilience building initiatives. In particular, the law indicates that efforts to add value to smallholder agriculture must be complemented by efforts to mitigate the higher associated risk. It also suggests that the low uptake of high value-adding technology observed throughout much of the developing world may be partly explained by the low priority given to price risk mitigation by most aid and agricultural research organizations.

\pagebreak

# References {-}

<div id="refs"></div>

\pagebreak

# Appendix

```{r, results = "markup", echo = F}

# unique(df_bennettRegion$Region)
# df_asia <- subset(df_bennettRegion[, c("Country")], Region == "Asia\n(excluding W. Asia)")
# df_
# 
# df_table <- df_bennettRegion[order(df_bennettRegion$Region), c("Country", "Region")]
# #df_table <- df_table[-which(duplicated(df_table$Country)), ]
# df_table <- df_table %>% spread(Region, Country)
# 
# kable(df_table,
#       format = "pandoc",
#       caption = "\\label{tab:tabCountries}") %>%
#   kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))


```


```{r, results = "markup", echo = F}

# df_table <- 
# 
# kable(df_table,
#       format = "pandoc",
#       caption = "\\label{tab:tabCommods}") %>%
#   kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))


```






<!-- When the sample is restricted to particular geographical or econonmic groups, the fit remains good (with the exception of Sub-Saharan Africa), and subtle differences become apparent in the parameter values (Figure \ref{fig:Engel0Disagg}). A possible reason behind this variation is explored in the next section. -->
<!-- ^[The fit for Sub-Saharan Africa can be improved by applying the alternative formulations of Engel's law discussed below.] -->

<!-- {r, fig.show = "hold", fig.width = 5, fig.height=4, fig.align="center", fig.cap="\\label{fig:Engel0Disagg}Engel's Law by region, ICP data for 2017.", echo = FALSE} -->

<!-- # region_vec <- unique(df_plot$Region) -->
<!-- # facet_labels <- c() -->
<!-- # adjR2_vec <- c() -->
<!-- # for(i in 1:length(region_vec)){ -->
<!-- #   this_region <- region_vec[i] -->
<!-- #   this_df_plot <- subset(df_plot, Region == this_region) -->
<!-- #   mod <- lm(`Food expenditure share of GDP (%), logged` ~ `GDP / capita (USD), logged`, this_df_plot) -->
<!-- #   #summary(mod) -->
<!-- #   m <- round(mod$coefficients[2], 2) -->
<!-- #   b <- round(mod$coefficients[1], 2) -->
<!-- #   df_out <- as.data.frame(broom::glance(mod)) -->
<!-- #   adjR2 <- round(df_out$adj.r.squared, 2) -->
<!-- #   facet_labels[i] <- paste0("Adj. R-squared = ", adjR2, "\nSlope = ", m, "\nY intercept = ", b) -->
<!-- #   adjR2_vec[i] <- adjR2 -->
<!-- # } -->
<!-- #  -->
<!-- # names(facet_labels) <- region_vec -->
<!-- #  -->
<!-- # gg <- ggplot(df_plot, aes(x = `GDP / capita (USD), logged`, -->
<!-- #                           y = `Food expenditure share of GDP (%), logged`, -->
<!-- #                           group = Region, fill = Region, shape = Region, -->
<!-- #                           label = label_these)) -->
<!-- # gg <- gg + geom_point(alpha = 0.6, size = smallPoint_size, color = "black", stroke = 0.5) -->
<!-- # gg <- gg + scale_fill_manual(values = color_vec) -->
<!-- # gg <- gg + scale_shape_manual(values = shape_vec) -->
<!-- # gg <- gg + geom_smooth(method = lm, se = F) -->
<!-- # gg <- gg + facet_wrap(~Region, ncol = 3, scales = "free", labeller = labeller(Region = facet_labels)) -->
<!-- # #gg <- gg + geom_text_repel(color = "black", size = smallLabel_size) -->
<!-- # gg <- gg + theme(strip.background = element_blank(), -->
<!-- #                  strip.text.x = element_text(hjust = -0.01, size = facetTitle_size), -->
<!-- #                  #legend.direction = "vertical", -->
<!-- #                  #legend.spacing.y = unit(1, 'cm'), -->
<!-- #                  legend.title = element_blank(), -->
<!-- #                  legend.text = element_text(size = legendText_size), -->
<!-- #                  axis.text = element_text(size = axisText_size), -->
<!-- #                  axis.title = element_text(size = axisTitle_size)) -->
<!-- # gg <- gg + guides(fill = guide_legend(#nrow = 2, -->
<!-- #   override.aes = list(linetype = 0)), -->
<!-- #   color = guide_legend(override.aes = list(linetype = 0))) -->
<!-- # gg <- shift_legend2(gg) -->
<!-- # gg <- ggplotify::as.ggplot(gg) -->

<!-- ``` -->


<!-- \begin{equation} -->
<!-- \frac{\partial U}{\partial x} \sim \frac{1}{x} -->
<!-- \label{eq:dimUtilDefine} -->
<!-- \end{equation} -->

<!-- Where, to be clear, the term $\partial U / \partial x$ is the marginal change in utility given a marginal increase in the quantity of good $x$, and "$\sim 1 / x$", means "inversely proportionate to the quantity of good $x$ already acquired". An expression $U(x)$ for the utility of good $x$ can then be obtained by integrating Bernoulli's statement. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \int \frac{d U}{d x} \: dx &= \int \alpha \frac{d \ln(x)}{dx} \: dx \\ -->
<!-- U(x)  &= \alpha \ln(x) + k -->
<!-- \end{split} -->
<!-- \label{eq:integrate_lnU} -->
<!-- \end{equation} -->

<!-- Where the proportionality constant $\alpha = dU/d\ln(x)$ regulates the marginal change in utility given a $1$ percent increase in good $x$. -->

<!-- Assuming that consumers want to maximize utility, then the marginal utility of the good must be equal to the marginal utility of the consumer's budget (income), $B$, for a marginal increment in $x$. -->

<!-- \begin{equation} -->
<!-- \frac{\partial \ln(B)}{\partial x} = \frac{d \ln(x)}{dx} -->
<!-- \label{eq:assumption} -->
<!-- \end{equation} -->
<!-- <!-- If $x$ is defined as an expenditure, and other expenditures are held constant, then $dB = dx$, and --> -->
<!-- By which it then follows -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \int \alpha_B \frac{\partial \ln(B)}{\partial x} \: dx &= \int \alpha_x \frac{d \ln(x)}{dx} \: dx \\ -->
<!-- \alpha_B \ln(B) + k_B  &= \alpha_x \ln(x) + k_x -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Which can then be rearranged into a log-linear expression. -->

<!-- \begin{equation} -->
<!-- \ln(x) = \beta \ln(B) + c -->
<!-- \label{eq:general_law} -->
<!-- \end{equation} -->

<!-- Where -->

<!-- \begin{equation} -->
<!-- \beta = \alpha_B / \alpha_x = \frac{d \ln(x)}{d \ln(B)}, \:\: c = (k_B - k_x) / \alpha_x -->
<!-- \end{equation} -->
