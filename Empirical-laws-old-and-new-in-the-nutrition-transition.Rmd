---
title: Empirical laws, old and new, in the nutrition transition
author:
  - name: Benjamin Schiek
    email: b.schiek@cgiar.org
    affiliation: Alliance Bioversity-CIAT
    footnote: Corresponding Author
address:
  - code: Alliance Bioversity-CIAT
    address: Alliance Bioversity-CIAT, Km 17 Recta Cali-Palmira, Valle del Cauca, Colombia
abstract: |
  Much of the Nutrition Transition literature implicitly rests upon Engel's Law and Bennett's Law. However, rarely are these key empirical laws explicitly referenced or visualized in a straightforward manner. There is evidence that this may be due to a general lack of familiarity with these old laws and their relevance to modern discussions of dietary transitions, food security, and resilient food systems. Here I address this gap with an in-depth, graphical review of Engel's and Bennett's Laws, including analysis of their stability across time and space. Animations (provided as supplemental materials) offer further striking visualization of the laws' evolution over time. I then propose a theoretical framework by which to unify the two laws as separate manifestations of the single underlying principle of diminishing marginal utility. Finally, I present a new empirical law that appears to have gone unnoticed until now: a log-linear corresponance between the mean prices of agricultural commodities and their respective volatilities.
keywords: Nutrition transition, Bennett's Law, Engel's Law, food demand, food price volatility, food security, food systems
journal: Food Policy
bibliography: Empirical laws, old and new, in the nutrition transition.bib
header-includes:
  - \usepackage{float}
  - \floatplacement{figure}{H}
#linenumbers: true
numbersections: true
output:
  rticles::elsevier_article:
    latex_engine: xelatex
mainfont: Garamond
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE)
library(plyr)
library(tidyverse)
library(patchwork)
library(ggrepel)
#library(kableExtra)
shape_vec <- c(21:24, 4)
point_size <- 1.5
smallPoint_size <- 1
label_size <- 2.5
smallLabel_size <- 2
title_size <- 8
subtitle_size <- 7
legendText_size <- 7
axisText_size <- 6
axisTitle_size <- 7
facetTitle_size <- 7
#==========================================================================
shift_legend2 <- function(p) {
  # ...
  # to grob
  gp <- ggplotGrob(p)
  facet.panels <- grep("^panel", gp[["layout"]][["name"]])
  empty.facet.panels <- sapply(facet.panels, function(i) "zeroGrob" %in% class(gp[["grobs"]][[i]]))
  empty.facet.panels <- facet.panels[empty.facet.panels]
  
  # establish name of empty panels
  empty.facet.panels <- gp[["layout"]][empty.facet.panels, ]
  names <- empty.facet.panels$name
  # example of names:
  #[1] "panel-3-2" "panel-3-3"
  
  # now we just need a simple call to reposition the legend
  #lemon::reposition_legend(p, 'center', panel=names)
  p_out <- lemon::reposition_legend(p, 'center', panel=names)
  #class(lemon::reposition_legend(p, 'center', panel=names))
  return(p_out)
}
#==========================================================================

```

# Introduction

A good understanding of Bennett's Law [@bennett1941international] and Engel's Law [@zimmerman1932ernst; @stigler1954early] is key to understanding the future composition and quantity of food demand as incomes rise. The FAO takes Engel's Law as a starting point in its expert-based estimates of future food demand [@alexandratos2012world], and four of the ... most prominent agricultural sector equilibrium models have Engel's Law at their core [@valin2014future]. Engel's and Bennett's Laws also form the _implicit_ basis for much of the modern discussion regarding dietary transitions, future food demand, food/nutritional security, and resilient food systems [@popkin1993nutritional; @kearney2010food; @popkin2012global; bodirsky2015global]. However, there is surprisingly little explicit reference to the laws in this literature. In a few instances, the laws are mischaracterized or rediscovered without crediting Engel or Bennett.
<!-- Instances of rediscoveryof Engel: Brown, Tilman -->
<!-- Instances of rediscovery of Bennett: The entire nutrition transition literature -->
<!-- Mischaracterizaton of Engel: Valin et al. -->
<!-- Mischaracterization of Bennett: Valin et al. (move toward fats and sugars) -->

Here I append a footnote to the discussion in order to address this apparent lack of familiarity with the origins and relevance of Bennett's and Engel's Laws. Drawing on the FAO Food Balance Sheets and the World Bank International Comparison Project, I present a brief graphical review of the laws, including an analysis of the laws' stability over time. [[I present a novel corrollary of Bennett's Law in terms of a fat-carbohydrate tradeoff frontier, and discuss implications for dietary transitions.]] I walk through an example of how the laws can be used for parsimonious, back-of-the-envelope projections of future food demand and composition. [[The estimate for 2050 is in line with the projections of various models and with FAO's expert assessment [], but considerably less than a much cited estimate by Tilman et al. [], which was also based on a parsimonious application of Engel's Law.]]

[[The data suggest that Engel's and Bennett's Laws are two instances of a broad class of consumption-income laws covering most food and non-food commodities.]] I propose a thoeretical explanation of Bennett's and Engel's as consequences of a single overarching law---the Law of Diminishing Marginal Utility---which potentially sheds light on the economic meaning of the law's parameters, the circumstances under which the parameter values may change, and why Bennett's and Engel's Laws have remained relatively popular compared to analogous laws for other food and non-food goods.

Finally, I present a new empirical law that appears to have gone unnoticed until now: a log-linear relation between a commodity's expected price and its price volatility. This may serve to open up new perspectives on the role of price risk in food system resilience and nutritional security---a topic which has so far received little attention in the literature.


@stigler1954early
@clements2018engel
@theil1989international
@pope2012

-surprising lack of explicit reference to the laws in the nutrition transition literature. (although the laws figure centrally in the food demand modeling literature (although they are sometimes mischaracterized))
-mischaracterizations of Laws (esp. Engel in [valin])
-rediscovery of Laws without giving credit [Brown; Tilman]
-in the demand literature there is an insistence that Engel's Law is second order (elasticty changes with income), but this is true by construction (Florida PI); the data fit a double log form perfectly well.

  An important precursor to the modern discussion [@brown1963man] was less circumspect, but also neglected to indicate the origins of these empirical laws. It appears, moreover, that many donors, breeding programs, and academic researchers are simply unaware of the laws' existence. Tilman et al. [-@tilman2011global], for example, present what they believe to be a newly discovered empirical relation between income and calorie consumption. In fact, this relation was previously documented by Brown [-@brown1963man], and is probably best characterized as an alternative formulation of Engel's Law. Donors and international breeding programs, meanwhile, continue to focus resources on starchy crops in excess of what would be justified by Bennett's Law [@wiebe2020modeling; @finplan2018].
mention of Engel's Law: [@muhammad2011international]


<!-- I then propose a theoretical unification of the two laws by deriving them both from the same principle of diminishing returns to marginal increases in expenditures on inferior goods. -->
# What are empirical laws?

The word "law" connotes a binding, absolute character that is ill-suited to the social sciences. Here, "empirical laws" (also known as "stylized facts") are, rather, observed historical tendencies. As Houthakker put it:

>"[Empirical] laws are in the first instance empirical regularities, which may originally have been observed without much theoretical basis.... A large part of the business of the empirical sciences is to develop theories within which already discovered laws have their place and new regularities can be explored" [@houthakker1992there].

The formulation of empirical laws is thus often the first step in a natural progression from a purely observational basis towards a theoretical basis for understanding. As it matures, the theoretical basis typically has the effect of unifying several diverse empirical laws in a single explanatory framework. In the physical sciences, Keppler's Laws, Pouseille's Law, Faraday's Law, and Hooke's Law were all first formulated as seemingly unrelated empirical laws. Only later were they shown to follow from a single theoretical framework (Newton's). This deepened understanding of both the empirical laws and the theory itself. Again, in Houthakker's words,

>"By linking...laws to other phenomena the theories give meaning to the laws, for a mere empirical regularity conveys only limited credibility and cannot be extrapolated with much confidence. In their turn, the laws give significance to the theories that can account for them" [@houthakker1992there].

As a general rule, empirical laws are considerably messier in the social sciences, and efforts to establish unifying theoretical frameworks considerably less successful, than they are in the physical sciences. However, the basic process remains the same in any empirical science: to observe and document diverse empirical regularities, on the one hand; and, on the other, to propose credible axioms that generate a plausible, unifying explanation of the diversely observed regularities.

# Bennett's Law

>"The broad fact that variety rather than uniformity is characteristic of food consumption throughout the world is familiar and indisputable. Differences are found in the 'dishes' consumed from country to country, region to region, locality to locality, even family to family. Within a country or region, these differences appear also from one epoch to another. They are so prevalent and conspicuous, in fact, that it seems almost hopeless to discover, in the international sphere, some way of characterizing summarily the diets of different nations and contrasting them one with the other" [@bennett1941international].

Even within a fairly small geographical region of Africa, diets vary considerably (Figure \ref{fig:dietDiversity}). Nonetheless, Bennett found the "way of characterizing summarily the diets of different nations" he was looking for by examining the starchy calorie content of diets in relation to income.

```{r, fig.show = "hold", fig.width = 5, fig.height=4, fig.align="left", fig.cap="\\label{fig:dietDiversity}Diets are diverse. Source: Author's creation based on the FAO Food Balance Sheets (FBS).", echo = FALSE}
this_file <- "Bennetts Law FAO FBS and WDI data.csv"
df_bennett <- read.csv(this_file, stringsAsFactors = F)
df_bennett$Year <- as.integer(df_bennett$Year)
u <- colnames(df_bennett)
colnames(df_bennett)[which(u == "GDP.capita..USD...logged")] <- "GDP/capita (USD), logged"
colnames(df_bennett)[which(u == "GDP.capita..USD.")] <- "GDP/capita (USD)"
colnames(df_bennett)[which(u == "GDP..million.USD.")] <- "GDP (million USD)"
colnames(df_bennett)[which(u == "Population..millions.")] <- "Population (millions)"
colnames(df_bennett)[which(u == "Population..millions...logged")] <- "Population (millions), logged"

# Slovakia an outlier with >50% fat share of diet. Rest of countries <44%
df_bennett <- subset(df_bennett, Area != "Slovakia")

df_diets <- df_bennett[, c("Area", "Year", "Element", "Item", "Value")]
df_diets <- subset(df_diets, Element == "Food supply (kcal/capita/day)" &
                     !(Item %in% c("Animal fats", "Meat")))
#unique(df_diets$Element)
#unique(df_diets$Item)
df_tot <- subset(df_diets[, c("Area", "Year", "Item", "Value")], Item == "Grand Total")
df_diets <- subset(df_diets, Item != "Grand Total")
colnames(df_tot)[which(colnames(df_tot) == "Value")] <- "Total (kcal/capita/day)"
df_tot$Item <- NULL
df_diets$Item[grep("Cereals", df_diets$Item)] <- "Cereals"
df_diets$Item[grep("Sugar", df_diets$Item)] <- "Sugar\n& sweeteners"
df_diets$Item[grep("Animal", df_diets$Item)] <- "Animal\nproducts"
df_diets$Item[grep("Roots", df_diets$Item)] <- "Starchy\nroots"
df_diets$Item[grep("Fruit", df_diets$Item)] <- "Fruits\n& Vegetables"
df_diets$Item[grep("Veget", df_diets$Item)] <- "Fruits\n& Vegetables"
df_diets <- df_diets %>% 
  group_by(Area, Year, Item) %>%
  summarise(Value = sum(Value, na.rm = T)) %>% as.data.frame()
df_diets <- merge(df_diets, df_tot, by = c("Area", "Year"))
colnames(df_diets)[which(colnames(df_diets) == "Value")] <- "Food supply (kcal/capita/day)"
df_diets$`Share of daily diet` <- df_diets$`Food supply (kcal/capita/day)` / df_diets$`Total (kcal/capita/day)`
df_other <- df_diets %>% group_by(Area, Year, `Total (kcal/capita/day)`) %>%
  summarise(`Share of daily diet` = sum(`Share of daily diet`, na.rm = T)) %>% as.data.frame()
df_other$`Share of daily diet` <- 1 - df_other$`Share of daily diet`
df_other$`Food supply (kcal/capita/day)` <- df_other$`Share of daily diet` * df_other$`Total (kcal/capita/day)`
df_other$Item <- "Other"
df_other <- df_other[, colnames(df_diets)]
df_diets <- rbind(df_diets, df_other)
#-----------------------------------------------------------------------------
area_vec <- c("Kenya", "Uganda", "Ethiopia", "Tanzania", "Rwanda")
df_plot <- subset(df_diets, Area %in% area_vec &
                    Year > 1992)
yr_min <- min(df_plot$Year)
yr_max <- max(df_plot$Year)
n <- length(unique(df_plot$Item))
bag_of_colors <- randomcoloR::distinctColorPalette(k = 2 * n)
color_vec <- sample(bag_of_colors, n)
#good_colors <- c("#B346E2", "#74B4D0", "#E16953", "#D6E1D8", "#C7E84D", "#6BE47C", "#E4B64D")
# c("#D6A5D7" "#7EB0DD" "#E0AF9B" "#85E1DC" "#727AD6" "#DA74DA" "#729381" "#DB6A4A")
#color_vec <- good_colors
df_plot <- df_plot %>% group_by(Area, Item) %>%
  mutate(mu_food_area_item = mean(`Share of daily diet`, na.rm = T)) %>%
  as.data.frame()
df_plot$Item <- factor(df_plot$Item,
                       levels = unique(df_plot$Item[order(df_plot$mu_food_area_item, df_plot$Item, decreasing = T)]),
                       ordered = T)
gg <- ggplot(df_plot, aes(x = Year, y = `Share of daily diet`, fill = Item))
gg <- gg + geom_area(position = "stack")
gg <- gg + scale_x_continuous(breaks = seq(yr_min, yr_max, length.out = 4))
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + facet_wrap(~Area, ncol = 3)
gg <- gg + theme(legend.title = element_blank(),
                 legend.text = element_text(size = 7),
                 legend.key.size = unit(0.3, "cm"),
                 strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                 axis.title.x = element_blank(),
                 axis.title.y = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size))
gg <- gg + guides(fill = guide_legend(nrow = 4, byrow = T))
gg <- shift_legend2(gg)
gg <- ggplotify::as.ggplot(gg)


```

Bennett did not have the advantage of the FAO Food Balance Sheets at his disposal, and so had to painstakingly assemble his data from diverse sources. Having done so for 34 countries, he noticed that the cereal and starchy root content of diets varied widely across countries---from 30% to 90%. And he noticed that this percentage tended to be greater in countries where incomes were relatively low. After considering a number of alternative explanations for the variation such as climate, preference, and religious taboo, he concluded that "explanation of the differences in the degree of dependence on cereal-potato calories is to be found chiefly in the relative economic status of nations or of families". And, more specifically, "irregularities and exceptions [aside], a rough inverse relation between level of income and dependence upon cereal-potato calories seems to exist and to have a rational causal basis, whether comparisons refer to families, localities, or nations" [@bennett1941international]. (Bennett used "potato" as a shorthand for "starchy roots and tubers" in general. In this article, I follow FAO in using "starchy roots" as the shorthand.)

Bennett presented this finding not in terms of a regression analysis or a scatterplot of country income against country cereal and starchy root intake, but rather as a world map, with the 34 countries for which he had data shaded according to their respective cereal and starchy root intake. In subsequent work, he extended this to 52 countries, and presented results in a bar chart [@bennett1941wheat]. Drawing on FAO's Food Balance Sheets, it is now possible to extend Bennett's analysis to anywhere between 144 and ...?170 countries, depending upon the year of analysis. A scatterplot of logged country cereal and starchy root intake against logged country income (GDP in USD at the market exchange rate) for 2017 in Figure \ref{fig:Bennett01} confirms the inverse relation he documented. This empirical relation, now known as Bennett's Law, indicates that, regardless of differences in culture, climate, and preference, cereals and starchy roots constitute a declining portion of the diet as income rises. [Bennett's Law can also be approximated using the World Bank's International Comparison Project (ICP) data, by combining the "bread and cereals " with the "vegetable" category.]

<!-- "All over the world, the important groups of foods may be classified as (1) cereals and "potatoes" ; (2) sugars; (3) vegetable oils; (4) fruits, nuts, legumes, and relatively non-starchy and leafy vegetables; and (5) meats, animal fats, dairy products, eggs, and fish. Of these five groups, the first and second are rich in carbohydrate calories, but relatively poor in proteins, certain vitamins, and cer-tain minerals. The third, vegetable oils, are rich in fat but again not in proteins, vitamins, or minerals. The so-called protective foods are usually those found in the fourth and fifth groups, and the fifth group is a major source of the better proteins" [@bennett1941wheat]. -->
<!-- "The indicator is a very rough one. Hypothetically, of two nations each deriving 50 per cent of its total calories from cereals and potatoes, one of the nations might conceivably derive the remainder of its total calories from sugars and vegetable oils. In this case the diet would be qualitatively poor. The other na-tion might derive the remainder of its calories from meats, milk, leafy vegetables, fruits, and nuts. In this case the diet would be qualitatively good" [@bennett1941wheat]. -->
<!-- Food balance data  provide  information  about  a  country's  average  percapita dietary energy supply, which indicates the amount offood available for human consumption in the country. This isa  measure  of  food  production,  taking  account  of  importsminus  exports, losses  for  animal  feed, wastage  and  millingextraction rates. It ignores food lost at the retail and house-hold  level  and  is  an  approximation  of  average  intake.  Ingeneral,  this  is  approximately  10-14%  above  actual  foodavailable  for  intake  at  the  household  level [@popkin1993nutritional],  but  the  overallstructure of diet is remarkably similar to that seen with foodbalance data. -->

<!-- FBSs are constructed by the FAO from nationalaccounts of the supply and use of foods, and are calcu-lated from the food produced in and imported intocountries minus the food exported net of imports,fed to animals or otherwise not available for humanconsumption, divided by the population size. FBSdata provide information about average availabilityper person, that is they relate simply to the quantitiesof food reaching the consumer (i.e. a measure ofavailability). FBSs, while describing consumption offoods per capita of the population for a country, donot represent the amount of food actually consumedand will almost invariably result in an overestimationin food consumption compared with dietary surveysat the individual level (Serra-Majemet al. 2003).This point is also clearly illustrated in another driverreview (Hawkesworthet al. 2010). -->
<!-- [@serra2003comparative; @hawkesworth2010feeding] -->

```{r, fig.show = "hold", fig.width = 6, fig.height=4, fig.align="center", fig.cap="\\label{fig:Bennett01}Bennett's Law. Source: Author's creation using the FAO FBS for 2017.", echo = FALSE}
# 4 calories in a gram of protein or carbohydrate, 9 calories in a gram of fat.
# https://www.nal.usda.gov/fnic/how-many-calories-are-one-gram-fat-carbohydrate-or-protein
#===========================================================================
# Bennett's Law
# Create data set for all food categories.
gdpPop_vars <- c("GDP/capita (USD), logged", "GDP/capita (USD)", "GDP (million USD)", "Population (millions)")
these_cols <- c("Area", "Year", "Region", "Element",
                "Item", "Value", gdpPop_vars)
# these_items <- c("Cereals - Excluding Beer", "Starchy Roots",
#                  "Grand Total")
exclude_items <- c("Animal fats", "Meat")
#unique(df_bennett$Item)
#setdiff(these_cols, colnames(df_bennett))
df_foodShare <- subset(df_bennett[, these_cols], !(Item %in% exclude_items) &
                    Element == "Food supply (kcal/capita/day)")
df_tot <- subset(df_foodShare[, c("Area", "Year", "Item", gdpPop_vars, "Value")], Item == "Grand Total")
df_tot$Item <- NULL
colnames(df_tot)[ncol(df_tot)] <- "Total (kcal/capita/day)"
df_foodShare <- subset(df_foodShare, Item != "Grand Total")
df_foodShare$Item[grep("Cereals|Starchy", df_foodShare$Item)] <- "Cereals & starchy roots"
df_foodShare$Item[grep("Fruits|Vegetables", df_foodShare$Item)] <- "Fruits & vegetables"
df_foodShare$Item[grep("Animal Products", df_foodShare$Item)] <- "Animal products"
df_foodShare$Item[grep("Sugar", df_foodShare$Item)] <- "Sugar & sweeteners"
df_foodShare <- df_foodShare %>% 
  group_by(Region, Area, Year, Item) %>%
  summarise(Value = sum(Value, na.rm = T)) %>% as.data.frame()
#---
df_foodShare <- merge(df_foodShare, df_tot, by = c("Area", "Year"))
colnames(df_foodShare)[which(colnames(df_foodShare) == "Value")] <- "Diet share (kcal/capita/day)"
df_foodShare$`Diet share (%)` <- 100 * df_foodShare$`Diet share (kcal/capita/day)` /
  df_foodShare$`Total (kcal/capita/day)`
df_foodShare$`Diet share (%), logged` <- 
  log(df_foodShare$`Diet share (%)`)
df_foodShare$`Diet share (kcal/capita/day), logged` <- 
  log(df_foodShare$`Diet share (kcal/capita/day)`)
#-----------------------------------------------------------------------------
# Highlight some countries in plot
# label_Africa <- c("Tanzania", "Uganda", "Ethiopia", "South Africa",
#                   "Ghana")
# label_NAfricaWAsia <- c("Turkey", "Saudi Arabia")
# label_Asia <- c("India", "Iran", "China, mainland", "Vietnam", "Japan",
#                 "South Korea")
# label_NAmEurAusNZ <- c("Italy", "France", "Australia")
# label_LAC <- c("Nicaragua", "Colombia", "Brazil")
# labelThese_vec <- c(label_Africa, label_NAfricaWAsia, label_Asia,
#                     label_NAmEurAusNZ, label_LAC)
label_Africa <- c("Uganda", "South Africa")
label_NAfricaWAsia <- c("Turkey", "Saudi Arabia")
label_Asia <- c("India", "China, mainland", "Vietnam")
label_NAmEurAusNZ <- c("France", "Australia")
label_LAC <- c("Nicaragua", "Colombia", "Brazil")
labelThese_vec <- c(label_Africa, label_NAfricaWAsia, label_Asia,
                    label_NAmEurAusNZ, label_LAC)
df_foodShare$label_these <- NA
u <- df_foodShare$Area
df_foodShare$label_these[which(u %in% labelThese_vec)] <- df_foodShare$Area[which(u %in% labelThese_vec)]
#-----------------------------------------------------------------------------
# Subset data for just cereals and starchy roots
df_plot <- subset(df_foodShare, Item == "Cereals & starchy roots" &
                     Year == 2017 & Region != "Aggregated")
colnames(df_plot) <- gsub("Diet share", "Cereals & starchy roots", colnames(df_plot))
colnames(df_plot) <- gsub("%", "% of diet", colnames(df_plot))
#-----------------------------------------------------------------------------
# Fit parameters
mod <- lm(`Cereals & starchy roots (% of diet), logged` ~ `GDP/capita (USD), logged`, data = df_plot)
#summary(mod)
#plot(mod$fitted.values, mod$residuals)
#ind_rm <- which(mod$residuals == min(mod$residuals))
#df_plot$Area[ind_rm]
m <- round(mod$coefficients[2], 4)
b <- round(mod$coefficients[1], 4)
df_out <- as.data.frame(broom::glance(mod))
adjR2 <- round(df_out$adj.r.squared, 2)
#-----------------------------------------------------------------------------
# Get colors for region groupings and title
n <- length(unique(df_plot$Region))
bag_of_colors <- randomcoloR::distinctColorPalette(k = 2 * n)
color_vec <- sample(bag_of_colors, n)
this_subtitle <- paste0("Adj. R-squared = ", adjR2, "\nSlope = ", m, ", Y intercept = ", b)
#-----------------------------------------------------------------------------
gg <- ggplot(df_plot, aes(x = `GDP/capita (USD), logged`,
                          y = `Cereals & starchy roots (% of diet), logged`,
                          group = Region, fill = Region,
                          shape = Region,
                          label = label_these))
gg <- gg + geom_smooth(aes(group = NULL, fill = NULL, shape = NULL), method = lm, se = F)
gg <- gg + geom_point(alpha = 0.6, size = point_size, color = "black", stroke = 0.5)
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
#gg <- gg + geom_text_repel(color = "black", size = label_size)
gg <- gg + labs(subtitle = this_subtitle)#,
gg <- gg + guides(fill = guide_legend(nrow = 2, byrow = T, override.aes = list(linetype = 0)),
                  color = guide_legend(override.aes = list(linetype = 0)))
gg <- gg + theme(legend.position = "bottom",
                  legend.spacing.x = unit(0.25, 'cm'),
                  legend.title = element_blank(),
                 legend.text = element_text(size = legendText_size),
                 plot.title = element_text(size = title_size),
                 plot.subtitle = element_text(size = subtitle_size),
                 axis.title = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size))
gg_bennett <- gg
#ggsave("Bennetts Law 2017 FAO.png", width = 4, height = 4, units = "in")

#---------------------------------------------------------------------------
these_cols <- c("Area", "Year", "Region", "Item", "Diet share (%), logged",
                gdpPop_vars)
df_cerRootShare <- subset(df_foodShare, Item == "Cereals & starchy roots")
u <- colnames(df_cerRootShare)
colnames(df_cerRootShare) <- gsub("Diet share", "Cereals & starchy roots", u)
u <- colnames(df_cerRootShare)
colnames(df_cerRootShare) <- gsub("%", "% of diet", u)
df_cerRootShare$Item <- NULL
df_params <- df_cerRootShare
df_params <- subset(df_params, Region != "Aggregated")
yr_vec <- unique(df_params$Year)
n_yrs <- length(yr_vec)
mBennett_vec <- c()
bBennett_vec <- c()
adjR2Bennett_vec <- c()
NBennett_vec <- c()
for(i in 1:n_yrs){
  this_year <- yr_vec[i]
  this_df <- subset(df_params, Year == this_year)
  this_df$Year <- NULL
  #---------------------------------------------------
  mod <- lm(`Cereals & starchy roots (% of diet), logged` ~ `GDP/capita (USD), logged`, this_df)
  mBennett_vec[i] <- round(mod$coefficients[2], 6)
  bBennett_vec[i] <- round(mod$coefficients[1], 6)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2Bennett_vec[i] <- df_out$adj.r.squared
  NBennett_vec[i] <- length(mod$fitted.values)

}
df_plotBennett <- data.frame(Year = yr_vec, Slope = mBennett_vec, bBennett_vec, adjR2Bennett_vec, NBennett_vec)
colnames(df_plotBennett)[3:5] <- c("Y intercept", "Adj. R-squared", "Sample size")
df_plotBennett$Year <- as.integer(as.character(df_plotBennett$Year))


df_plot <- df_plotBennett %>% gather(Type, Value, Slope:`Sample size`)
gg <- ggplot(df_plot, aes(x = Year, y = Value))
gg <- gg + geom_line()
# gg <- gg + scale_x_continuous(breaks = seq(yr_vec[1], yr_vec[n_yrs - 1], length.out = 24))
gg <- gg + facet_wrap(~Type, ncol = 1, scales = "free_y")
gg <- gg + labs(subtitle = "Bennet's Law parameter trajectory")
gg <- gg + theme(axis.title = element_blank(),
                  #axis.text.x = element_text(angle = 60, hjust = 1),
                  strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                plot.title = element_text(size = title_size),
                plot.subtitle = element_text(size = subtitle_size),
                axis.text = element_text(size = axisText_size))
gg_bennettStab <- gg
#----------------------------------------------------------------------------
gg_bennett + gg_bennettStab + plot_layout(ncol = 2, guides = "collect") & theme(legend.position = 'bottom')
#----------------------------------------------------------------------------
# df_plot <- subset(df_foodShare, Year == 2017 & Region != "Aggregated")
# df_plot <- df_plot %>% group_by(Area, Item) %>%
#   mutate(mu_food_area_item = mean(`Diet share (%)`, na.rm = T)) %>%
#   as.data.frame()
# df_plot$Item <- factor(df_plot$Item,
#                        levels = unique(df_plot$Item[order(df_plot$mu_food_area_item, df_plot$Item, decreasing = T)]),
#                        ordered = T)
# df_plot$`GDP/capita (USD), logged` <- as.numeric(df_plot$`GDP/capita (USD), logged`)
# gg <- ggplot(df_plot, aes(x = reorder(Area, `GDP/capita (USD), logged`),
#                           y = `Diet share (kcal/capita/day)`, fill = Item))
# gg <- gg + geom_bar(stat = "identity", color = "black") #(position = "stack")
# #gg <- gg + facet_wrap(~Region, ncol = 3, scales = "free_x")
# gg <- gg + theme(axis.text.x = element_text(angle = 60, hjust = 1))
# gg
#============================================================================
# Bennett's Law using the WB ICP data
# this_file <- "Engels Law WB ICP data.csv"
# df_icp <- read.csv(this_file, stringsAsFactors = F)
# colnames(df_icp) <- gsub("US\\.\\.", "US$", colnames(df_icp))
# colnames(df_icp) <- gsub("\\.\\.", ", ", colnames(df_icp))
# colnames(df_icp) <- gsub("\\.", " ", colnames(df_icp))
# colnames(df_icp) <- gsub("billions ", "billions", colnames(df_icp))
# #unique(df_icp$Element)
# these_elements <- c("Expenditure per capita, market exchange rate-based (US$)",
#                     "Expenditure, market exchange rate-based (US$, billions)")
# # these_elements <- c("Expenditure per capita, PPP-based (US$)",
# #                     "Expenditure, PPP-based (US$, billions)")
# df_icp <- subset(df_icp, Element %in% these_elements)
# 
# #df_icp$Element[grep("share", df_icp$Element)] <- "expenditure (as % of GDP)"
# # df_icp$Element[grep("per capita", df_icp$Element)] <- "expenditure/capita (USD)"
# # df_icp$Element[grep("billions", df_icp$Element)] <- "expenditure (billion USD)"
# 
# u <- df_icp$Good
# df_icp$Good[which(u == "1101190:Food products n.e.c. (Class)")] <- "Other food"
# df_icp$Good[grep("Oils and fats", u)] <- "Oils and fats"
# df_icp$Good[grep("Sugar, jam", u)] <- "Sugary and sweet"
# df_icp$Good[grep("Milk, cheese and eggs", u)] <- "Milk, cheese and eggs"
# df_icp$Good[grep("Fish and seafood", u)] <- "Fish and seafood"
# df_icp$Good[grep("Meat", u)] <- "Meat"
# df_icp$Good[grep("Vegetable", u)] <- "Bread, cereals, and vegetables"
# df_icp$Good[grep("Bread", u)] <- "Bread, cereals, and vegetables"
# df_icp$Good[grep("Fruit", u)] <- "Fruit"
# df_icp$Good[grep("1101100:FOOD", u)] <- "Food"
#unique(u[grep("Food", u, ignore.case = T)])
#----------------------------------------------------------------------------
# goods_vec <- c("Oils and fats", "Sugary and sweet", "Milk, cheese and eggs",
#                "Fish and seafood", "Meat", 
#                "Bread, cereals, and vegetables", "Fruit", "Food")
# #unique(df_icp$Element)
# df_icpBen <- subset(df_icp, Good %in% goods_vec & Year == 2017)
# df_icpBen <- df_icpBen %>%
#   group_by(Region, Country, Year,
#            `Food GDP per capita, PPP based, US$`,
#            Element, Good) %>%
#   summarise(Expenditure = sum(Expenditure, na.rm = T)) %>%
#   as.data.frame()
# #unique(df_icpBen$Element)
# df_icpBenShare <- subset(df_icpBen, Element == "Expenditure, market exchange rate-based (US$, billions)")
# these_cols <- c("Country", "Good", "Expenditure")
# df_tot <- subset(df_icpBenShare[, these_cols], Good == "Food")
# # df_tot <- df_icpBenShare[, these_cols] %>%
# #   group_by(Country) %>%
# #   summarise(Expenditure = sum(Expenditure, na.rm = T)) %>%
# #   as.data.frame()
# df_tot$Good <- NULL
# colnames(df_tot)[ncol(df_tot)] <- "totFood_expend"
# df_icpBenShare <- subset(df_icpBenShare, Good != "Food")
# df_icpBenShare <- merge(df_icpBenShare, df_tot, by = "Country")
# df_icpBenShare$Expenditure <- 100 * df_icpBenShare$Expenditure / df_icpBenShare$totFood_expend
# df_icpBenShare$Element <- "expenditure (% of food expenditure)"
# df_icpBenShare <- df_icpBenShare[, colnames(df_icpBen)]
# df_icpBen <- as.data.frame(rbind(df_icpBen, df_icpBenShare))
# df_icpBen$`Expenditure, logged` <- log(df_icpBen$Expenditure)
# #unique(df_icpBen$Element)
# df_icpBen <- subset(df_icpBen, Element != "Expenditure, market exchange rate-based (US$, billions)")
# # df_icpBen <- subset(df_icpBen, Element != "Expenditure, PPP-based (US$, billions)")
# #----------------------------------------------------------------------------
# #unique(df_icpBen$Good)
# df_mod <- df_icpBen
# u <- colnames(df_mod)
# colnames(df_mod)[grep("Food GDP per capita", u)] <- "Food GDP/capita (USD)"
# df_mod$`Food GDP/capita (USD), logged` <- log(df_mod$`Food GDP/capita (USD)`)
# this_good <- "Bread, cereals, and vegetables"
# these_elements <- unique(df_mod$Element)
# subtitle_vec <- c()
# ylabel_vec <- c()
# for(i in 1:length(these_elements)){
#   this_element <- these_elements[i]
#   this_df <- subset(df_mod, Good == this_good &
#                     Element == this_element &
#                       Region != "Aggregated")
# mod <- lm(`Expenditure, logged` ~ `Food GDP/capita (USD), logged`, data = this_df)
# #summary(mod)
# #plot(mod$fitted.values, mod$residuals)
# m <- round(mod$coefficients[2], 4)
# b <- round(mod$coefficients[1], 4)
# df_out <- as.data.frame(broom::glance(mod))
# adjR2 <- round(df_out$adj.r.squared, 2)
# this_subtitle <- paste0("Adj. R-squared = ", adjR2, "\nSlope = ", m, ", Y intercept = ", b)
# subtitle_vec[i] <- this_subtitle
# ylabel_vec[i] <- paste0(this_good, "\n", this_element, ", logged")
# }
# 
# 
#   this_element <- these_elements[1]
#   this_subtitle <- subtitle_vec[1]
#   df_plot <- subset(df_mod, Good == this_good &
#                     Element == this_element &
#                       Region != "Aggregated")
# 
# gg <- ggplot(df_plot, aes(x = `Food GDP/capita (USD), logged`,
#                           y = `Expenditure, logged`,
#                           group = Region, fill = Region,
#                           shape = Region))
# gg <- gg + geom_smooth(aes(group = NULL, fill = NULL, shape = NULL), method = lm, se = F)
# gg <- gg + geom_point(alpha = 0.6, size = point_size, color = "black", stroke = 0.5)
# gg <- gg + scale_fill_manual(values = color_vec)
# gg <- gg + scale_shape_manual(values = shape_vec)
# #gg <- gg + geom_text_repel(color = "black", size = label_size)
# gg <- gg + labs(subtitle = this_subtitle, y = ylabel_vec[1])#,
# gg <- gg + guides(fill = guide_legend(nrow = 2, byrow = T, override.aes = list(linetype = 0)),
#                   color = guide_legend(override.aes = list(linetype = 0)))
# gg <- gg + theme(legend.position = "bottom",
#                   legend.spacing.x = unit(0.25, 'cm'),
#                   legend.title = element_blank(),
#                  legend.text = element_text(size = legendText_size),
#                  plot.title = element_text(size = title_size),
#                  plot.subtitle = element_text(size = subtitle_size),
#                  axis.title = element_text(size = axisTitle_size),
#                  axis.text = element_text(size = axisText_size))
# ggICP <- gg
# 
# 
#   this_element <- these_elements[2]
#   this_subtitle <- subtitle_vec[2]
#   df_plot <- subset(df_mod, Good == this_good &
#                     Element == this_element &
#                       Region != "Aggregated")
# 
# gg <- ggplot(df_plot, aes(x = `GDP/capita (USD), logged`,
#                           y = `Expenditure, logged`,
#                           group = Region, fill = Region,
#                           shape = Region))
# gg <- gg + geom_smooth(aes(group = NULL, fill = NULL, shape = NULL), method = lm, se = F)
# gg <- gg + geom_point(alpha = 0.6, size = point_size, color = "black", stroke = 0.5)
# gg <- gg + scale_fill_manual(values = color_vec)
# gg <- gg + scale_shape_manual(values = shape_vec)
# #gg <- gg + geom_text_repel(color = "black", size = label_size)
# gg <- gg + labs(subtitle = this_subtitle, y = ylabel_vec[2])#,
# gg <- gg + guides(fill = guide_legend(nrow = 3, byrow = T, override.aes = list(linetype = 0)),
#                   color = guide_legend(override.aes = list(linetype = 0)))
# gg <- gg + theme(legend.position = "bottom",
#                   legend.spacing.x = unit(0.25, 'cm'),
#                   legend.title = element_blank(),
#                  legend.text = element_text(size = legendText_size),
#                  plot.title = element_text(size = title_size),
#                  plot.subtitle = element_text(size = subtitle_size),
#                  axis.title = element_text(size = axisTitle_size),
#                  axis.text = element_text(size = axisText_size))
# ggICPshare <- gg
# #==========================================================================
# ggFAO + ggICP + plot_layout(guides = "collect") & theme(legend.position = 'bottom')
#==========================================================================


```
The double log formulation of Bennett's Law fits the FBS data well, especially since 1980; and the fitted parameters have remained remarkably stable over this period, ranging narrowly from ... to ... (Figure ..., right panel).

Bennett did not have the data necessary to answer the question of what replaces starchy staple calories as incomes rise. Considering that starchy staples are generally deficient in proteins and some key vitamins and minerals, he was tempted to interpret the starch share of diet as an inverse measure of the "relative qualitative adequacy of national diets" []. However, he acknowledged that

>"[t]he indicator is a very rough one. Hypothetically, of two nations each deriving 50 per cent of its total calories from cereals and potatoes, one of the nations might conceivably derive the remainder of its total calories from sugars and vegetable oils. In this case the diet would be qualitatively poor. The other nation might derive the remainder of its calories from meats, milk, leafy vegetables, fruits, and nuts. In this case the diet would be qualitatively good" [@bennett1941wheat].

Two influential works of the food crisis literature picked up this question again in the 1960s, rediscovering Bennett's Law in the process (without citing Bennett) [Brown;Priesse]. The modern discussion of nutrition transitions then picked up the topic again from the 1990s onwards. A review of the seminal works and surveys of this literature likewise turns up no mention of Bennett, although his discovery forms its implicit motivating basis [Popkin;Kearney;etc.].

Numerous studies of future food demand, on the other hand, do mention Bennett [Valin;Cirera and Massett;Bodirsky;Gouel;Timmer]. In this literature, Bennett's Law is sometimes characterized as a dietary shift towards animal products as incomes rise [valin; bodirsky]. Again, Bennett himself defined the relation exclusively in terms of a dietary shift _away_ from starchy cereals and roots, not as a shift _towards_ any particular food group. He did not have the data necessary to answer the question of what replaces starchy staples as incomes rise.

Thanks to the FAO FBS data, it is now clear that the former of Bennett's two hypothetical nations is closer to the true trajectory of most nations moving from low and middle income to upper income status. Starchy carbohydrate calories are replaced primarily by fat calories (of vegetable or animal origin), sugary carbohydrates, and other sweeteners [@kearney2010food;]. 

the clear cut relation between diet share and income that Bennett observed for cereals and starchy roots does not hold for the other main food groups, with the possible exception of animal products (Figure ...).

Another approach is to look at macronutrients (Figure ... fat-carb frontier)

<!-- "protective foodstuffs rich in high-quality proteins, mineral salts, and vitamins" -->
```{r, fig.show = "hold", fig.width = 5, fig.height=6, fig.align="center", fig.cap="\\label{fig:whatReplaces1}Relation between non-starchy food group dietary shares and GDP/capita.", echo = FALSE}
df_plot <- subset(df_foodShare, Year == 2017 &
                    Region != "Aggregated")
gg <- ggplot(df_plot, aes(x = `GDP/capita (USD), logged`,
                          y = `Diet share (%), logged`,
                          group = Region, fill = Region,
                          shape = Region,
                          label = label_these))
#gg <- gg + geom_smooth(aes(group = NULL, fill = NULL, shape = NULL), method = lm, se = F)
gg <- gg + geom_point(alpha = 0.6, size = point_size, color = "black", stroke = 0.5)
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
gg <- gg + facet_wrap(~Item, ncol = 3, scales = "free_y")
#gg <- gg + geom_text_repel(color = "black", size = label_size)
gg <- gg + guides(fill = guide_legend(nrow = 2, byrow = T, override.aes = list(linetype = 0)),
                  color = guide_legend(override.aes = list(linetype = 0)))
gg <- gg + theme(legend.position = "bottom",
                  legend.spacing.x = unit(0.25, 'cm'),
                  legend.title = element_blank(),
                 legend.text = element_text(size = legendText_size),
                 plot.title = element_text(size = title_size),
                 plot.subtitle = element_text(size = subtitle_size),
                 axis.title = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size))
gg
# gg <- shift_legend2(gg)
# gg <- ggplotify::as.ggplot(gg)



```

Dietary transitions may also be examined in terms of macronutrient shares. In this approach, food groups are conflated into one of three categories: carbohydrates, proteins, or fats; and the question is reduced to: "what replaces carbohydrate consumption as income rises?" This simplification thus comes at the cost of sacrificing fine distinctions between starchy carbohydrate and sugary or complex carbohydrate consumption, or distinctions between vegetable and animal fat and protein consumption, which are known to respond differently to increases in income [].

Brown [-@brown1963man] plotted FBS protein calorie intake data against GNP and concluded that "[p]rotein intake is quite responsive to income". However, this was subsequently contradicted by Perisse et al. [-@perisse1969effect], who implement a more meticulous method using the 1965 FBS data to find that fat intake is responsive to increases in income, while the protein share of diets remains constant at about 11% across all income levels. Popkin and Drewnowski [] later presented an update of Perisse et al.'s study using 1990 FBS data. Their analysis results in a somewhat lower estimated response of fat intake to income than that found by Perisse et al. The authors interpret this in rather strong terms, calling the lower slope "a major shift in the structure of the global diet marked by an uncoupling of the classic relationship between incomes and fat intakes". One might be misled by this into thinking that fat intake and income are no longer correlated from 1990 onwards. Such a conclusion would be self-contradictory. The authors' estimated parameters are statistically significant, which would not be the case if the independent and explanatory variables in their model were unrelated (or "uncoupled"). Moreover, the FBS data exhibit a clear correlation between fat intake and income both before and after 1990 (as for example in ... panel of Figure  \ref{fig:whatReplaces2}). The slope of the empirical relation may change, but the relation itself remains intact across all years.
<!-- A question remains as to how much of the carbohydrates are replaced by proteins and how much are replaced by fats, as income rises. Cursory exploration of the data suggests that the carbohydrates are replaced almost exclusively by fats (right panel, Figure \ref{fig:Bennett01}). Drewnowski and Popkin [-@drewnowski1997nutrition] dispute this, claiming that globalization has led to increased fat intake regardless of income level. While there may be some truth to their argument in an absolute sense, Figure \ref{fig:Bennett01} seems to suggest quite clearly that relative fat intake is still highly coupled with income level, despite "globalized diets". -->

<!--  The slope on the fat-carb frontier is nearly -1, which supports this finding (although the y intercept (~91%) implies a constant protein share of 9%, slightly lower than Perisse et al.'s estimate). Metabolically speaking, constant protein intake in the face of declining carbohydrate intake implies increased consumption of animal products.^[The increased fat intake also implies this to some degree, although not necessarily, since fats may be acquired from non-animal sources.] The often mentioned dietary transition to animal products that accompanies rising incomes and urbanization may thus be considered a corrollary of Bennett's Law. -->

```{r, fig.show = "hold", fig.width = 5, fig.height=5, fig.align="center", fig.cap="\\label{fig:whatReplaces2}Relation between macronutrient dietary shares and GDP/capita.", echo = FALSE}

these_cols <- c("Area", "Region", "Year", "Element", "Item", "Value", "GDP/capita (USD)", "GDP/capita (USD), logged")
df_macnut <- subset(df_bennett[, these_cols], Item == "Grand Total")
df_macnut$Item <- NULL
# Convert g to kcal
df_macnut$Value[grep("Protein", df_macnut$Element)] <- 4 *
  df_macnut$Value[grep("Protein", df_macnut$Element)]
df_macnut$Value[grep("Fat", df_macnut$Element)] <- 9 *
  df_macnut$Value[grep("Fat", df_macnut$Element)]
df_macnut$Element[grep("Protein", df_macnut$Element)] <- "Protein supply (kcal/capita/day)"
df_macnut$Element[grep("Fat", df_macnut$Element)] <- "Fat supply (kcal/capita/day)"
# Calculate carb kcal
df_macnut <- df_macnut %>% spread(Element, Value)
df_macnut$`Carb supply (kcal/capita/day)` <- df_macnut$`Food supply (kcal/capita/day)` -
  df_macnut$`Protein supply (kcal/capita/day)` - df_macnut$`Fat supply (kcal/capita/day)`
# Create % of diet variable
df_tot <- df_macnut[, c("Area", "Year", "Food supply (kcal/capita/day)")]
df_macnut$`Food supply (kcal/capita/day)` <- NULL
gathercols <- colnames(df_macnut)[6:ncol(df_macnut)]
df_macnut <- df_macnut %>% gather_("Item", "Value", gathercols)
df_macnut$Item[grep("Protein", df_macnut$Item)] <- "Protein"
df_macnut$Item[grep("Fat", df_macnut$Item)] <- "Fat"
df_macnut$Item[grep("Carb", df_macnut$Item)] <- "Carbohydrate"
df_macnut <- merge(df_macnut, df_tot, by = c("Area", "Year"))
colnames(df_macnut)[7:8] <- c("Supply (kcal/capita/day)", "Total (kcal/capita/day)")
df_macnut$`Diet share (%)` <- 100 * df_macnut$`Supply (kcal/capita/day)` / df_macnut$`Total (kcal/capita/day)`
df_macnut$`Diet share (%), logged` <- log(df_macnut$`Diet share (%)`)
df_macnut$`Supply (kcal/capita/day), logged` <- log(df_macnut$`Supply (kcal/capita/day)`)
#---------------------------------------------------------------------------
# Plot macronutrient vs GDP/capita
df_plot <- subset(df_macnut, Year == 2017 & Region != "Aggregated")
gg <- ggplot(df_plot, aes(x = `GDP/capita (USD), logged`,
                          y = `Diet share (%), logged`,
                          group = Region, fill = Region,
                          shape = Region))
gg <- gg + geom_point(alpha = 0.6, color = "black", stroke = 0.5)
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
gg <- gg + facet_wrap(~Item, ncol = 2, scales = "free_y")
gg <- gg + guides(fill = guide_legend(nrow = 2, byrow = T, override.aes = list(linetype = 0)),
                  color = guide_legend(override.aes = list(linetype = 0)))
gg <- gg + theme(legend.position = "bottom",
                  legend.spacing.x = unit(0.25, 'cm'),
                  legend.title = element_blank(),
                 legend.text = element_text(size = legendText_size),
                 plot.title = element_text(size = title_size),
                 plot.subtitle = element_text(size = subtitle_size),
                 axis.title = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size))
gg <- shift_legend2(gg)
gg <- ggplotify::as.ggplot(gg)



```

A cleaner picture of the macronutrient transition is obtained by plotting carbohydrate diet shares against fat shares, as in Figure ....   This implies 

```{r, fig.show = "hold", fig.width = 4, fig.height=4, fig.align="center", fig.cap="\\label{fig:fatCarbFront}The fat-carb frontier. The size of the points are congruent with GDP/capita. Source: Author's creation using the FAO FBS for 2017. Grams are converted to calories assuming a ratio of 4 calories per gram of protein or carbohydrate, and 9 calories per gram of fat, in accordance with U.S. Dept. of Agriculture guidelines.", echo = FALSE}

# Fat-carb frontier
df_macnutShare <- df_macnut[, c("Area", "Region", "Item", "Year", "Diet share (%)", "GDP/capita (USD)")]
df_macnutShare <- df_macnutShare %>% spread(Item, `Diet share (%)`)
# Get parameters
df_mod <- subset(df_macnutShare, Year == 2017 & Region != "Aggregated")
mod <- lm(`Fat`~`Carbohydrate`, df_mod)
#summary(mod)
m <- round(mod$coefficients[2], 4)
b <- round(mod$coefficients[1], 4)
df_out <- as.data.frame(broom::glance(mod))
adjR2 <- round(df_out$adj.r.squared, 2)
this_subtitle <- paste0("Adj. R-squared = ", adjR2, ", Slope = ", m, ", Y intercept = ", b)
# Plot
colnames(df_macnutShare)[5:7] <- paste(colnames(df_macnutShare)[5:7], "(% of diet)")

df_plot <- subset(df_macnutShare, Year == 2017 & Region != "Aggregated")
df_plot$label_these <- NA
u <- df_plot$Area
df_plot$label_these[which(u %in% labelThese_vec)] <- df_plot$Area[which(u %in% labelThese_vec)]

gg <- ggplot(df_plot, aes(x = `Carbohydrate (% of diet)`,
                          y = `Fat (% of diet)`,
                          group = Region, fill = Region,
                          shape = Region, size = `GDP/capita (USD)`,
                          label = label_these))
gg <- gg + geom_point(alpha = 0.6, color = "black", stroke = 0.5)
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
gg <- gg + labs(subtitle = this_subtitle)
gg <- gg + geom_smooth(aes(group = NULL, fill = NULL, shape = NULL), method = lm, se = F)
gg <- gg + geom_text_repel(color = "black", size = label_size)
gg <- gg + theme(legend.position = "none",
                legend.spacing.x = unit(0.25, 'cm'),
                legend.title = element_blank(),
                legend.text = element_text(size = legendText_size),
                plot.title = element_text(size = title_size),
                plot.subtitle = element_text(size = subtitle_size),
                axis.title = element_text(size = axisTitle_size),
                axis.text = element_text(size = axisText_size))
gg <- gg + guides(fill = guide_legend(nrow = 2, byrow = T, override.aes = list(linetype = 0)),
                  color = guide_legend(override.aes = list(linetype = 0)),
                  size = F)
gg_fatCarb <- gg
#ggsave("FatCarbFrontier2017.png", width = 4, height = 4, units = "in")
#===========================================================================
#===========================================================================
# df_params <- df_macnutShare[, c("Year", "Carb share of diet (%), logged",
#                             "GDP / capita (USD), logged")]
# df_params <- df_params[which(!is.na(df_params$`Carb share of diet (%), logged`)), ]
these_cols <- c("Area", "Year", "Carbohydrate (% of diet)", "Fat (% of diet)")
df_macnutShare <- df_macnutShare[, these_cols]
df_params <- subset(df_params, Region != "Aggregated")
yr_vec <- unique(df_params$Year)
n_yrs <- length(yr_vec)
mFatCarb_vec <- c()
bFatCarb_vec <- c()
adjR2FatCarb_vec <- c()
mBennett_vec <- c()
bBennett_vec <- c()
adjR2Bennett_vec <- c()
NBennett_vec <- c()
NFatCarb_vec <- c()
for(i in 1:n_yrs){
  this_year <- yr_vec[i]
  this_df <- subset(df_params, Year == this_year)
  this_df$Year <- NULL
  #---------------------------------------------------
  mod <- lm(`Fat (% of diet)` ~ `Carbohydrate (% of diet)`, this_df)
  mFatCarb_vec[i] <- round(mod$coefficients[2], 6)
  bFatCarb_vec[i] <- round(mod$coefficients[1], 6)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2FatCarb_vec[i] <- df_out$adj.r.squared
  NFatCarb_vec[i] <- length(mod$fitted.values)
  #---------------------------------------------------
  mod <- lm(`Cereals & starchy roots (% of diet), logged` ~ `GDP/capita (USD), logged`, this_df)
  mBennett_vec[i] <- round(mod$coefficients[2], 6)
  bBennett_vec[i] <- round(mod$coefficients[1], 6)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2Bennett_vec[i] <- df_out$adj.r.squared
  NBennett_vec[i] <- length(mod$fitted.values)

}
df_plotBennett <- data.frame(Year = yr_vec, Slope = mBennett_vec, bBennett_vec, adjR2Bennett_vec, NBennett_vec)
colnames(df_plotBennett)[3:5] <- c("Y intercept", "Adj. R-squared", "Sample size")
df_plotBennett$Year <- as.integer(as.character(df_plotBennett$Year))

df_plotFatCarb <- data.frame(Year = yr_vec, Slope = mFatCarb_vec, bFatCarb_vec, adjR2FatCarb_vec, NFatCarb_vec)
colnames(df_plotFatCarb)[3:5] <- c("Y intercept", "Adj. R-squared", "Sample size")
df_plotFatCarb$Year <- as.integer(as.character(df_plotFatCarb$Year))
#---------------------------------------------------------------------------
ind <- which(df_plotFatCarb$Year > 1980)
minSlopeBennett <- round(min(df_plotBennett$Slope[ind]), 4)
maxSlopeBennett <- round(max(df_plotBennett$Slope[ind]), 4)
minSlopeFatCarb <- round(min(df_plotFatCarb$Slope[ind]), 4)
maxSlopeFatCarb <- round(max(df_plotFatCarb$Slope[ind]), 4)
#---------------------------------------------------------------------------

```

The fat share of diet $x_f$ is thus related to the carbohydrate share $x_c$ by the following equation.

\begin{equation}
x_f \approx `r m` x_c + `r b`
\label{eq:fatCarbRelation}
\end{equation}

This implies a marginal increase of `r -m` in the fat share per marginal decrease in the carbohydrate share. The implicit marginal increase in the protein share $x_p$ can then be found by considering that

\begin{equation}
x_c + x_f + x_p = 100
\end{equation}

Substituting equation \ref{eq:fatCarbRelation} into this expression and differentiating with respect to $x_c$ then gives a marginal increase in the protein share of about $-\alpha - 1 = `r -m - 1`$ per marginal decrease in the carbohydrate share.

\begin{equation}
\frac{\partial x_p}{\partial x_c} \approx -\alpha - 1 = `r -m - 1`
\end{equation}

The fat-carb frontier thus suggests that there is a net positive change in the protein share of diet as the carbohydrate share decreases, albeit a very slight one compared to the corresponding increase in the fat share.

Popkin and Drewnowski have argued that, from 1990 onwards, the "classical" view was no longer valid: Fat intake had come "uncoupled" from income, thanks to newly available vegetable fats that are affordable at all income levels [-@drewnowski1997nutrition]. Figures ... and ... suggest, to the contrary, that fat intake is still correlated with income.

Bennett's Law characterized as ...towards "a more diverse diet that includes alarger share of animal protein and fats and oils" [@valin2014future]. 
<!-- However, this not found in the Mahammed et al. study. The Florida PI model fails to reproduce this [@muhammad2011international]. -->

## Stability over time

Both Bennett's Law and the fat-carb frontier have fit the data well across time, especially since 1980 (Figure \ref{fig:BennettStability}). Over the period of best fit (1980-2017), the slope of Bennett's Law has ranged narrowly between `r minSlopeBennett` and `r maxSlopeBennett`, while the slope of the fat-carb frontier has also ranged narrowly between `r minSlopeFatcarb` and `r maxSlopeFatcarb`.
<!-- The animations provided in the supplemental materials offer further visual confirmation of this stability. -->

```{r, fig.show = "hold", fig.width = 5, fig.height=4, fig.align="center", fig.cap="\\label{fig:BennettStability}Parameter stability over time (1970-2017) for Bennett's Law (Left) and the fat-carb frontier (Right).", echo = FALSE}


#===========================================================================

df_plot <- df_plotFatCarb %>% gather(Type, Value, Slope:`Sample size`)
gg <- ggplot(df_plot, aes(x = Year, y = Value))
gg <- gg + geom_line()
# gg <- gg + scale_x_continuous(breaks = seq(yr_vec[1], yr_vec[n_yrs - 1], length.out = 24))
gg <- gg + facet_wrap(~Type, ncol = 1, scales = "free_y")
gg <- gg + labs(subtitle = "Fat-Carb frontier stability")
gg <- gg + theme(axis.title = element_blank(),
                  #axis.text.x = element_text(angle = 60, hjust = 1),
                  strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                 plot.title = element_text(size = title_size),
                plot.subtitle = element_text(size = subtitle_size),
                axis.text = element_text(size = axisText_size))
gg_fatCarbStab <- gg
#===========================================================================
gg_BennettStab + gg_fatCarbStab + plot_layout(ncol = 2)
#===========================================================================
#===========================================================================
#===========================================================================
#===========================================================================
df_plotBen <- subset(df_plotBennett, Year >= 1980)
mod <- lm(Slope ~ `Y intercept`, df_plotBen)
#summary(mod)
  mBen <- round(mod$coefficients[2], 3)
  bBen <- round(mod$coefficients[1], 3)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2Ben <- round(df_out$adj.r.squared, 2)
this_subtitleBen <- paste0("Adj. R-squared = ", adjR2Ben, "\nSlope = ", mBen, ", Y intercept = ", bBen)

df_plotFC <- subset(df_plotFatCarb, Year >= 1980)
mod <- lm(`Y intercept` ~ Slope, df_plotFC)
#summary(mod)
  mFC <- round(mod$coefficients[2], 3)
  bFC <- round(mod$coefficients[1], 3)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2FC <- round(df_out$adj.r.squared, 2)
this_subtitleFC <- paste0("Adj. R-squared = ", adjR2FC, "\nSlope = ", mFC, ", Y intercept = ", bFC)


```

Note that the slope and y intercept of the fat-carb frontier appear to move in inverse unison with each other. A plot of their values over the period 1980-2017 reveals they are indeed affine to each other across all years (Figure \ref{fig:mAffineY}). This relation effectively reduces the fat-carb frontier to a one parameter model when comparing across years. That is, for any given year, the slope of the frontier $\alpha$ is related to its y intercept $b$ by

\begin{equation}
b \approx `r mFC` \alpha + `r bFC`
\end{equation}

A similar relation exists in the case of Bennett's Law, but only over the years 1980-2003.

```{r, fig.show = "hold", fig.width = 5, fig.height=3, fig.align="center", fig.cap="\\label{fig:mAffineY}Relation between the slope and y intercept of (left) Bennett's Law and (right) the fat-carb frontier.", echo = FALSE}

gg <- ggplot(df_plotBen, aes(x = Slope, y = `Y intercept`,
                          label = Year))
gg <- gg + geom_point()
gg <- gg + geom_text_repel(size = label_size)
gg <- gg + labs(subtitle = this_subtitleBen)
gg <- gg + theme(axis.title = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size),
                 plot.subtitle = element_text(size = subtitle_size))
gg_Ben <- gg

gg <- ggplot(df_plotFC, aes(x = Slope, y = `Y intercept`,
                          label = Year))
gg <- gg + geom_point()
gg <- gg + geom_text_repel(size = label_size)
gg <- gg + labs(subtitle = this_subtitleFC)
gg <- gg + theme(axis.title = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size),
                 plot.subtitle = element_text(size = subtitle_size))
gg_FC <- gg

gg_Ben + gg_FC + plot_layout(ncol = 2)

```

It is also worthwhile investigating the stability of carbohydrate

In the spirit of Hans Rosling [-@rosling2005new], animations of the plots in Figure \ref{fig:Bennett01} are provided in the supplemental materials. These animations offer further striking visual confirmation of the stability of the parameters in Bennett's Law and the fat-carb frontier over time. In these animations, it is interesting to observe the progress, regress, fits, and starts of different nations along the frontier. The trajectory of China over the past five decades, from an 80% carb diet to a 40% carb diet, is one of many remarkable examples to behold.

<!-- Clearly, Bennett's Law can be useful for determining the future composition of food demand as a function of GDP growth. However, only recently have researchers begun to take advantage of this potential. Gouel and Guimbard [-@gouel2019nutrition] introduce a novel demand model that integrates Bennett's Law, and find that demand for starchy crops will grow by just 30.8% in 2050, whereas demand for non-starchy commodities will grow by 35.5% (in the case of pulses, nuts, and oilcrops) to 72.1% (in the case of oils and fats). International agricultural research investment decisions, on the other hand, appear to be made without much regard for Bennett's Law. The largest share of investment continues to go into starchy crop research, with smaller portions invested in the non-starchy commodity groups for which demand is growing most quickly [@ispc2018; @finplan2018]. -->

# Engel's Law

84 years prior to Bennett's discovery, the young Director of the Statistical Bureau of Saxony, Ernst Engel, was poring over 199 Belgian working class budgets, when he noticed that

>"[t]he poorer the individual, a family, or a people, the greater must be the percentage of the income necessary for the maintenance of physical sustenance, and again of this a greater portion must be allowed for food" [@zimmerman1932ernst].

Nowadays, Engel's Law has a reputation for being "one of the most robust" empirical laws [@Browning2018]. However, in the early literature that Engel set in motion, numerous household budget studies contradicted Engel's finding, indicating an increasing relation between the food budget share and income [@zimmerman1932ernst]. The Law's robustness did not become especially evident until the post-WWII period. Houthakker's seminal study of 40 household budget surveys from 30 countries, in particular, presents overwhelming confirmation of the law's validity across cultural and socioeconomic spectra [-@houthakker1957international].

An example of Engel's Law using World Bank ICP data, covering x countries, is given in the top left panel of Figure \ref{fig:Engel0}. Food demand may also be expressed in terms of food expenditure (middle left panel) or food quantity (lower left panel) [@Browning2018]. The expenditure version of Engel's Law presents a better fit to the ICP data than the expenditure share version. The food quantity consumed version presents the poorest fit of the three, but is still respectable. The food quantity consumed version of Engel's Law is fitted to FBS data, and can thus be tracked across several years since 1960. Over the period of best fit (1980-2017), the fitted parameters exhibit remarkable stability, ranging narrowly between ... and ....   Apart from a few outliers, Houthakker's household level estimates of the income elasticity of food demand likewise fall within a remarkably narrow range considering the many different places, time periods, and data sources he draws from.
[A practical benefit of the FBS version is that it extends back...]

>"[I]f no data on the expenditure patterns of a country are available at all, one would not be very far astray by putting the...elasticity with respect to total expenditure [i.e. income], at .6 for food" [@houthakker1957international].

which is not far from the estimate obtained in Figure ....

```{r, fig.show = "hold", fig.width = 5, fig.height=4, fig.align="center", fig.cap="\\label{fig:Engel0}(Left) Three formulations of Engel's Law using 2017 data. The top graphic is based on FAO FBS data, while the bottom two are based on World Bank ICP data. GDP is expressed at the market exchange rate. (Right) Parameter trajectory of the consumption formulation of Engel's Law.", echo = FALSE}
#===========================================================================
this_file <- "Engels Law WB ICP data.csv"
df_icp <- read.csv(this_file, stringsAsFactors = F)
colnames(df_icp) <- gsub("US\\.\\.", "US$", colnames(df_icp))
colnames(df_icp) <- gsub("\\.\\.", ", ", colnames(df_icp))
colnames(df_icp) <- gsub("\\.", " ", colnames(df_icp))
colnames(df_icp) <- gsub("billions ", "billions", colnames(df_icp))
#unique(df_icp$Element)
these_elements <- c("Expenditure per capita, market exchange rate-based (US$)",
                    "Expenditure component share of GDP (GDP = 100%)")
# these_elements <- c("Expenditure per capita, PPP-based (US$)",
#                     "Expenditure, PPP-based (US$, billions)")
df_icp <- subset(df_icp, Element %in% these_elements)

df_icp$Element[grep("share", df_icp$Element)] <- "Expenditure (as % of GDP)"
# df_icp$Element[grep("per capita", df_icp$Element)] <- "expenditure/capita (USD)"
# df_icp$Element[grep("billions", df_icp$Element)] <- "expenditure (billion USD)"

u <- df_icp$Good
df_icp$Good[which(u == "1101190:Food products n.e.c. (Class)")] <- "Other food"
df_icp$Good[grep("Oils and fats", u)] <- "Oils and fats"
df_icp$Good[grep("Sugar, jam", u)] <- "Sugary and sweet"
df_icp$Good[grep("Milk, cheese and eggs", u)] <- "Milk, cheese and eggs"
df_icp$Good[grep("Fish and seafood", u)] <- "Fish and seafood"
df_icp$Good[grep("Meat", u)] <- "Meat"
df_icp$Good[grep("Vegetable", u)] <- "Bread, cereals, and vegetables"
df_icp$Good[grep("Bread", u)] <- "Bread, cereals, and vegetables"
df_icp$Good[grep("Fruit", u)] <- "Fruit"
df_icp$Good[grep("1101100:FOOD", u)] <- "Food"
# this_file <- "Engels Law WB ICP data.csv"
# df_engel <- read.csv(this_file, stringsAsFactors = F)
# u <- colnames(df_engel)
# colnames(df_engel)[which(u == "Expenditure..logged")] <- "Expenditure, logged"
# colnames(df_engel)[which(u == "GDP.capita..USD.")] <- "GDP/capita (USD)"
# colnames(df_engel)[which(u == "GDP.capita..USD...logged")] <- "GDP/capita (USD), logged"
# #unique(df_engel$Element)
# these_elements <- c("Expenditure per capita, market exchange rate-based (US$)",
#                     "Expenditure component share of GDP (GDP = 100%)")
# #  "Expenditure per capita, PPP-based (US$)"
# df_engel <- subset(df_engel, Element %in% these_elements)
# 
# df_engel$Element[grep("share", df_engel$Element)] <- "Food expenditure as % of GDP, logged"
# df_engel$Element[grep("per capita", df_engel$Element)] <- "Food expenditure/capita (USD), logged"
# unique(df_engel$Good[grep("FOOD", df_engel$Good)])
# df_engel$Good[grep("1101100:FOOD", df_engel$Good)] <- "Food"
# df_engel$Good[grep("RESTAURANTS", df_engel$Good)] <- "Restaurants and hotels"
# df_engel$Good[grep("EDUCATION", df_engel$Good)] <- "Education"
# df_engel$Good[grep("RECREATION", df_engel$Good)] <- "Recreation and culture"
# df_engel$Good[grep("CLOTHING", df_engel$Good)] <- "Clothing and footwear"
# df_engel$Good[grep("CONSTRUCTION", df_engel$Good)] <- "Construction"
# df_engel$Good[grep("MACHINERY", df_engel$Good)] <- "Machinery and equipment"
# df_engel$Good[grep("FURNISHINGS", df_engel$Good)] <- "Furnishings, household equipment,\n& routine household maintenance"
# df_engel$Good[grep("ACTUAL HOUSING", df_engel$Good)] <- "Housing, electricity,\n& other utilities"
# df_engel$Good[grep("VEHICLES", df_engel$Good)] <- "Purchase of vehicles"
# df_engel$Good[grep("TRANSPORT", df_engel$Good)] <- "Transport"
# df_engel$Good[grep("COMMUNICATION", df_engel$Good)] <- "Communication"
# df_engel$Good[grep("HEALTH", df_engel$Good)] <- "Health"
# #---------------------------------------------------------------------------
# # Highlight some countries in plot
# # label_Africa <- c("Tanzania", "Uganda", "Ethiopia", "South Africa",
# #                   "Ghana")
# # label_NAfricaWAsia <- c("Turkey", "Saudi Arabia")
# # label_Asia <- c("India", "Iran", "China, mainland", "Vietnam", "Japan",
# #                 "South Korea")
# # label_NAmEurAusNZ <- c("Italy", "France", "Australia")
# # label_LAC <- c("Nicaragua", "Colombia", "Brazil")
# # labelThese_vec <- c(label_Africa, label_NAfricaWAsia, label_Asia,
# #                     label_NAmEurAusNZ, label_LAC)
# label_Africa <- c("Uganda", "South Africa")
# label_NAfricaWAsia <- c("Turkey", "Saudi Arabia")
# label_Asia <- c("India", "China, mainland", "Vietnam")
# label_NAmEurAusNZ <- c("France", "Australia")
# label_LAC <- c("Nicaragua", "Colombia", "Brazil")
# labelThese_vec <- c(label_Africa, label_NAfricaWAsia, label_Asia,
#                     label_NAmEurAusNZ, label_LAC)
# df_engel$label_these <- NA
# u <- df_engel$Area
# df_engel$label_these[which(u %in% labelThese_vec)] <- df_engel$Area[which(u %in% labelThese_vec)]
#===========================================================================
# Basic Engel's Law plot
these_cols <- c("Country", "Year", "Element", "Good", "Region",
                "Expenditure, logged",
                "GDP per capita, market exchange rate based, US$")
#setdiff(these_cols, colnames(df_icp))
df_plot <- subset(df_icp[, these_cols], Good == "Food" & Year == 2017 & Region != "Aggregated")
df_plot$Good <- NULL
u <- colnames(df_plot)
colnames(df_plot)[which(u == "Expenditure, logged")] <- "Food demand, logged"
df_plot$`GDP/capita (USD), logged` <- log(df_plot$`GDP per capita, market exchange rate based, US$`)
df_plot$`GDP per capita, market exchange rate based, US$` <- NULL

these_cols <- c("Area", "Year", "Region",
                "Total (kcal/capita/day)", "GDP/capita (USD), logged")#, gdpPop_vars)
#setdiff(these_cols, colnames(df_cerRootShare))
df_engelKcal <- subset(df_cerRootShare[, these_cols], Region != "Aggregated")
df_engelKcal$Element <- "Consumption (kcal/capita/day)"

u <- colnames(df_engelKcal)
colnames(df_engelKcal)[which(u == "Total (kcal/capita/day)")] <- "Food demand"
df_engelKcal$`Food demand, logged` <- log(df_engelKcal$`Food demand`)
df_engelKcal$`Food demand` <- NULL
colnames(df_engelKcal)[1] <- "Country"
df_engelKcal <- df_engelKcal[, colnames(df_plot)]
df_engelKcalStab <- df_engelKcal
df_engelKcal <- subset(df_engelKcal, Year == 2017)


df_plot <- as.data.frame(rbind(df_plot, df_engelKcal))
#df_plot$lgdpPcapSq <- df_plot$`GDP/capita (USD), logged`^2
df_plot$Element[grep("Expenditure per capita", df_plot$Element)] <- "Expenditure/capita (USD)"
these_elements <- unique(df_plot$Element)
facet_labels <- c()
adjR2_vec <- c()
for(i in 1:length(these_elements)){
  this_element <- these_elements[i]
  this_df_plot <- subset(df_plot, Element == this_element)
  mod <- lm(`Food demand, logged` ~ `GDP/capita (USD), logged`, this_df_plot)
  # mod <- lm(`Expenditure, logged` ~ `GDP/capita, logged` + lgdpPcapSq, this_df_plot)
  #summary(mod)
  #plot(mod$fitted.values, mod$residuals)
  m <- round(mod$coefficients[2], 4)
  b <- round(mod$coefficients[1], 4)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2 <- round(df_out$adj.r.squared, 2)
  this_facet_label <- paste0("In terms of ", this_element, "\nAdj. R-squared = ", adjR2, ", Slope = ", m, ", Y intercept = ", b)
  facet_labels[i] <- this_facet_label
  adjR2_vec[i] <- adjR2
  
}

# m2 <- round(mod$coefficients[3], 4)
# x <- m + 2 * m2 * this_df_plot$lgdpPcap
# hist(x)

names(facet_labels) <- these_elements
n <- length(unique(df_plot$Region))
bag_of_colors <- randomcoloR::distinctColorPalette(k = 2 * n)
color_vec <- sample(bag_of_colors, n)

#this_element <- "Expenditure as % of GDP, logged"
#this_facet_label <- facet_labels[1]
#df_subplot <- subset(df_plot, Element == this_element)
#u <- colnames(df_subplot)
#colnames(df_subplot)[grep("Expenditure", u)] <- this_element

gg <- ggplot(df_plot, aes(x = `GDP/capita (USD), logged`,
                          y = `Food demand, logged`,
                          #label = label_these,
                          group = Region, fill = Region, shape = Region))
gg <- gg + geom_point(alpha = 0.6, size = smallPoint_size, color = "black", stroke = 0.5)
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
gg <- gg + geom_smooth(aes(group = NULL, fill = NULL, shape = NULL), method = lm, se = F)
#gg <- gg + geom_text_repel(color = "black", size = smallLabel_size)
gg <- gg + labs(subtitle = "Engel's Law")
gg <- gg + facet_wrap(~Element, ncol = 1, scales = "free_y",
                      labeller = labeller(Element = facet_labels))
gg <- gg + theme(#legend.direction = "vertical",
                 #legend.spacing.y = unit(1, 'cm'),
                 #legend.position = "none",
                 strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                 legend.title = element_blank(),
                 legend.text = element_text(size = legendText_size),
                 axis.text = element_text(size = axisText_size),
                 axis.title = element_text(size = axisTitle_size))
gg <- gg + guides(fill = guide_legend(#nrow = 2,
  override.aes = list(linetype = 0)),
  color = guide_legend(override.aes = list(linetype = 0)))
gg_engel <- gg

#---Parameter stability plot
df_params <- df_engelKcalStab
yr_vec <- unique(df_params$Year)
n_yrs <- length(yr_vec)
m_vec <- c()
b_vec <- c()
adjR2_vec <- c()
N_vec <- c()
for(i in 1:n_yrs){
  this_year <- yr_vec[i]
  this_df <- subset(df_params, Year == this_year)
  this_df$Year <- NULL
  mod <- lm(`Food demand, logged` ~ `GDP/capita (USD), logged`, this_df)
  m_vec[i] <- round(mod$coefficients[2], 4)
  b_vec[i] <- round(mod$coefficients[1], 4)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2_vec[i] <- df_out$adj.r.squared
  N_vec[i] <- length(mod$fitted.values)
  
}

df_plot <- data.frame(Year = yr_vec, Slope = m_vec, b_vec, adjR2_vec, N_vec)
colnames(df_plot)[3:5] <- c("Y intercept", "Adj. R-squared", "Sample size")
# mean(df_plot$Slope)
# sd(df_plot$Slope)
# mean(df_plot$`Y intercept`)
# sd(df_plot$`Y intercept`)

df_plot$Year <- as.integer(as.character(df_plot$Year))
df_plot <- df_plot %>% gather(Type, Value, Slope:`Sample size`)
gg <- ggplot(df_plot, aes(x = Year, y = Value))
gg <- gg + geom_line()
gg <- gg + facet_wrap(~Type, ncol = 1, scales = "free_y")
gg <- gg + labs(subtitle = "Engel parameter trajectory (Consumption formulation)")
gg <- gg + theme(axis.title = element_blank(),
                 strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                 axis.text = element_text(size = axisText_size),
                 plot.subtitle = element_text(size = subtitle_size))
gg_engelStab <- gg
#---------------------------------------------------------------------------
gg_engel + gg_engelStab + plot_layout(ncol = 2, guides = "collect") & theme(legend.position = "bottom")

# (gg_EngelKcal + plot_layout(guides = "collect") & theme(legend.position = "bottom")) + (gg_Engel0Stab + theme(legend.position = "none")) +
#    plot_annotation(title = "The calorie demand formulation of Engel's Law") & 
#   theme(text = element_text(size = title_size))



#===========================================================================
ind <- which(df_plotStab$Year > 1980)
minSlopeEngel <- round(min(df_plotStab$Slope[ind]), 2)
maxSlopeEngel <- round(max(df_plotStab$Slope[ind]), 2)

minYengel <- round(min(df_plotStab$`Y intercept`[ind]), 2)
maxYengel <- round(max(df_plotStab$`Y intercept`[ind]), 2)

df_plot <- subset(df_plotStab, Year >= 1980)
df_mod <- df_plot[, c("Y intercept", "Slope")]
mod <- lm(`Y intercept` ~ Slope, df_mod)
#summary(mod)
  m_engelKcal <- round(mod$coefficients[2], 3)
  b_engelKcal <- round(mod$coefficients[1], 3)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2 <- round(df_out$adj.r.squared, 2)
this_subtitle <- paste0("Adj. R-squared = ", adjR2, "\nSlope = ", m_engelKcal, ", Y intercept = ", b_engelKcal)



# df_params <- df_engelKcalStab
# df_params$`GDP/capita (USD), logged, squared` <- df_params$`GDP/capita (USD), logged`^2
# yr_vec <- unique(df_params$Year)
# n_yrs <- length(yr_vec)
# m_vec <- c()
# b_vec <- c()
# adjR2_vec <- c()
# N_vec <- c()
# pval <- c()
# pval2 <- c()
# for(i in 1:n_yrs){
#   this_year <- yr_vec[i]
#   this_df <- subset(df_params, Year == this_year)
#   this_df$Year <- NULL
#   mod <- lm(`Food demand, logged` ~ `GDP/capita (USD), logged` +
#               `GDP/capita (USD), logged, squared`, this_df)
#   summary(mod)
#   pval[i] <- summary(mod)[[4]][11]
#   pval2[i] <- summary(mod)[[4]][12]
#   
#   # m_vec[i] <- round(mod$coefficients[2], 4)
#   # b_vec[i] <- round(mod$coefficients[1], 4)
#   # df_out <- as.data.frame(broom::glance(mod))
#   # adjR2_vec[i] <- df_out$adj.r.squared
#   # N_vec[i] <- length(mod$fitted.values)
#   
# }


```

Engel's Law now forms the implicit or explicit basis of most published assessments of future food demand. It is hard coded into the most prominent agricultural sector equilibrium models (IMPACT, GCAM, GLOBIOM, and MAgPIE) [@valin2014future], and figures centrally in more recent econometric approaches [Goouel; Bodirsky]. The FAO takes Engel's Law as a point of departure when conducting its expert based assessments of future food demand []. In a much cited parsimonious food demand study, Tilman et al. [-@tilman2011global] apply Engel's Law without crediting Engel. Brown likewise rediscovers Engel's Law in his influential book [-@brown1963man], without citing Engel.

The functional form employed in Figure ... is the double log formulation of Engel's Law, first employed by Engel himself [@houthakker1957international]. The slope $\alpha$ is the income elasticity of food demand. That is,

$$
\begin{equation}
\alpha = \frac{\partial \ln(\text{food demand})}{\partial \ln(\text{income})} = \frac{\%\Delta \: \text{food demand}}{\%\Delta \: \text{income}}
\end{equation}
$$

Alternative functional forms have also been explored [@aitchison1954synthesis; @prais1952non; @prais1971analysis]. The empirical fit can usually be improved by adding price and demographic control variables to the model.

The verbal definition of Engel's Law [@Browning2018; @zimmerman1932ernst] is a statement about the first order relation of food expenditures to income. When selecting a functional form by which to model Engel's Law, the question of second order behavior must be addressed; but this is a matter left to the modeler and the data in any particular given study. Engel's Law itself makes no explicit assertion regarding the second order evolution of food expenditures with respect to income.

In the food demand modeling literature, it has nonetheless become commonplace to mischaracterize or (to put it charitably) reinvent Engel's Law as a statement about second order behavior. This tendency appears to be rooted in the work of Timmer, who argues that
<!-- [-@timmer1981there; see also Timmer and Alderman ...] -->

>"[b]ecause the income component of own-price elasticities is likely to be at least a significant factor for food, Engel's Law strongly suggests that Cournot own-price elasticities should decline in absolute size for higher income households" [@timmer1981there].

Timmer's argument is tantamount to saying (via the Slutsky equation) that Engel's Law strongly suggests that the income elasticity of food demand should decline with income. [Timmer here is reacting to an earlier household budget study reporting own price elasticities of food demand---and, by Timmer's implication, income elasticity of food demand---that increase with income. Timmer remarks that these results "fly in the face of all economic logic" [@timmer1981there].] Elsewhere, Timmer surmises that

>"[a] logical corollary of Engel's law is that the income elasticity of demand for food...is likely to be relatively large for low-income consumers and to decline to very small levels for upper-income consumers" [Timmer 1983].

Again, Engel's Law implies no such corrollary. Engel leaves the issue of second order behavior to be addressed by the modeler. Engel himself specified the double log model, which implies zero second order variation. Houthakker also specifies a double log model, with results indicating very little second order variation of food demand with respect to income across a diverse range of countries and time periods---And Houthakker expressly concludes that "there is not much support for [the] thesis" of second order variation []. In hindsight, moreover, the logical corrollary to be drawn from the double log parameter trajectory in the right panel of Figure ... could very well be that income elasticty of food demand is largely unresponsive to changes in income: Over the period 1980 to 2017, world GDP rose by $328\%$ [WDI], while the income elasticty declined by just two percentage points.
<!-- from $\$2533$  to $\$10,828$ -->

Seale [] later enlists Timmer's surmise in support of the following mischaracterization of Engel's Law (in italics):

>"Engel's law states that the budget share of food decreases with increasing income. Accordingly, the budget share of food should be larger in Vietnam than in the U.S., and _the income elasticity of demand for food is expected to be greater in Vietnam than in the U.S._" [@seale2006modeling].

To be clear, this is an accurate representation of Engel's Law up until the last clause, where Seale misattributes his and Timmer's expectations to Engel. Valin et al. then complete the process of reinvention by equating Timmer's surmise with Engel's Law itself:

>"[T]here is overwhelming evidence that income elasticities for most food commodities decline as consumer income increases, a relationship known as Engel's Law" [@valin2014future].

No reference to the "overwhelming evidence" is given, but the authors presumably refer to the aforementioned articles by Timmer and Seale, and to Mohammad et al. [], who update Seale's work with new data. In each of these studies, the authors specify increasingly sophisticated empirical models that allow for second order variation in the income elasticity of food demand. Timmer's seminal study is limited to maize, rice, and cassava consumption, and so is more properly an inquiry into the second order variation of Bennett's Law.

A detailed inquiry into the question of how overwhelming this evidence may or may not be lies beyond the scope of this brief review. However, by now it should be clear that there is considerable evidence supporting zero second order variation. A further cursory exploration of the FBS reveals that  Augmenting the double log consumption formulation of Engel's Law with a squared logged income term to allow for second order variation, as Timmer does in his study [-@timmer1981there], results in statistically insignificant coefficients on the squared term across all years of FBS data. A similar augmentation of the double log expenditure per capita formulation of Engel's Law using the 2017 ICP data results in a statistically significant coefficient on the squared term, but leaves the adjusted R-squared unchanged to the third decimal place.

The authors report a good empirical fit, which appears to constitute evidence in favor of Timmer's surmise.  of negative second order variation of food demand with respect to income. However, Timmer's surmise is not a logical corrollary to Engel's Law, much less Engel's Law itself, as Valin et al. assert. Attempts to construe Timmer's surmise as more or less synonymous with Engel's Law have given the surmise an authoritative weight it does not in fact possess.

<!-- Moreover, evidence of a relation between income elasticity and income has not always been "overwhelming". There was no clear relation in the early literature [@zimmerman1932ernst], and Houthakker found that "an explanation of the differences between the elasticities...seems difficult. It is conceivable, and indeed probable, that relative prices may influence the elasticities; thus it has sometimes been suggested that the income elasticity of a commodity is an increasing function of its price relative to other commodities" [-@houthakker1957international]. Subsequently, evidence of a relation bewteen income and income elasticity materialized with the report by Muhammad et al. and Seale and Regmi [-@muhammad2011international; @seale2006modeling]. -->
<!-- Engel went so far as to conclude that "[t]he proportion of the outgo used for food, other things being equal, is the best measure of the material standard of living of a population" [-@zimmerman1932ernst]. -->
 <!-- An example of the calorie demand formulation of Engel's Law is given in the left panel of Figure \ref{fig:EngelStability}. The fit is reasonable, but not quite as good as the fit observed in the original formulation. Like Bennett's Law, Engel's Law fits the data well across time, particularly since 1980 (right panel). -->
<!-- After rising to a peak value of about 0.11 in 1980, the slope has gradually decreased to about 0.09. The Y intercept, meanwhile, has risen from about 6.9 to about 7.2. -->

# Using Engel's and Bennett's Laws to make back of the envelope calculations of future food demand

Any application of Engel's Law requires careful consideration of how the law's parameters---especially the income elasticity of food demand---have evolved over time in the past, and how they are likely to evolve in the future. [As with Bennett's Law, the FBS data indicate remarkable stability in the Engel parameters, which have varied narrowly between ... and ... sice 1980.] As with Bennett's Law, these data also exhibit an inverse relation between the slope and y intercept parameters (Figure ... and equation ...), which can be exploited to reduce the number of parameter estimates in an $n$ year trajectory from $2n$ to $n + 2$.
<!-- Bodirsky et al. [] propose to model parameter trajectories using an equation taken from biochemistry that asymptotically converges to a particular value. They offer no explanation for this novel methodological choice, nor as to why the parameters should be expected to converge asymptotically to a particular value. The FBS data do not exhibit such asymptotic behavior. -->

A full fledged future food demand study is beyond the scope of this article, but it is worth taking a moment to sketch out how the empirical laws examined above can be used to generate back-of-the-envelope calculations of future food demand and future cereal & starchy root demand.

World food demand for a given year can be approximated by evaluating the calorie formulation of Engel's Law at world GDP/capita for that year. Historically, this approximation has been quite good, diverging just 3%-9% from the measured value (left panel, Figure \ref{fig:...}). The cereal and starchy root share of the global diet for a given year can likewise be approximated by evaluating Bennett's Law at GDP/capita for that year. However, this approximation has diverged considerably from the measured value, by 9-15 percentage points (right panel, Figure \ref{fig:...}).

It may be possible to reduce the error by including control variables in the model. For back-of-the-envelope projections of future demand, however, it may be sufficient to notice that the error is fairly consistent across years, and to apply an error correction term on this basis. In the parsimonious calculation here, for example, the Bennett model is corrected by substracting the average percentage point error since 2000. (No correction is applied to the Engel model.)

There remains the question of which parameter values to use when projecting into the future. One method is suggested in Figures \ref{fig:...}: to fit the models cross-sectionally for several years, to examine parameter value trajectories over time, and to choose values based on one's assumptions of how the trajectories are likely to evolve in future years. This decision is facilitated by the remarkable stability of the historical parameter values over time. In the case of Engel's Law, one may also draw upon the observed parameter relation in equation \ref{eq:yintEngelKcal} to reduce the dilemma from two parameters to one parameter. For the 2050 food demand estimate below, the Engel slope parameter is set to `r f`, and the y intercept parameter is calculated from this based on equation \ref{eq:yintEngelKcal}. For the 2050 starchy staples demand estimate, the Bennett slope and y intercept parameters are set to the mean of parameters since 1980, `r d` and `r x`, respectively.
<!-- basically assuming that the values will revert to values of previous years rather than continuing on their trajectory. -->

The agricultural sector equilibrium models implement exogenously determined trajectories in their estimate of food demand. Bodirsky et al. model future parameters using a novel ... taken from biochemistry....converge to a particular value. There is no rationale for  empirical argument in favor of their approach, but that has since deteriorated (Figure ...).

The final ingredient required for a back-of-the-envelope estimate of future food demand is an estimate of future GDP/capita, or, alternatively, separate estimates of future GDP and population. Estimates of future population are readily available out to 2100 from the UN [@desa2019world]. Reliable estimates of future GDP are considerably less straightforward to calculate [@diaz2016future], but have become increasingly available [@foure2013modelling]. For back-of-the-envelope purposes, it may be sufficient to assume an annualized GDP growth rate $r$ and then to calculate the percentage change in GDP over the baseline year as $% \delta GDP = (1 + r)^n$, where $n$ is the number of years between the baseline year and the future year of interest. In a less cursory analysis, careful consideration must be given to the different units in which GDP can be expressed---typically a choice between constant USD, USD at the market exchange rate, or USD at the purchasing power parity exchange rate. For a discussion see Seale [].

In the parsimonious approach considered here, GDP is expressed in USD at the market exchange rate, and 2050 GDP is estimated assuming an annualized growth rate of 2%. World population in 2050 is assumed to be 9.7 billion, based on the UN's projection.

The resulting estimate of total daily food demand is presented in Table 1, where it is compared to other notable food demand estimates. The starchy staples share of diet in 2050 is estimated to be `r x`. Total starchy staple demand in 2050 is then calculated by multiplying the total food demand by `r x/100`. This gives ..., a figure in line with Gouel et al.'s projection of starchy staple demand [-@gouel2019nutrition]. A sensitivity analysis heatmap is given in Figure \ref{fig:...}.
Table 1:
[@valin2014future]
[@alexandratos2012world] 60% not 70%
[@gouel2019nutrition]
[@tilman2011global]
<!-- These results are in line with Gouel et al.'s estimate of a 46% increase in food demand, including an 18% increase in demand for starchy staples [-@gouel2019nutrition]. -->
<!-- The 16% increase in cereal demand may not include livestock feed? -->


2% annual growth in GDP [].
Can do this for any country
```{r, fig.show = "hold", fig.width = 4, fig.height=3, fig.align="center", fig.cap="\\label{fig:demandBackTest}....", echo = FALSE}
# Define get demand estimate function
getDemEst <- function(df_dem){
n_yrs <- length(unique(df_dem$Year))
yr_min <- min(df_dem$Year)
list_DemTot <- list()
list_DemStarch <- list()
  for(i in 1:n_yrs){
    this_year <- yr_min + i - 1
    df_mod <- subset(df_dem, Year == this_year & Region != "Aggregated")
    df_world <- subset(df_dem, Year == this_year & Area == "World")
    worldGDP <- 10^6 * df_world$`GDP (million USD)`
    worldPop <- 10^6 * df_world$`Population (millions)`
    worldGDPpCap <- df_world$`GDP/capita (USD)`
    #---Total kcal demand
    mod <- lm(`Total (kcal/capita/day), logged` ~ `GDP/capita (USD), logged`, df_mod)
    #summary(mod)
    a <- round(mod$coefficients[2], 4)
    b <- round(mod$coefficients[1], 4)
    df_out <- as.data.frame(broom::glance(mod))
    adjR2 <- round(df_out$adj.r.squared, 2)
    #facet_labels <- paste0("Adj. R-squared = ", adjR2, ", Slope = ", a_2017, ", Y intercept = ", b_2017)
    worldDemTot <- df_world$`Total (kcal/day)`
    worldDemTot_est <- exp(b) * worldGDP^a * worldPop^(1 - a)
    #worldDemTot_est <- exp(b) * worldGDPpCap^a
    pctDiff_DemTot <- 100 * (worldDemTot_est - worldDemTot) / worldDemTot
    outDemTot <- c(this_year, a, b, adjR2, worldDemTot_est, worldDemTot, pctDiff_DemTot)
    list_DemTot[[i]] <- outDemTot
    #---Cereal and starchy root demand
    mod <- lm(`Cereals & starchy roots (% of diet), logged` ~ `GDP/capita (USD), logged`, df_mod)
    #summary(mod)
    a <- round(mod$coefficients[2], 4)
    b <- round(mod$coefficients[1], 4)
    df_out <- as.data.frame(broom::glance(mod))
    adjR2 <- round(df_out$adj.r.squared, 2)
    #facet_labels <- paste0("Adj. R-squared = ", adjR2, ", Slope = ", a_2017, ", Y intercept = ", b_2017)
    #worldDemStarch <- df_world$`Cereals & starchy roots (kcal/capita/day)`
    worldDemStarchPctShare <- df_world$`Cereals & starchy roots (% of diet)`
    worldDemStarchPctShare_est <- exp(b) * worldGDPpCap^a
    #worldDemStarch_est <- worldDemTot_est * worldDemStarchPctShare_est / 100
    worldDemStarch_est <- exp(b) * worldGDPpCap^a
    #pctDiff_DemStarch <- 100 * (worldDemStarch_est - worldDemStarch) / worldDemStarch
    ppDiff_DemStarchPctShare <- worldDemStarchPctShare_est - worldDemStarchPctShare
    outDemStarch <- c(this_year, a, b, adjR2,
                      #worldDemStarch_est, worldDemStarch,
                      worldDemStarchPctShare_est, worldDemStarchPctShare,
                      ppDiff_DemStarchPctShare)
                      #pctDiff_DemStarch)
    list_DemStarch[[i]] <- outDemStarch
    
  }
  df_DemTot <- as.data.frame(do.call(rbind, list_DemTot))
  colnames(df_DemTot) <- c("Year", "Slope", "Y intercept", "Adj. R-squared",
                        "Modeled",
                        "Real",
                        "Pct. Diff.")
  df_DemTot$Item <- "Total"
  df_DemStarch <- as.data.frame(do.call(rbind, list_DemStarch))
  colnames(df_DemStarch) <- c("Year", "Slope", "Y intercept", "Adj. R-squared",
                           "Modeled",
                           "Real",
                           "PP Diff.")
  df_DemStarch$Item <- "Cereals & starchy roots"
  #df_out <- as.data.frame(rbind(df_DemTot, df_DemStarch))
  list_out <- list(df_DemTot, df_DemStarch)
  return(list_out)
}

df_dem <- df_cerRootShare
df_dem$`Total (kcal/capita/day), logged` <- log(df_dem$`Total (kcal/capita/day)`)
df_dem$`Total (kcal/day)` <- 10^6 * df_dem$`Total (kcal/capita/day)` * df_dem$`Population (millions)`
df_dem$`Total (kcal/day), logged` <- log(df_dem$`Total (kcal/day)`)
df_dem$`Cereals & starchy roots (kcal/day)` <- 10^6 * df_dem$`Cereals & starchy roots (kcal/capita/day)` * df_dem$`Population (millions)`

list_out <- getDemEst(df_dem)
df_plotTot <- list_out[[1]]
df_plotStarch <- list_out[[2]]

df_plotTot1 <- df_plotTot
df_plotTot1$Item <- NULL
df_plotTot1$`Pct. Difference` <- NULL
df_plotTot1 <- df_plotTot1 %>% gather(Type, `Food demand (kcal/day)`, Modeled:Real)
df_plotTot1$`Food demand (kcal/day)` <- 10^-12 * df_plotTot1$`Food demand (kcal/day)`
colnames(df_plotTot1)[ncol(df_plotTot1)] <- "Food demand\n(trillion kcal/day)"
df_plotTot2 <- df_plotTot[, c("Year", "Pct. Diff.")]
gg <- ggplot(df_plotTot1, aes(x = Year, y = `Food demand\n(trillion kcal/day)`,
                          group = Type, color = Type))
gg <- gg + geom_line(lwd = 1)
gg <- gg + theme(legend.position = "none",
                 legend.title = element_blank(),
                 axis.title.x = element_blank(),
                 axis.text.x = element_blank())
ggTot <- gg

gg <- ggplot(df_plotTot2, aes(x = Year, y = `Pct. Diff.`))
gg <- gg + geom_line(lwd = 1)
gg <- gg + theme(axis.title.x = element_blank())
ggTotDiff <- gg

#ggTot + ggTotDiff + plot_layout(ncol = 1, heights = c(1, 1 / 4))

df_plotStarch1 <- df_plotStarch
df_plotStarch1$Item <- NULL
df_plotStarch1$`PP Difference` <- NULL
df_plotStarch1 <- df_plotStarch1 %>% gather(Type, `Cereal & starchy\nroot demand (% of diet)`, Modeled:Real)
df_plotStarch2 <- df_plotStarch[, c("Year", "PP Diff.")]
gg <- ggplot(df_plotStarch1, aes(x = Year, y = `Cereal & starchy\nroot demand (% of diet)`,
                              group = Type, color = Type))
gg <- gg + geom_line(lwd = 1)
gg <- gg + theme(legend.title = element_blank(),
                 axis.title.x = element_blank(),
                 axis.text.x = element_blank())
ggStarch <- gg

gg <- ggplot(df_plotStarch2, aes(x = Year, y = `PP Diff.`))
gg <- gg + geom_line(lwd = 1)
gg <- gg + theme(axis.title.x = element_blank())
ggStarchDiff <- gg

#ggStarch + ggStarchDiff + plot_layout(ncol = 1, heights = c(1, 1 / 4))

ggTot + ggStarch + ggTotDiff + ggStarchDiff +
  plot_layout(ncol = 2, heights = c(1, 1 / 3), guides = "collect") & theme(legend.position = "top")

#---
# df_plotSlopeYint <- subset(df_plotTot, Year >= 1980)
# gg <- ggplot(df_plotSlopeYint, aes(x = Slope, y = `Y intercept`,
#                           label = Year))
# gg <- gg + geom_point()
# gg <- gg + ggrepel::geom_text_repel()
# gg
# 
# mod <- lm(`Y intercept`~Slope, df_plotSlopeYint)
# #summary(mod)
# m_b <- mod$coefficients["Slope"]
# b_b <- mod$coefficients["(Intercept)"]

# Estimate total kcal demand in 2050
a_fut <- 0.08
b_fut <- m_engelKcal * a_fut + b_engelKcal

annual_growth <- 0.02
n_yrs <- 2050 - 2020
pctChng_GDP <- (1 + annual_growth)^n_yrs
worldGDP2017 <- 10^6 * subset(df_dem, Area == "World" &
                                Year == 2017)$`GDP (million USD)`
worldGDP2050 <- worldGDP2017 * pctChng_GDP
worldPop2050 <- 9.7 * 10^9
worldPop2017 <- 10^6 * subset(df_dem, Area == "World" &
                                Year == 2017)$`Population (millions)`
worldGDPpCap2017 <- worldGDP2017 / worldPop2017
worldGDPpCap2050 <- worldGDP2050 / worldPop2050

DemTot2017 <- subset(df_dem, Area == "World" &
                       Year == 2017)$`Total (kcal/day)`
DemCerRoot2017 <- subset(df_dem, Area == "World" &
                           Year == 2017)$`Cereals & starchy roots (kcal/day)`
DemOther2017 <- DemTot2017 - DemCerRoot2017

DemTot2050_est <- exp(b_fut) * worldGDP2050^a_fut * worldPop2050^(1 - a_fut)
(DemTot2050_est - DemTot2017) / DemTot2017

ind <- which(df_plotStarch$Year > 1980)
m_starch <- mean(df_plotStarch$Slope[ind])
b_starch <- mean(df_plotStarch$`Y intercept`[ind])
ind <- which(df_plotStarch$Year > 2000)
err_corrctn <- -mean(df_plotStarch$`PP Diff.`[ind])
cerRootShare2050_est <- (exp(b_starch) * worldGDPpCap2050^m_starch + err_corrctn) / 100

DemCerRoot2050_est <- cerRootShare2050_est * DemTot2050_est
DemOther2050_est <- (1 - cerRootShare2050_est) * DemTot2050_est
100 * (DemCerRoot2050_est - DemCerRoot2017) / DemCerRoot2017
100 * (DemOther2050_est - DemOther2017) / DemOther2017

# From FAOSTAT
kcalPcapPday2005 <- 2761
pop2005 <- 10^3 * 6388641
kcalPday2005 <- kcalPcapPday2005 * pop2005
kcalPcapPday2010 <- 2850
starchKcalPcapPday2010 <- 1298 + 137
pop2010 <- 10^3 * 6770979	
kcalPday2010 <- kcalPcapPday2010 * pop2010
starchKcalPday2010 <- starchKcalPcapPday2010 * pop2010
# From Valin et al. [@valin2014future]
# Increase in 2050 over 2005: 59%-98% according to the models
# FAO projection in 2050 over 2005-2007: 54%
# Gouel et al. [@gouel2019nutrition]: Increase in 2050 over 2010: 46% and 18% for starchy staples
kcalPday2005 * 1.59
kcalPday2005 * 1.98
kcalPday2005 * 1.54
kcalPday2010 * 1.46
starchKcalPday2010 * 1.18
DemTot2050_est
DemCerRoot2050_est
# Tilman et al.: 100%-110% increases in 2050 over 2005.
Tilman_est_kcalPcap <- kcalPday2005 * 2.1 / worldPop2050 
Tilman_est_trilKcal <- 10^-12 * kcalPday2005 * 2.1
# Results in 3600-3800 kcal/capita/day, which is a body builder's diet, approaching twice the recommended helthy calorie intake for sedentary adult males. --maybe moreso since UN 2050 pop projection in 2011 was 9.3 billion (this implied in opening sentences of Tilman paper.)

  
```



# Different laws, or different manifestations of the same law?

In the early literature that Engel set in motion, thousands of such household budget surveys were compiled, covering a wide range of cultural and socioeconomic backgrounds. Many of these contradicted Engel's finding, indicating an increasing relation between the food budget share and income [@zimmerman1932ernst].

```{r, fig.show = "hold", fig.width = 6, fig.height=5, fig.align="center", fig.cap="\\label{fig:qerwerwer}....", echo = FALSE}

all_goods <- unique(df_engel$Good)
not_these <- all_goods[grep("[0-9]", all_goods)]
not_these <- c(not_these, "Food")
df_engelOther <- subset(df_engel, !(Good %in% not_these))
#unique(df_engelOther$Good)
#colnames(df_engelOther)
#unique(df_engelOther$Element)
this_element <- "Food expenditure/capita (USD), logged"
df_plot <- subset(df_engelOther, Year == 2017 &
                    Element == this_element &
                    Region != "Aggregated")
u <- colnames(df_plot)
colnames(df_plot)[which(u == "Expenditure, logged")] <- this_element
these_goods <- unique(df_plot$Good)

facet_labels <- c()
adjR2_vec <- c()
for(i in 1:length(these_goods)){
  this_good <- these_goods[i]
  this_df_plot <- subset(df_plot, Good == this_good)
  mod <- lm(`Food expenditure/capita (USD), logged` ~ `GDP/capita (USD), logged`, this_df_plot)
  #summary(mod)
  m <- round(mod$coefficients[2], 2)
  b <- round(mod$coefficients[1], 2)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2 <- round(df_out$adj.r.squared, 2)
  facet_labels[i] <- paste0(this_good, "\nAdj. R-squared = ", adjR2, "\nSlope = ", m, ", Y intercept = ", b)
  adjR2_vec[i] <- adjR2
}

names(facet_labels) <- these_goods

gg <- ggplot(df_plot, aes(x = `GDP/capita (USD), logged`,
                          y = `Food expenditure/capita (USD), logged`,
                          #label = label_these,
                          group = Region, fill = Region, shape = Region))
gg <- gg + geom_point(alpha = 0.6, size = smallPoint_size, color = "black", stroke = 0.5)
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
#gg <- gg + geom_smooth(method = lm, se = F)
gg <- gg + facet_wrap(~Good, ncol = 4,
                      labeller = labeller(Good = facet_labels))
#gg <- gg + geom_text_repel(color = "black", size = smallLabel_size)
gg <- gg + theme(strip.background = element_blank(),
                 strip.text.x = element_text(hjust = -0.01, size = facetTitle_size),
                 #legend.direction = "vertical",
                 #legend.spacing.y = unit(1, 'cm'),
                 legend.title = element_blank(),
                 legend.text = element_text(size = legendText_size),
                 axis.text = element_text(size = axisText_size),
                 axis.title = element_text(size = axisTitle_size))
gg <- gg + guides(fill = guide_legend(#nrow = 2,
  override.aes = list(linetype = 0)),
  color = guide_legend(override.aes = list(linetype = 0)))
gg


```


Both Engel's Law and Bennett's Law express a log-linear relation between a particular budget (total and food budget, respectively) and demand for a particular good (food and carbohydrates, respectively). Is there something unique about these laws and the goods they cover, or can they be generalized to a single law governing the income elasticity of demand for any good?

At first, it may seem that there is something special about food that sets it apart from other goods. In the early discussion surrounding Engel's Law, analogous laws for clothing, rent, and utilities were also proposed [@zimmerman1932ernst], but did not exhibit the same consistency as Engel's Law, and are no longer discussed today.

While it is true that certain metabolic constraints intrinsically limit the amount of food that the human organism can make use of in any given time period, the same can be said of non-food goods such as toilet paper and exercise equipment. Non-metabolic, but perfectly analagous, constraints similarly limit the usefulness of glue, jet fuel, and diamonds. This is called the Law of Diminishing Marginal Utility, and there is nothing particularly unique about food or carbohydrates in this respect. Astute observers have documented this law, in one guise or another, throughout much of written history [@kauder1953genesis]. In 1738, Daniel Bernoulli put it this way:

>"[i]n the absence of the unusual, the utility resulting from any small increase in wealth will be inversely proportionate to the quantity of goods previously possessed" [@bernoulli1954exposition].

Bernoulli's statement can be formalized as follows.

\begin{equation}
\frac{\partial U}{\partial x} \sim \frac{1}{x}
\label{eq:dimUtilDefine}
\end{equation}

Where, to be clear, the term $\partial U / \partial x$ is the marginal change in utility given a marginal increase in the quantity of good $x$, and "$\sim 1 / x$", means "inversely proportionate to the quantity of good $x$ already acquired". An expression $U(x)$ for the utility of good $x$ can then be obtained by integrating Bernoulli's statement.

\begin{equation}
\begin{split}
\int \frac{d U}{d x} \: dx &= \int \alpha \frac{d \ln(x)}{dx} \: dx \\
U(x)  &= \alpha \ln(x) + k
\end{split}
\label{eq:integrate_lnU}
\end{equation}

Where the proportionality constant $\alpha = dU/d\ln(x)$ regulates the marginal change in utility given a $1$ percent increase in good $x$.

In the multivariate case, an expression $U(\mathbf{x})$ for the utility of a vector of $n$ goods $\mathbf{x} = [x_1,x_2,...,x_n]$ can be obtained as follows.

\begin{equation}
\begin{split}
\int \nabla_{\mathbf{x}} U \: d \mathbf{x} &= \int D(\mathbf{\alpha}) \nabla_{\mathbf{x}} \ln(\mathbf{x}) \: d \mathbf{x} \\
\ln(U(\mathbf{x}))  &= \boldsymbol{\alpha} {'} \ln(\mathbf{x}) + \alpha_0
\end{split}
\label{eq:cobbDoug}
\end{equation}

where $\boldsymbol{\alpha}$ is the vector of proportionality constants corresponding to each $x_i$, the notation $D(\boldsymbol{\alpha})$ indicates a diagonal matrix with the elements of $\boldsymbol{\alpha}$ along its diagonal, and

\begin{equation}
\nabla_{\mathbf{x}} \ln(U) = \left[ \begin{matrix} \frac{\partial \ln(U)}{\partial \ln(x_1)} \\
\frac{\partial \ln(U)}{\partial \ln(x_2)} \\
\vdots \\
\frac{\partial \ln(U)}{\partial \ln(x_n)}
\end{matrix} \right]
\end{equation}

Equation \ref{eq:cobbDoug} is well-known to economists as the Cobb-Douglas form, and is also well-known to fit the data across a wide range of contexts and scales.

also... It has often been observed that consumption of different categories of goods increases in different proportions to increases in income. Engel's Law, for example, famously notes that a household's food consumption increases less than proportionately with its income. Others have noted similar relations between income and consumer expenditures on clothing, utilities, rent, and other items [@zimmerman1932ernst; @stigler1954early]. All of this may be viewed as a result of the Law of Diminshing Marginal Utility.

The marginal decrease in the usefulness of income must equal the marginal increase in the usefulness of the good gained in exchange.

\begin{equation}
\begin{split}
\frac{\partial U}{\partial B} &= \frac{\partial U}{dx_i} \\
\alpha_B \frac{d \ln(B)}{d B} &= \alpha_i \frac{d \ln(x_i)}{dx_i}
\end{split}
\label{eq:condEqualU}
\end{equation}

But note that $\frac{d \ln(B)}{d B} = \frac{\partial \ln(B)}{\partial (w_i x_i)}$. And so

\begin{equation}
\begin{split}
\alpha_B \frac{\partial \ln(B)}{\partial (w_i x_i)} &= \alpha_i \frac{d \ln(x_i)}{dx_i}
\end{split}
\label{eq:margUtilAssump}
\end{equation}

Rearranging and integrating...

\begin{equation}
\begin{split}
\int \alpha_B \frac{\partial \ln(B)}{\partial x_i} \: dx_i &= \int w_i  \alpha_{x_i} \frac{d \ln(x_i)}{dx_i} \: dx_i \\
\alpha_B \ln(B) + k_B  &= w_i \alpha_i \ln(x_i) + k_i
\end{split}
\end{equation}

Which can then be rearranged into a log-linear expression.

\begin{equation}
\ln(x_i) = m \ln(B) + K
\label{eq:generalLaw}
\end{equation}

Where

\begin{equation}
m = \frac{\alpha_B}{w_i \alpha_i} = \frac{d \ln(x_i)}{d \ln(B)}, \:\: K = \frac{k_B - k_i}{w_i \alpha_i}
\end{equation}

Engel's Law and Bennett's Law may thus be considered particular instances of this more general principle governing the income elasticity of demand for any good $x$, derived from the Law of Diminishing Marginal Utility (equation \ref{eq:dimUtilDefine}) and the assumption that consumers are utility maximizers (equation \ref{eq:assumption}).

Note that the slope $\beta$ is the ratio $\alpha_B / \alpha_x$. A value of $\beta$ less than $1$ therefore indicates that the percentage increase in utility resulting from from a $1$ percent increase in $x$ is greater than the percentage increase in utility resulting from a $1$ percent increase in income. This can be interpreted as saying that the consumer's need or apetite for $x$ is more quickly satisfied than their need for income. As a consequence, expenditure on $x$ rises less than proportionately with income. This is the case corresponding to Engel's and Bennett's Laws. A value of $\beta$ greater than $1$ indicates that the consumer's need for $x$ is less quickly satisfied than their need for income.^[If $x$ is expressed as an expenditure share, then replace $1$ with $0$.]

Note, moreover, that an increase in the price of $x$ effectively results in a decrease in satisfaction per unit expenditure on $x$, and vice versa. It follows, then, that $\beta$ is largely determined by the price of $x$ relative to other goods, with high values of $\beta$ corresponding to high prices of good $x$ relative to other goods, and vice versa. This may help to explain the geographical variation in slope observed in Figures \ref{fig:fatCarbDisagg} and \ref{fig:Engel0Disagg}; as well as the temporal variation observed in Figures \ref{fig:BennettStability} and \ref{fig:EngelStability}. ...as suggested by Houthakker [-@houthakker1957international].

This also shines a light on the circumstances under which Engel's and Bennett's Laws could be violated. One can conceive of situations of extreme poverty and/or of soaring prices, for example, such that $\beta$ turns greater than $1$ for a wide range of goods, including food. By the same token, the laws for non-food goods discussed in the early literature may not have "caught on" as well as Engel's and Bennett's Laws due to wide variations in their relative prices from one place and time to another.

[@aitchison1954synthesis]: we may reasonably suppose that many commodities begin life as luxuries and eventually become semi-luxuries or necessities as increasing incomes and falling prices bring consumers nearer to an ultimate saturation level. Such we might expect to have been the history of radio sets and to be the future prospects of television, domestic refrigerators and the like.


# A new empirical law: expected price and price volatility

The theoretical derivation of Engel's and Bennett's Laws above suggests that staple food price volatility may alter the slope of Engel's and Bennett's Laws, and thus alter the course of the Nutrition Transition. An understanding of staple food price volatility is thus critically important, in principle.

In practice, of course, food price volatility has not been an issue for most of the past 47 years. After a tumultuous decade culminating in the oil crisis of 1973, food prices began a long period of steady, stable decline. However, since 2007, staple food prices have again begun to exhibit volatility, severely curtailing access to essential foodstuffs on numerous occasions, across large swaths of the globe. A fledgling discussion of the causes and effects of this volatility has begun [@CWFSpriceVol2011; @imf2011price; @von2012global; @kalkuhl2016food]. Here I present a new empirical finding that may help to orient this discussion.

```{r, fig.show = "hold", fig.width = 4, fig.height=3, fig.align="center", fig.cap="\\label{fig:priceSeries}The higher the price, the more volatile it is. Source: Author's creation using FAO export data for 1972-2017. 'Export price' equals FAO's Export Value series divided by its Export Quantity series.", echo = FALSE}
this_file <- "FAO export data world.csv"
df_export_world <- read.csv(this_file, stringsAsFactors = F)
df_export_world$X <- NULL
colnames(df_export_world)[4:6] <- c("Export Quantity", "Export Value",
                                    "World export price (USD / metric ton)")
#=============================================================================
plot_these <- c("Maize", "Apples", "Cocoa, beans", "Cocoa, butter")
df_plot <- subset(df_export_world, Item %in% plot_these &
                    Year >= 1972)
yr_1 <- unique(df_plot$Year)[1]
yr_n <- max(unique(df_plot$Year))
gg <- ggplot(df_plot, aes(x = Year, y = `World export price (USD / metric ton)`, group = Item, color = Item)) + geom_line(lwd = 1)
gg <- gg + scale_x_continuous(breaks = seq(yr_1, yr_n, length.out = 6))
#gg <- gg + scale_y_log10()
gg <- gg + theme(axis.title.x = element_blank(),
                 legend.title = element_blank(),
                 legend.position = "top",
                 legend.text = element_text(size = legendText_size),
                 axis.text = element_text(size = axisText_size),
                 axis.title.y = element_text(size = axisTitle_size))
gg

```

Four food price series are plotted in Figure \ref{fig:priceSeries}. After poring over several such plots, one notices that higher price series are consistently more volatile than lower price series. And one notices this to be true across a wide range of food and non-food agricultural commodities, including both raw and processed versions of the commodities. The relation between price level and volatility also appears to persist over a wide range of food price epochs, from the oil crisis of 1973 through to the more recent volatile period beginning in 2007. A plot of the logged mean of ag prices over this period (1962-2017) against the respective logged standard deviations reveals a distinct log-linear relation between price magnitude and price volatility (Figure \ref{fig:riskReward}).^[See Appendix for details on the commodity grouping in this plot.]

The wide range of products that conform to this rule, including food, non-food, raw, and processed products, suggests that the relation may hold for non-agricultural commodity price series as well. However, non-agricultural price data generally do not extend back as far as the FAO data examined here, and so this will be difficult to verify on an equal footing.

```{r, fig.show = "hold", fig.width = 4, fig.height=5, fig.align="center", fig.cap="\\label{fig:riskReward}Logged mean price of agricultural commodities plotted against their respective logged standard deviations. Source: Author's creation using FAO export data 1961-2017.", echo = FALSE}

df_riskReward <- df_export_world %>% group_by(Item) %>%
  summarise(`Mean world export price (USD / metric ton)` = mean(`World export price (USD / metric ton)`, na.rm = T),
            `Stand. dev. world export price (USD / metric ton)` = sd(`World export price (USD / metric ton)`, na.rm = T),
            `Mean Export Qty.` = mean(`Export Quantity`, na.rm = T), 
            `Mean Export Value ('000 USD)` = mean(`Export Value`, na.rm = T))

df_riskReward$`Mean world export price (USD / metric ton), logged` <-
  log(df_riskReward$`Mean world export price (USD / metric ton)`)
df_riskReward$`Stand. dev. world export price (USD / metric ton), logged` <-
  log(df_riskReward$`Stand. dev. world export price (USD / metric ton)`)
#--
df_riskReward <- df_riskReward[which(!is.na(df_riskReward$`Stand. dev. world export price (USD / metric ton), logged`)), ]
#nrow(df_riskReward)
#-----------------------------------------------------------------------------
# Get product groups
this_folder <- "C:/Users/bensc/OneDrive/Documents/Data/FAO Data/FAO trade product groupings/"
file_vec <- list.files(this_folder)
filepath_vec <- paste0(this_folder, file_vec)
list_df <- lapply(filepath_vec, read.csv, stringsAsFactors = F)
for(i in 1:length(list_df)){
  this_df <- as.data.frame(list_df[[i]])
  this_df$Group <- gsub("FAO |.csv", "", file_vec[i])
  this_df <- this_df[, c("Item", "Group")]
  #this_df <- this_df[!which(duplicated(this_df$Item)), ]
  list_df[[i]] <- this_df
}

df_vegOil <- list_df[[1]]
df_animal <- list_df[[2]]
df_cereals <- list_df[[3]]
df_coffee <- list_df[[4]]
df_FnV <- list_df[[5]]
df_nonFood <- list_df[[6]]
df_oilseeds <- list_df[[7]]
df_pulses <- list_df[[8]]
df_RnT <- list_df[[9]]
df_sugar <- list_df[[10]]

ind_rm <- which(df_vegOil$Item %in% c(df_animal$Item, df_nonFood$Item))
df_vegOil <- df_vegOil[-ind_rm, ]
df_oil <- rbind(df_oilseeds, df_vegOil)
df_oil$Group <- "Veg. oils,\noilcrops"
df_cereals <- as.data.frame(rbind(df_cereals, data.frame(Item  = "Maize, green",
                                           Group = "Cereals and preparations")))
df_starchy <- rbind(df_cereals, df_RnT)
df_starchy$Group <- "Starchy crops"
df_sugOther <- rbind(df_coffee, df_nonFood, df_sugar)
df_sugOther$Group <- "Sugar, other"
df_nuts <- df_FnV[grep("nut", df_FnV$Item), ]
df_FnV <- df_FnV[-grep("nut", df_FnV$Item), ]
df_oilPulseNuts <- rbind(df_pulses, df_nuts, df_oil)
df_oilPulseNuts$Group <- "Pulses, nuts, oils"

ind_rm <- which(df_FnV$Item %in% c(df_starchy$Item,
                                   df_sugOther$Item,
                                   df_oilPulseNuts$Item))
df_FnV <- df_FnV[-ind_rm, ]
df_FnV$Group <- "Fruit & Veg."
# nrow(df_starchy)
# nrow(df_FnV)
# nrow(df_sugOther)
# nrow(df_oilPulseNuts)
# nrow(df_animal)


list_df <- list(df_starchy,
                df_FnV,
                df_oilPulseNuts,
                df_sugOther,
                df_animal)

df_groups <- as.data.frame(do.call(rbind, list_df))


df_groups <- df_groups[which(!duplicated(df_groups$Item)), ]
#length(unique(df_riskReward$Item))
# setdiff(df_groups$Item, df_riskReward$Item)
# setdiff(df_riskReward$Item, df_groups$Item)
df_riskReward$Item[which(df_riskReward$Item == "Silk raw")] <- "Silk, raw"
df_riskReward <- merge(df_riskReward, df_groups, by = "Item", all.x = T)
# unique(df_riskReward$Item[which(is.na(df_riskReward$Group))])
# unique(df_riskReward$Item[grep("Silk", df_riskReward$Item, ignore.case = T)])
df_riskReward <- df_riskReward[which(!is.na(df_riskReward$Group)), ]
#----------------------------------------------------------------------------
df_mod <- df_riskReward[, c("Mean world export price (USD / metric ton), logged", "Stand. dev. world export price (USD / metric ton), logged")]
#nrow(df_mod)
row.names(df_mod) <- df_riskReward$Item
mod <- lm(`Mean world export price (USD / metric ton), logged` ~., df_mod)
#summary(mod)
b <- round(mod$coefficients[1], 2)
m <- round(mod$coefficients[2], 2)
#---
# gg <- ggplot(data.frame(Item = row.names(df_mod), yhat = mod$fitted.values,
#                         resid = mod$residuals),
#              aes(x = yhat, y = resid, label = Item))
# gg <- gg + geom_point() + geom_text()
# gg <- gg + geom_hline(yintercept = c(-1, 1), color = "red")
# gg
#---
ind_outlier <- which(abs(as.numeric(mod$residuals)) >= 0.75)
excluded_items <- row.names(df_mod)[ind_outlier]
pct_removed <- 100 * length(ind_outlier) / nrow(df_riskReward)
row_names <- row.names(df_mod)[-ind_outlier]
df_mod <- df_mod[-ind_outlier, ]
row.names(df_mod) <- row_names
mod <- lm(`Mean world export price (USD / metric ton), logged` ~., df_mod)
#summary(mod)
b <- round(mod$coefficients[1], 2)
m <- round(mod$coefficients[2], 2)
df_out <- as.data.frame(broom::glance(mod))
adjR2 <- round(df_out$adj.r.squared, 2)
#plot(mod$fitted.values, mod$residuals)
#----------------------------------------------------------------------------
#df_riskReward$Item[ind_outlier]
df_plot <- df_riskReward[-ind_outlier, c("Item", "Group", "Mean world export price (USD / metric ton), logged", "Stand. dev. world export price (USD / metric ton), logged",
                             "Mean Export Value ('000 USD)")]

df_plot$`Mean export value\n(million USD)` <- df_plot$`Mean Export Value ('000 USD)` / 1000

labelItems <- c("Maize", "Flour, wheat", "Starch, cassava",
              "Coffee, green", "Coffee, roasted", "Wheat", "Bananas",
              "Plantains", "Potatoes", "Cocoa, beans",
              "Wool, greasy", "Beans, dry", "Silk, raw",
              "Apples",
              "Soybeans", "Oil, soybean", "Rubber, natural", "Rice",
              "Cocoa, butter")

df_plot$label_these <- NA
u <- df_plot$Item
df_plot$label_these[which(u %in% labelItems)] <- u[which(u %in% labelItems)]

this_subtitle <- paste0("Adj. R-squared = ", adjR2, "\nSlope = ", m, "  Y intercept = ", b)



gg <- ggplot(df_plot,
             aes(x = `Stand. dev. world export price (USD / metric ton), logged`,
                 y = `Mean world export price (USD / metric ton), logged`,
                 group = Group, fill = Group, shape = Group,
#                 size = `Mean export value\n(million USD)`,
                 label = label_these))
#gg <- gg + geom_smooth(method = lm, se = F)
gg <- gg + geom_point(alpha = 0.6, size = point_size, color = "black", stroke = 0.5)#,
                      #fill = "khaki1", pch=21, color="Black")
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
gg <- gg + geom_text_repel(size = label_size)
gg <- gg + labs(title = "The ag commodity producer's risk-reward frontier",
                subtitle = this_subtitle)
gg <- gg + guides(fill = guide_legend(nrow = 2, byrow = T, override.aes = list(linetype = 0)),
                  color = guide_legend(override.aes = list(linetype = 0)))
gg <- gg + theme(legend.position = "bottom",
                 legend.spacing.x = unit(0.25, 'cm'),
                 legend.title = element_blank(),
                 legend.text = element_text(size = legendText_size),
                 plot.title = element_text(size = title_size),
                 plot.subtitle = element_text(size = subtitle_size),
                 axis.title = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size))
gg


#ggsave("risk reward frontier.pdf")
```

The law also fits the data well at geographically disaggregated scales (Figure \ref{fig:riskRewardByRegion}). The slopes at the disaggregated scale parameters are considerably lower than at the globally aggregated level. At the globally aggregated level, the mean price of a given agricultural commodity increases roughly proportionately to the increase in volatility, while at the geographically disaggrgated level, mean prices increase less than proportionately with volatility. From the producer's standpoint, this means that market risk grows exponentially with expected reward.

```{r, fig.show = "hold", fig.width = 5, fig.height=5, fig.align="center", fig.cap="\\label{fig:riskRewardByRegion}Logged mean price plotted against logged standard deviation, by region.", echo = FALSE}
this_file <- "FAO export data regions.csv"
df_export_regions <- read.csv(this_file, stringsAsFactors = F)
df_export_regions$X <- NULL
colnames(df_export_regions)[4:6] <- c("Export Quantity", "Export Value",
                                    "Regional export price (USD / metric ton)")
#============================================================================
#colnames(df_export_regions)
df_riskReward_regions <- df_export_regions %>% group_by(Region, Item) %>%
  summarise(`Mean regional export price (USD / metric ton)` = mean(`Regional export price (USD / metric ton)`, na.rm = T),
            `Stand. dev. regional export price (USD / metric ton)` = sd(`Regional export price (USD / metric ton)`, na.rm = T),
            `Mean export qty.` = mean(`Export Quantity`, na.rm = T), 
            `Mean export value ('000 USD)` = mean(`Export Value`, na.rm = T))

df_riskReward_regions$`Mean regional export price (USD / metric ton), logged` <-
  log(df_riskReward_regions$`Mean regional export price (USD / metric ton)`)
df_riskReward_regions$`Stand. dev. regional export price (USD / metric ton), logged` <-
  log(df_riskReward_regions$`Stand. dev. regional export price (USD / metric ton)`)
df_riskReward_regions$`Mean export value\n(million USD)` <-
  df_riskReward_regions$`Mean export value ('000 USD)` / 1000
#--
df_riskReward_regions <- df_riskReward_regions[which(!is.na(df_riskReward_regions$`Stand. dev. regional export price (USD / metric ton), logged`)), ]
ind_rm <- which(is.infinite(df_riskReward_regions$`Stand. dev. regional export price (USD / metric ton), logged`))
#df_riskReward_regions$Item[ind_rm] #look
df_riskReward_regions <- df_riskReward_regions[-ind_rm, ]
#nrow(df_riskReward_regions)

df_riskReward_regions$Item[which(df_riskReward_regions$Item == "Silk raw")] <- "Silk, raw"
df_riskReward_regions <- merge(df_riskReward_regions, df_groups, by = "Item", all.x = T)
# unique(df_riskReward_regions$Item[which(is.na(df_riskReward_regions$Group))])
# unique(df_riskReward_regions$Item[grep("Silk", df_riskReward_regions$Item, ignore.case = T)])
df_riskReward_regions <- df_riskReward_regions[which(!is.na(df_riskReward_regions$Group)), ]


#=============================================================================
df_plot <- df_riskReward_regions
df_plot$Region <- gsub("\n", " ", df_plot$Region)
region_vec <- unique(df_plot$Region)
facet_labels <- c()
adjR2_vec <- c()
for(i in 1:length(region_vec)){
  this_region <- region_vec[i]
  this_df_plot <- subset(df_plot, Region == this_region)
  mod <- lm(`Mean regional export price (USD / metric ton), logged` ~ `Stand. dev. regional export price (USD / metric ton), logged`, this_df_plot)
  #summary(mod)
  m <- round(mod$coefficients[2], 2)
  b <- round(mod$coefficients[1], 2)
  df_out <- as.data.frame(broom::glance(mod))
  adjR2 <- round(df_out$adj.r.squared, 2)
  facet_labels[i] <- paste0(this_region, "\nAdj. R-squared = ", adjR2, "\nSlope = ", m, ", Y intercept = ", b)
  adjR2_vec[i] <- adjR2
}

names(facet_labels) <- region_vec

df_plot$label_these <- NA
u <- df_plot$Item
df_plot$label_these[which(u %in% labelItems)] <- u[which(u %in% labelItems)]

gg <- ggplot(df_plot, aes(x = `Stand. dev. regional export price (USD / metric ton), logged`,
                          y = `Mean regional export price (USD / metric ton), logged`,
                          group = Group, fill = Group, shape = Group,
                          label = label_these))
#gg <- gg + geom_smooth(method = lm, se = F)
gg <- gg + geom_point(alpha = 0.6, size = smallPoint_size, color = "black", stroke = 0.25)#,
                      #fill = "khaki1", pch=21, color="Black")
gg <- gg + scale_fill_manual(values = color_vec)
gg <- gg + scale_shape_manual(values = shape_vec)
#gg <- gg + geom_text_repel(size = label_size)
gg <- gg + facet_wrap(~Region, labeller = labeller(Region = facet_labels))
gg <- gg + labs(title = "The ag commodity producer's risk-reward frontier, by region")
gg <- gg + guides(fill = guide_legend(#nrow = 2,
  override.aes = list(linetype = 0)),
  color = guide_legend(override.aes = list(linetype = 0)))
gg <- gg + theme(legend.title = element_blank(),
                 legend.text = element_text(size = legendText_size),
                 strip.background = element_blank(),
                 strip.text = element_text(size = facetTitle_size),
                 plot.title = element_text(size = title_size),
                 plot.subtitle = element_text(size = subtitle_size),
                 axis.title = element_text(size = axisTitle_size),
                 axis.text = element_text(size = axisText_size))
gg <- shift_legend2(gg)
gg <- ggplotify::as.ggplot(gg)


```

The empirical relation in Figure \ref{fig:riskRewardByRegion} thus implies that efforts to increase smallholder access to premium and value added markets must go hand in hand with efforts to mitigate the associated increase in price risk. This mitigation requires a great deal of innovation, as smallholders generally have no means by which to accumulate risk capital in the classical sense.

Step one in the innovation of smallholder risk mitigating mechanisms is to stop mistaking this absence of classical risk capital for rural poverty. Smallholders are in fact sitting on immense stores of "intangible" value in the form of social capital, environmental services, and informal property (what De Soto calls "dead capital"). The latter category alone may be worth as much as USD USD $10 trillion [@de2000mystery]. The challenge, then, is not to invent smallholder risk capital out of thin air, but to invent new standards and measures by which to monetize the smallholder risk capital already in existence.

# Discussion/Food policy implications

Tilman et al. present an alternative route, fitting their Engel model at the country-year level []. This involves an assumption that the fitted parameters will remain stable as more years of data are added in the future.

Future global food demand studies typically draw upon very sophisticated modeling and/or several rounds of expert consultations and review. These processes are important for building consensus around the plausibility of different future food demand scenarios. However, they can last for years.  re remains an underserved market of . Engel's Law and Bennett's Law suggest a parsimonious alternative. Tilman et al. were the first to exploit this alternative, estimating a 100%-110% increase in 2050 food demand over the 2005 level []. At the UN's projection of a 9.7 billion global population in 2050 [-@desa2019world], this means a global per capita daily food intake of about 3600-3800 kcal, implying that numerous countries would have daily per capita intake in the 4000-5000 kcal range. Such a scenario thus envisions entire populaces of obese persons and/or Olympic body builders consuming more than twice the recommended daily calorie intake for an adult male.
<!-- `r Tilman_est_trilKcal` per day -->


# Conclusion

Bennett's and Engel's Laws remain a very useful but largely unexploited planning and decision support resource. Only recently in their long history have researchers began to apply these laws in rigorous assessments of the quantity and composition of future food demand. In support of these efforts, here I have presented a graphical and theoretical analysis of the laws, which may help to build intuition about their meaning and relevance to modern discussions.

In the theoretical analysis, I demonstrated how the slopes of Engel's and Bennett's Laws may depend on staple food prices relative to the prices of other goods; and how this may in turn explain the remarkable stability and consistency of the laws observed in the graphical analysis. In the last section, above, I presented a new empirical law relating agricultural commodity price to price volatility. This may help to orient discussions regarding the future behavior of Bennett's and Engel's Laws as the world enters the new epoch of staple food price volatility that began in 2007.

Moreover, the new law holds clear policy implications for smallholder resilience building initiatives. In particular, the law indicates that efforts to add value to smallholder agriculture must be complemented by efforts to mitigate the higher associated risk. It also suggests that the low uptake of high value-adding technology observed throughout much of the developing world may be partly explained by the low priority given to price risk mitigation by most aid and agricultural research organizations.

\pagebreak

# References {-}

<div id="refs"></div>

\pagebreak

# Appendix

```{r, results = "markup", echo = F}

# unique(df_bennettRegion$Region)
# df_asia <- subset(df_bennettRegion[, c("Country")], Region == "Asia\n(excluding W. Asia)")
# df_
# 
# df_table <- df_bennettRegion[order(df_bennettRegion$Region), c("Country", "Region")]
# #df_table <- df_table[-which(duplicated(df_table$Country)), ]
# df_table <- df_table %>% spread(Region, Country)
# 
# kable(df_table,
#       format = "pandoc",
#       caption = "\\label{tab:tabCountries}") %>%
#   kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))


```


```{r, results = "markup", echo = F}

# df_table <- 
# 
# kable(df_table,
#       format = "pandoc",
#       caption = "\\label{tab:tabCommods}") %>%
#   kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))


```






<!-- When the sample is restricted to particular geographical or econonmic groups, the fit remains good (with the exception of Sub-Saharan Africa), and subtle differences become apparent in the parameter values (Figure \ref{fig:Engel0Disagg}). A possible reason behind this variation is explored in the next section. -->
<!-- ^[The fit for Sub-Saharan Africa can be improved by applying the alternative formulations of Engel's law discussed below.] -->

<!-- {r, fig.show = "hold", fig.width = 5, fig.height=4, fig.align="center", fig.cap="\\label{fig:Engel0Disagg}Engel's Law by region, ICP data for 2017.", echo = FALSE} -->

<!-- # region_vec <- unique(df_plot$Region) -->
<!-- # facet_labels <- c() -->
<!-- # adjR2_vec <- c() -->
<!-- # for(i in 1:length(region_vec)){ -->
<!-- #   this_region <- region_vec[i] -->
<!-- #   this_df_plot <- subset(df_plot, Region == this_region) -->
<!-- #   mod <- lm(`Food expenditure share of GDP (%), logged` ~ `GDP / capita (USD), logged`, this_df_plot) -->
<!-- #   #summary(mod) -->
<!-- #   m <- round(mod$coefficients[2], 2) -->
<!-- #   b <- round(mod$coefficients[1], 2) -->
<!-- #   df_out <- as.data.frame(broom::glance(mod)) -->
<!-- #   adjR2 <- round(df_out$adj.r.squared, 2) -->
<!-- #   facet_labels[i] <- paste0("Adj. R-squared = ", adjR2, "\nSlope = ", m, "\nY intercept = ", b) -->
<!-- #   adjR2_vec[i] <- adjR2 -->
<!-- # } -->
<!-- #  -->
<!-- # names(facet_labels) <- region_vec -->
<!-- #  -->
<!-- # gg <- ggplot(df_plot, aes(x = `GDP / capita (USD), logged`, -->
<!-- #                           y = `Food expenditure share of GDP (%), logged`, -->
<!-- #                           group = Region, fill = Region, shape = Region, -->
<!-- #                           label = label_these)) -->
<!-- # gg <- gg + geom_point(alpha = 0.6, size = smallPoint_size, color = "black", stroke = 0.5) -->
<!-- # gg <- gg + scale_fill_manual(values = color_vec) -->
<!-- # gg <- gg + scale_shape_manual(values = shape_vec) -->
<!-- # gg <- gg + geom_smooth(method = lm, se = F) -->
<!-- # gg <- gg + facet_wrap(~Region, ncol = 3, scales = "free", labeller = labeller(Region = facet_labels)) -->
<!-- # #gg <- gg + geom_text_repel(color = "black", size = smallLabel_size) -->
<!-- # gg <- gg + theme(strip.background = element_blank(), -->
<!-- #                  strip.text.x = element_text(hjust = -0.01, size = facetTitle_size), -->
<!-- #                  #legend.direction = "vertical", -->
<!-- #                  #legend.spacing.y = unit(1, 'cm'), -->
<!-- #                  legend.title = element_blank(), -->
<!-- #                  legend.text = element_text(size = legendText_size), -->
<!-- #                  axis.text = element_text(size = axisText_size), -->
<!-- #                  axis.title = element_text(size = axisTitle_size)) -->
<!-- # gg <- gg + guides(fill = guide_legend(#nrow = 2, -->
<!-- #   override.aes = list(linetype = 0)), -->
<!-- #   color = guide_legend(override.aes = list(linetype = 0))) -->
<!-- # gg <- shift_legend2(gg) -->
<!-- # gg <- ggplotify::as.ggplot(gg) -->

<!-- ``` -->


<!-- \begin{equation} -->
<!-- \frac{\partial U}{\partial x} \sim \frac{1}{x} -->
<!-- \label{eq:dimUtilDefine} -->
<!-- \end{equation} -->

<!-- Where, to be clear, the term $\partial U / \partial x$ is the marginal change in utility given a marginal increase in the quantity of good $x$, and "$\sim 1 / x$", means "inversely proportionate to the quantity of good $x$ already acquired". An expression $U(x)$ for the utility of good $x$ can then be obtained by integrating Bernoulli's statement. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \int \frac{d U}{d x} \: dx &= \int \alpha \frac{d \ln(x)}{dx} \: dx \\ -->
<!-- U(x)  &= \alpha \ln(x) + k -->
<!-- \end{split} -->
<!-- \label{eq:integrate_lnU} -->
<!-- \end{equation} -->

<!-- Where the proportionality constant $\alpha = dU/d\ln(x)$ regulates the marginal change in utility given a $1$ percent increase in good $x$. -->

<!-- Assuming that consumers want to maximize utility, then the marginal utility of the good must be equal to the marginal utility of the consumer's budget (income), $B$, for a marginal increment in $x$. -->

<!-- \begin{equation} -->
<!-- \frac{\partial \ln(B)}{\partial x} = \frac{d \ln(x)}{dx} -->
<!-- \label{eq:assumption} -->
<!-- \end{equation} -->
<!-- <!-- If $x$ is defined as an expenditure, and other expenditures are held constant, then $dB = dx$, and --> -->
<!-- By which it then follows -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \int \alpha_B \frac{\partial \ln(B)}{\partial x} \: dx &= \int \alpha_x \frac{d \ln(x)}{dx} \: dx \\ -->
<!-- \alpha_B \ln(B) + k_B  &= \alpha_x \ln(x) + k_x -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Which can then be rearranged into a log-linear expression. -->

<!-- \begin{equation} -->
<!-- \ln(x) = \beta \ln(B) + c -->
<!-- \label{eq:general_law} -->
<!-- \end{equation} -->

<!-- Where -->

<!-- \begin{equation} -->
<!-- \beta = \alpha_B / \alpha_x = \frac{d \ln(x)}{d \ln(B)}, \:\: c = (k_B - k_x) / \alpha_x -->
<!-- \end{equation} -->
